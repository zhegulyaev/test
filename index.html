<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Роман Жегуляев — Портфолио</title>
<link rel="icon" href="https://sun9-67.userapi.com/impg/c857220/v857220001/1c3b0d/1oM1v1rZ0qU.jpg?size=200x200&quality=96&sign=example-favicon" type="image/jpeg">
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
    --vk: #0077FF;
    --vk-hover: #0066CC;
    --bg-color: #141414; 
    --card-bg: #1f1f21;
    --text-main: #ffffff;
    --text-sec: #9fa0a5;
    --border: rgba(255,255,255,0.08);
    --glass: rgba(20, 20, 20, 0.85);
}

body{
    font-family: 'Manrope', system-ui, sans-serif;
    background: var(--bg-color);
    color: var(--text-main);
    margin:0;
    min-height: 100vh;
    cursor: none; /* Скрываем стандартный курсор */
}


/* HEADER PROGRESS BAR */
#header-progress {
    position: absolute;
    top: 0;
    left: 0;
    height: 3px;
    background: var(--vk);
    width: 0%;
    transition: width 0.1s linear, opacity 0.3s;
    z-index: 102;
    opacity: 0;
    pointer-events: none;
    box-shadow: 0 0 10px var(--vk);
}

/* CUSTOM CURSOR */
.cursor-dot,
.cursor-outline {
    position: fixed;
    top: 0;
    left: 0;
    transform: translate(-50%, -50%);
    border-radius: 50%;
    z-index: 9999;
    pointer-events: none;
}
.cursor-dot {
    width: 8px;
    height: 8px;
    background-color: var(--vk);
}
.cursor-outline {
    width: 40px;
    height: 40px;
    border: 1px solid rgba(255, 255, 255, 0.5);
    transition: width 0.2s, height 0.2s, background-color 0.2s;
}
body:hover .cursor-outline.hovered {
    width: 60px;
    height: 60px;
    background-color: rgba(255, 255, 255, 0.1);
    border-color: transparent;
    backdrop-filter: blur(2px);
}
/* Скрываем кастомный курсор на тач-устройствах */
@media (hover: none) and (pointer: coarse) {
    .cursor-dot, .cursor-outline { display: none; }
    body { cursor: auto; }
}

.container{max-width:1440px;margin:auto;padding:20px;}

/* PROFILE HEADER */
.profile-header {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    margin-bottom: 40px;
    margin-top: 20px;
    animation: fadeIn 0.8s ease;
}

.profile-avatar {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    border: 3px solid #2a2a2c;
    margin-bottom: 16px;
    object-fit: cover;
    background: #2a2a2c;
}

.profile-name {
    font-size: 26px;
    font-weight: 800;
    margin: 0 0 6px 0;
    letter-spacing: 0.5px;
}

.profile-desc {
    font-size: 15px;
    color: #d1d1d6;
    max-width: 600px;
    margin: 0 auto 12px auto;
    line-height: 1.5;
}

.profile-meta {
    font-size: 14px;
    color: var(--text-sec);
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 24px;
}

.profile-actions {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    justify-content: center;
}

.btn-profile {
    padding: 10px 24px;
    border-radius: 12px;
    text-decoration: none;
    font-weight: 600;
    font-size: 14px;
    transition: all 0.2s;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    cursor: none; /* Для кастомного курсора */
}

.btn-sub {
    background: var(--vk);
    color: #fff;
}
.btn-sub:hover { background: var(--vk-hover); transform: translateY(-2px); box-shadow: 0 4px 15px rgba(0,119,255,0.3); }

.btn-reviews {
    background: rgba(255,255,255,0.08);
    color: #fff;
    border: 1px solid var(--border);
}
.btn-reviews:hover { background: rgba(255,255,255,0.15); transform: translateY(-2px); }

/* HEADER STICKY */
.header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    margin-bottom:20px;
    position:sticky;
    top:20px;
    background: var(--glass);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    z-index:100;
    padding:12px 20px;
    border-radius: 24px;
    border: 1px solid var(--border);
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
}

h1{font-size:18px;font-weight:700;margin:0;flex:1;text-align:center;color:var(--text-main); letter-spacing: 0.5px;}
.subtitle{font-size:13px;color:var(--text-sec);text-align:center;font-weight: 500;}

.btn{
    background:rgba(255,255,255,0.05);
    border:1px solid var(--border);
    width:44px;height:44px;
    border-radius:14px;
    cursor:none; /* custom cursor */
    display:flex;align-items:center;justify-content:center;
    color:var(--text-main);
    transition:all .3s cubic-bezier(0.25, 0.8, 0.25, 1);
}
.btn:hover{background:rgba(255,255,255,0.15); transform: scale(1.05);}
.btn.active{background:var(--vk);border-color:var(--vk); box-shadow: 0 0 15px rgba(0,119,255,0.4);}

/* TAGS FILTER */
.tags-container {
    display: flex;
    gap: 10px;
    overflow-x: auto;
    padding-bottom: 15px;
    margin-bottom: 15px;
    scrollbar-width: none;
}
.tags-container::-webkit-scrollbar { display: none; }
.tag-chip {
    padding: 8px 16px;
    background: rgba(255,255,255,0.05);
    border: 1px solid var(--border);
    border-radius: 20px;
    font-size: 13px;
    white-space: nowrap;
    cursor: none;
    transition: .2s;
    color: var(--text-sec);
}
.tag-chip:hover { background: rgba(255,255,255,0.1); color: #fff; }
.tag-chip.active { background: var(--vk); color: #fff; border-color: var(--vk); }

/* GRID LAYOUTS */
.grid{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(320px,1fr));
    gap:24px;
    padding-top: 10px;
}

.masonry-wrap {
    display: flex;
    gap: 20px;
    width: 100%;
    align-items: flex-start;
}
.masonry-col {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 20px;
    min-width: 0;
}

/* CARDS */
.card{
    background:var(--card-bg);
    border-radius:24px;
    overflow:hidden;
    cursor:none;
    border:1px solid var(--border);
    box-shadow:0 4px 20px rgba(0,0,0,0.2);
    transition:all .4s cubic-bezier(0.25, 0.8, 0.25, 1);
    position: relative;
}
.card:hover{transform:translateY(-8px) scale(1.01);box-shadow:0 20px 40px rgba(0,0,0,0.4); border-color: rgba(255,255,255,0.2);}

.card-img{position:relative;width:100%;padding-top:85%;overflow:hidden;background:#2c2c2e;}
.card-img img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;opacity:0;transition:opacity .6s ease; filter: brightness(0.9);}
.card:hover .card-img img { filter: brightness(1.1); transform: scale(1.05); transition: transform 0.6s, opacity 0.6s, filter 0.6s;}
.card-img img.loaded{opacity:1}

.card-icon-center {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
}

.card-info {
    padding: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.card-title{font-size:16px;color:var(--text-main);font-weight:600; line-height: 1.3;}
.card-count {
    background: rgba(255,255,255,0.1);
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 13px;
    color: var(--text-sec);
    font-weight: 600;
}

/* MARKET ITEMS (SERVICES) */
.market-card {
    background: var(--card-bg);
    border-radius: 24px;
    overflow: hidden;
    border: 1px solid var(--border);
    cursor: none;
    transition: .3s;
}
.market-card:hover { transform: translateY(-5px); border-color: var(--vk); }
.market-img { width: 100%; height: 250px; object-fit: cover; background: #2c2c2e; }
.market-content { padding: 20px; }
.market-title { font-size: 16px; font-weight: 700; margin-bottom: 8px; color: #fff; }
.market-price { font-size: 18px; font-weight: 800; color: var(--vk); margin-bottom: 15px; }
.market-btn { 
    width: 100%; padding: 12px; background: rgba(255,255,255,0.1); 
    border-radius: 12px; text-align: center; font-weight: 600; 
    transition: .2s; color: #fff; cursor: none;
}
.market-card:hover .market-btn { background: var(--vk); }

/* PHOTO ITEMS */
.photo-item{
    border-radius:16px;
    overflow:hidden;
    cursor:none;
    box-shadow:0 4px 15px rgba(0,0,0,0.2);
    transition:.3s;
    position:relative;
    background: #2c2c2e;
    width: 100%;
}
.photo-item:hover { filter: brightness(1.1); transform: translateY(-4px); }

.img-container {
    position: relative;
    width: 100%;
    overflow: hidden;
    background: #232325;
}
.img-container img{
    position:absolute;
    top: 0; left: 0;
    width:100%;
    height:100%;
    object-fit:cover;
    transition:opacity .5s ease;
    opacity:0;
}
.img-container img.loaded{opacity:1}

/* REVIEWS STYLE */
.review-card {
    background: var(--card-bg);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 20px;
    margin-bottom: 20px;
    display: flex;
    gap: 15px;
    transition: transform 0.2s;
    cursor: none;
}
.review-card:hover { transform: translateY(-3px); border-color: rgba(255,255,255,0.2); background: #262629; }
.review-avatar {
    width: 48px; height: 48px;
    border-radius: 50%;
    object-fit: cover;
    background: #333;
    flex-shrink: 0;
}
.review-content { flex: 1; }
.review-header {
    display: flex; justify-content: space-between; margin-bottom: 8px;
}
.review-name {
    font-weight: 700; font-size: 15px; color: var(--text-main);
    text-decoration: none;
    pointer-events: none; /* Let card handle click */
}
.review-date { font-size: 12px; color: var(--text-sec); }
.review-text {
    font-size: 14px; line-height: 1.5; color: #d1d1d6;
    white-space: pre-wrap;
}

/* SKELETONS */
.skel {
    width: 100%;
    background: linear-gradient(110deg, #232325 8%, #2c2c2e 18%, #232325 33%);
    background-size: 200% 100%;
    animation: shine 1.5s linear infinite;
    border-radius: 16px;
}
@keyframes shine { to { background-position-x: -200%; } }

/* SCROLL TO TOP */
.scroll-top {
    position: fixed;
    bottom: 30px;
    right: 30px;
    width: 50px;
    height: 50px;
    background: var(--vk);
    color: #fff;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: none;
    box-shadow: 0 10px 30px rgba(0,119,255,0.4);
    opacity: 0;
    visibility: hidden;
    transform: translateY(20px);
    transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    z-index: 90;
    border: none;
}
.scroll-top.visible {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}
.scroll-top:hover {
    background: var(--vk-hover);
    transform: translateY(-5px);
}

/* MODAL */
#modal,#order-modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.9);backdrop-filter: blur(10px);align-items:center;justify-content:center;opacity:0;transition:opacity .4s;padding:20px;box-sizing:border-box;z-index:2000;cursor:none}
#modal.open,#order-modal.open{display:flex;opacity:1}
.modal-content{
    max-width:1400px;
    width:100%;
    display:flex;
    background:#1c1c1e;
    border-radius:24px;
    overflow:hidden;
    position:relative;
    height:85vh;
    box-shadow:0 30px 80px rgba(0,0,0,0.8);
    cursor:default;
    border: 1px solid var(--border);
    transition: transform 0.2s; /* Для свайпа */
}

.modal-left{flex:1;display:flex;flex-direction:column;background:#000;position:relative}
.modal-img{flex:1;display:flex;align-items:center;justify-content:center;overflow:hidden;position:relative; cursor: zoom-in;}

.modal-img img{max-width:100%;max-height:100%;object-fit:contain; transition: transform 0.4s ease;}
.modal-img.zoomed { 
    cursor: zoom-out; 
    align-items: flex-start; 
    justify-content: flex-start; 
    overflow: auto;
}
.modal-img.zoomed img { 
    transform-origin: var(--mouse-x, 50%) var(--mouse-y, 50%);
    transform: scale(2); 
}

.modal-preview{opacity:1;transition:opacity .3s}
.modal-full{position:absolute;opacity:0;transition:opacity .5s}
.modal-full.loaded{opacity:1}
.modal-preview.faded{opacity:0}

.modal-bottom-bar{
    height:60px;
    background:rgba(20,20,20,0.8);
    display:flex;
    align-items:center;
    padding:0 25px;
    justify-content:space-between;
    color:#888;
    font-size:14px; 
    border-top: 1px solid #333;
}
.modal-bottom-bar .left {
    display: flex;
    align-items: center;
    gap: 20px;
}
.modal-bottom-bar .right {
    display: flex;
    align-items: center;
    gap: 20px;
}
.vk-link-bottom{color:var(--text-sec);text-decoration:none; transition: .2s; cursor: none;}
.vk-link-bottom:hover{color:var(--vk);}

.more-actions {
    position: relative;
}
.more-btn {
    color: var(--text-sec);
    cursor: none;
    padding: 8px;
    border-radius: 8px;
    transition: .2s;
}
.more-btn:hover {
    background: rgba(255,255,255,0.1);
}
.more-menu {
    position: absolute;
    bottom: 100%;
    right: 0;
    background: #1c1c1e;
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 8px 0;
    min-width: 220px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    display: none;
    flex-direction: column;
}
.more-menu a {
    padding: 12px 20px;
    color: var(--text-main);
    text-decoration: none;
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 12px;
    transition: .2s;
}
.more-menu a:hover {
    background: rgba(255,255,255,0.1);
}
.more-actions:hover .more-menu {
    display: flex;
}

/* RIGHT PANEL */
.modal-right{width:400px;display:flex;flex-direction:column;background:#1c1c1e;border-left:1px solid var(--border);position:relative}
.modal-info-scroll{flex:1;overflow-y:auto;padding:30px; position: relative;}
.modal-info-scroll::-webkit-scrollbar {width: 6px;}
.modal-info-scroll::-webkit-scrollbar-thumb {background: #3a3a3c; border-radius: 3px;}

.modal-header{display:flex;align-items:center;gap:14px;margin-bottom:20px;text-decoration:none;color:inherit; margin-right: 40px; cursor: none;}
.modal-avatar{width:48px;height:48px;border-radius:50%; border: 2px solid var(--border);}
.modal-author{font-weight:700;font-size:15px;color:var(--text-main); margin-bottom: 2px;}
.modal-date{font-size:12px;color:var(--text-sec)}

.modal-text{font-size:14px;line-height:1.6;margin-bottom:15px;white-space:pre-wrap;color:#d1d1d6;position:relative;overflow:hidden}
.modal-text.collapsed{max-height:100px; mask-image: linear-gradient(to bottom, black 50%, transparent 100%);}
.show-more-btn{color:var(--vk);cursor:none;font-size:13px;font-weight: 600;display:none;margin-bottom:25px}
.show-more-btn.active{display:block}

.order-btn{
    background:var(--vk);
    color:#fff;
    border:none;
    padding:16px;
    border-radius:16px;
    width:100%;
    font-weight:700;
    font-size:15px;
    cursor:none;
    margin-bottom:30px;
    transition:.2s;
    box-shadow: 0 4px 15px rgba(0, 119, 255, 0.3);
}
.order-btn:hover{background:var(--vk-hover);transform:translateY(-2px); box-shadow: 0 8px 25px rgba(0, 119, 255, 0.4);}

.modal-actions-bar{display:flex;gap:20px;padding-bottom:20px;border-bottom:1px solid var(--border);margin-bottom:20px}
.action-item{display:flex;align-items:center;gap:6px;color:var(--text-sec);font-size:14px;font-weight:600}
.action-item svg{fill:var(--text-sec); transition: .2s}
.has-likes svg{fill:#ff3347}

/* COMMENTS */
.comments-section{margin-top:10px}
.comment-item{display:flex;gap:12px;margin-bottom:20px}
.comment-avatar{width:36px;height:36px;border-radius:50%;object-fit:cover; border: 1px solid var(--border); flex-shrink: 0; background: #333;}
.comment-body {flex: 1; min-width: 0;}
.comment-name{font-weight:600;color:var(--text-main);font-size:13px;margin-right:5px;cursor:none; transition: .2s;}
.comment-name:hover {color: var(--vk);}
.comment-text{font-size:13px;line-height:1.5;margin-bottom:6px; color: #ccc; word-wrap: break-word;}

/* ATTACHMENTS IN COMMENTS */
.comment-attachments { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px; }
.comment-attach-img { width: 100px; height: 100px; object-fit: cover; border-radius: 8px; cursor: none; border: 1px solid rgba(255,255,255,0.1); }
.comment-attach-img:hover { opacity: 0.8; }

.nav{position:absolute;top:50%;transform:translateY(-50%);width:60px;height:60px;background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.1);backdrop-filter: blur(5px);cursor:none;display:flex;align-items:center;justify-content:center;color:#fff;font-size:24px;border-radius:50%;z-index:10;transition:0.3s}
.nav:hover{background:rgba(255,255,255,0.25); transform: translateY(-50%) scale(1.1);}
.nav-left{left:20px}.nav-right{right:20px}

/* SINGLE CLOSE BUTTON */
.close-in-modal{
    position:absolute;
    top: 20px;
    right: 20px;
    background:rgba(255,255,255,0.1);
    border-radius:50%;
    width:36px;
    height:36px;
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:none;
    color:#fff;
    border:none;
    z-index:20; 
    transition: .2s;
}
.close-in-modal:hover{background: rgba(255,255,255,0.25);}
.close-in-modal svg {width: 20px; height: 20px; stroke: currentColor; stroke-width: 2.5;}

/* CONTACT MODAL */
.order-choice{background:#1c1c1e;padding:40px;border-radius:30px;max-width:380px;width:100%;text-align:center;position:relative; border: 1px solid var(--border); box-shadow: 0 20px 60px rgba(0,0,0,0.5);}
.order-choice h2{margin-top:0;font-size:22px;margin-bottom:12px; color: #fff;}
.order-choice p{color:var(--text-sec);font-size:15px;margin-bottom:30px; line-height: 1.4;}
.contact-list{display:flex;flex-direction:column;gap:12px}
.contact-link{display:flex;align-items:center;justify-content:center;gap:12px;padding:16px;border-radius:16px;text-decoration:none;font-weight:600;transition:.2s;color:#fff; font-size: 15px; cursor: none;}
.link-vk{background:#0077FF}.link-vk:hover{background:#0066CC}
.link-tg{background:#24A1DE}.link-tg:hover{background:#1d85b9}

/* Empty State */
.empty-album{text-align:center;padding:100px 20px;color:var(--text-sec);font-size:18px}

/* Comments loader */
.comments-loader svg{width:32px;height:32px;animation:spin 1s linear infinite; stroke: var(--text-sec);}
@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}

/* FLOATING MESSAGE BUBBLE - DARK STYLE */
.message-bubble {
    position: fixed;
    bottom: 30px;
    right: 30px;
    background: var(--card-bg);
    color: var(--text-main);
    border-radius: 20px;
    padding: 16px 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.4);
    max-width: 320px;
    z-index: 95;
    cursor: pointer;
    transition: transform 0.3s, opacity 0.3s;
    display: flex;
    align-items: center;
    gap: 14px;
    border: 1px solid var(--border);
}
.message-bubble:hover {
    transform: translateY(-5px);
}
.message-bubble img {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    object-fit: cover;
}
.message-bubble-text {
    flex: 1;
}
.message-bubble-title {
    font-weight: 700;
    font-size: 15px;
    margin-bottom: 4px;
}
.message-bubble-desc {
    font-size: 14px;
    color: var(--text-sec);
}
.message-bubble-btn {
    background: var(--vk);
    color: #fff;
    padding: 8px 16px;
    border-radius: 30px;
    font-size: 14px;
    font-weight: 600;
    margin-top: 10px;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

@media(max-width:1000px){
  .message-bubble {bottom: 90px; right: 20px; max-width: 280px;}
}
@keyframes fadeIn {from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

.skel { margin-bottom: 15px; }
.header-btn {
    display: inline-flex; align-items: center; justify-content: center;
    padding: 0 20px; border-radius: 12px; text-decoration: none; font-weight: 500;
    margin-right: 12px; cursor: pointer; border: none; font-size: 15px; height: 44px;
    box-sizing: border-box; vertical-align: middle; font-family: -apple-system, BlinkMacSystemFont, 'Roboto', sans-serif; 
}
.header-btn svg { margin-right: 8px; width: 20px; height: 20px; display: block; fill: currentColor; }
.header-btn-red { background-color: #e54643; color: #fff; }
.header-btn-red:hover { background-color: #d43f3c; }
.header-profile a, .header-profile button { text-decoration: none; }


.ref-btn { display: inline-flex; align-items: center; justify-content: center; background: #333; color: #fff; padding: 10px 20px; border-radius: 8px; margin-top: 15px; cursor: pointer; font-size: 14px; border:none; width: 100%; box-sizing: border-box; }
.ref-btn.active { background: #4caf50; }
.ref-btn:hover { background: #444; }
.ref-btn.active:hover { background: #45a049; }
#ref-bar { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: #222; color: #fff; padding: 12px 24px; border-radius: 50px; display: none; align-items: center; gap: 15px; z-index: 9999; box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
#ref-bar.visible { display: flex; }
.ref-copy-btn { background: #0077FF; color: #fff; border: none; padding: 6px 12px; border-radius: 15px; cursor: pointer; font-size: 13px; }
.ref-clear-btn { background: transparent; color: #aaa; border: none; cursor: pointer; font-size: 18px; }


.modal-buttons-row { display: flex; gap: 12px; margin-top: 15px; width: 100%; align-items: stretch; }
#ref-btn-container { display: flex; flex: 1; margin: 0; padding: 0; }
.order-btn, .ref-btn {
    flex: 1;
    border: none; border-radius: 12px;
    height: 44px; font-size: 14px; font-weight: 500; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    padding: 0 10px;
    white-space: nowrap;
    text-decoration: none;
    box-sizing: border-box;
}
.order-btn { background: #0077FF; color: #fff; }
.ref-btn { background: #2a2a2c; color: #fff; margin: 0 !important; width: 100%; }
.ref-btn.active { background: #4caf50; }
.order-btn svg, .ref-btn svg { margin-right: 8px; width: 20px; height: 20px; fill: currentColor; flex-shrink: 0; }

#toast {
    position: fixed; top: 20px; right: 20px; background: #333; color: #fff;
    padding: 12px 24px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    z-index: 10000; opacity: 0; transition: opacity 0.3s; pointer-events: none; font-weight: 500;
}
#toast.show { opacity: 1; }

.modal-img-container { flex: 1; display: flex; align-items: center; justify-content: center; overflow: hidden; position: relative; width: 100%; height: 100%; min-height: 0; }
.modal-img-container img { max-width: 100%; max-height: 100%; width: auto; height: auto; object-fit: contain; display: block; }
.modal-img-container.zoomed img { max-width: none; max-height: none; cursor: zoom-out; }


.loader-spinner { position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); width:40px; height:40px; border:3px solid rgba(255,255,255,0.1); border-radius:50%; border-top-color:#0077FF; animation:spin 0.8s linear infinite; z-index:10; opacity:0; transition:opacity 0.3s; pointer-events:none; }
.loader-spinner.active { opacity:1; }
@keyframes spin { 100% { transform: translate(-50%, -50%) rotate(360deg); } }
#preview { transition: filter 0.3s ease, opacity 0.3s ease; }
#preview.blur { filter: blur(15px); opacity: 0.8; }


.footer-socials{display:flex;flex-wrap:wrap;justify-content:flex-start;gap:24px;margin-top:100px;margin-bottom:36px;padding-top:18px;border-top:1px solid var(--border);}
.footer-link{flex:0 0 auto;display:inline-flex;align-items:center;gap:12px;padding:10px 14px;border-radius:14px;text-decoration:none;background:transparent;border:1px solid transparent;transition:.2s;cursor:pointer;}
.footer-link:hover{background:rgba(255,255,255,.03);border-color:rgba(255,255,255,.1);}
.footer-icon{width:42px;height:42px;border-radius:12px;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,.05);flex-shrink:0;}
.footer-icon svg{width:22px;height:22px;display:block;margin:auto;}
.vk-group-icon{color:#9aa0a6;}.tg-icon{color:#9aa0a6;}.vk-user-icon{color:#9aa0a6;}.be-icon{color:#9aa0a6;}.pin-icon{color:#9aa0a6;}
.footer-text{display:flex;flex-direction:column;line-height:1.05;}
.footer-title{font-size:13px;font-weight:700;color:var(--text-main);margin-bottom:2px;}
.footer-sub{font-size:11px;color:var(--text-sec);opacity:.72;}
@media(max-width:700px){.footer-link{width:100%;}}


.scroll-top-link {
    position: fixed !important;
    top: 20px !important;
    left: 20px !important;
    bottom: auto !important;
    right: auto !important;
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
    color: var(--text-sec);
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    background: transparent;
    border-radius: 8px;
    transition: opacity 0.3s, background 0.2s;
    z-index: 90;
    opacity: 0;
    pointer-events: none;
}
.scroll-top-link.visible { opacity: 0.7; pointer-events: auto; }
.scroll-top-link.visible:hover { opacity: 1; background: rgba(255,255,255,0.05); }
.scroll-top-link svg { color: var(--text-sec); }
@media(max-width: 1000px) { .scroll-top-link { display: none; } } 


.modal-progress-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: rgba(255,255,255,0.1);
    z-index: 99999;
    pointer-events: none;
}
#modal-progress-bar {
    height: 100%;
    background: #0077FF;
    width: 0%;
    transition: width 0.1s linear;
    box-shadow: 0 0 8px #0077FF;
}
.message-bubble {
    position: fixed;
    bottom: 30px;
    right: 30px;
    /* ensure relative for absolute child if not fixed? But fixed works too for child absolute */
    /* Wait, message-bubble is already defined in base css. I should just append specific overrides. */
    /* To be safe, I won't redefine .message-bubble main props, just position context if needed. */
    /* Actually, fixed element can contain absolute elements relative to it. */
}
.message-bubble-close {
    position: absolute;
    top: 10px;
    right: 10px;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-sec);
    opacity: 0.5;
    cursor: pointer;
    transition: 0.2s;
    border-radius: 50%;
    background: transparent;
}
.message-bubble-close:hover { opacity: 1; background: rgba(255,255,255,0.1); color: #fff; }


/* GRID & MOBILE */
@media (max-width: 768px) {
    .navbar { display: none; flex-direction: column; position: absolute; top: 100%; left: 0; width: 100%; background: #000; padding: 20px; box-sizing:border-box; }
    .navbar.active { display: flex; }
    #menu-icon { display: block !important; font-size: 30px; cursor: pointer; color: #fff; padding-right:20px; }
    .services-container, .portfolio-container { flex-direction: column; }
    .grid { grid-template-columns: 1fr !important; }
}
.grid { grid-template-columns: repeat(auto-fill, 320px) !important; justify-content: center; }

/* PROGRESS BAR */
#modal-progress-bar { position: fixed; top: 0; left: 0; height: 4px; background: #0077ff; width: 0%; z-index: 100001; transition: width 0.2s; }

/* LEFT SCROLL */
#left-scroll-area { position: fixed; top: 0; left: 0; width: 80px; height: 100vh; z-index: 9998; cursor: pointer; }
#left-scroll-area:hover { background: rgba(255,255,255,0.02); }
#scroll-indicator { position: fixed; top: 50%; left: 20px; transform: translateY(-50%); color: rgba(255,255,255,0.3); font-size: 24px; pointer-events: none; z-index: 9999; transition: opacity 0.3s; opacity: 0; }
#left-scroll-area:hover + #scroll-indicator { opacity: 1; }

/* REF BAR */
#ref-bar { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); display: none; gap: 10px; padding: 10px 15px; background: rgba(20,20,20,0.9); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; z-index: 10000; align-items: center; color: white; }
#ref-bar.visible { display: flex; }
.ref-btn-icon { background: rgba(255,255,255,0.1); border: none; color: white; padding: 8px 12px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 6px; font-size: 13px; }
.ref-btn-icon:hover { background: rgba(255,255,255,0.2); }

/* OVERLAY BUTTON */
.ref-overlay-btn { position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.6); color: white; border: 1px solid rgba(255,255,255,0.3); width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; opacity: 0; transition: all 0.2s; z-index: 10; }
.ref-overlay-btn.active { background: #0077ff; border-color: #0077ff; opacity: 1; }
.photo-item:hover .ref-overlay-btn { opacity: 1; }
.ref-overlay-btn:hover { background: rgba(255,255,255,0.2); transform: scale(1.1); }

/* SUBSCRIBE */
.btn-subscribed { background: #2a2a2a !important; color: #888 !important; border-color: #444 !important; }

/* YEARS BAR */
#years-bar { display: none; justify-content: center; flex-wrap: wrap; gap: 10px; margin: 10px 0 20px; padding: 0 4%; }
.year-chip { background: transparent; border: 1px solid #444; color: #888; padding: 6px 14px; border-radius: 20px; cursor: pointer; font-size: 14px; transition: all 0.2s; }
.year-chip:hover { border-color: #777; color: #fff; }
.year-chip.active { background: #fff; color: #000; border-color: #fff; }


#notificationModal {
    z-index: 100000 !important;
}
.notification-item {
    z-index: 100001 !important;
    position: relative;
}
/* Animation for preview icon */
.preview-icon, .overlay svg {
    transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}
.card:hover .preview-icon, .card:hover .overlay svg {
    transform: scale(1.2) rotate(5deg);
}
/* Modal Order Button */
.btn-order-modal {
    background: var(--vk);
    color: #fff;
    margin-left: 10px;
    border: none;
    box-shadow: 0 4px 12px rgba(0, 119, 255, 0.3);
}
.btn-order-modal:hover {
    background: var(--vk-hover);
    transform: translateY(-2px);
}


#scroll-top { opacity: 0; visibility: hidden; pointer-events: none; transition: all 0.3s; }
#scroll-top.visible { opacity: 1; visibility: visible; pointer-events: auto; }


/* VK Video embeds */
.vkvideo-grid{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:16px;align-items:stretch;}
.vkvideo-embed{position:relative;width:100%;padding-top:56.25%;background:#0f0f10;border-radius:16px;overflow:hidden;border:1px solid rgba(255,255,255,0.08);}
.vkvideo-embed iframe{position:absolute;inset:0;width:100%;height:100%;}
.vkvideo-placeholder{display:flex;align-items:center;justify-content:center;height:100%;min-height:0;text-decoration:none;border-radius:16px;border:1px dashed rgba(255,255,255,0.18);background:rgba(255,255,255,0.03);}
.vkvideo-placeholder-inner{padding:22px;text-align:center;color:#fff;}
.vkvideo-placeholder-title{font-weight:800;font-size:14px;margin-bottom:6px;}
.vkvideo-placeholder-sub{font-size:12px;color:rgba(255,255,255,0.6);}
@media (max-width: 1200px){.vkvideo-grid{grid-template-columns:repeat(2,minmax(0,1fr));}}
@media (max-width: 640px){.vkvideo-grid{grid-template-columns:1fr;}}


/* v55 Styles */

/* 1. Header Button - Corrected Red */
/* Using the same red as the underline/accent from earlier: #FF3347 */
/* Or maybe slightly punchier like #ff2e3e */
.btn-header-primary {
    display: inline-flex !important;
    align-items: center;
    justify-content: center;
    gap: 12px;
    background: #ff3347 !important; /* Standard Accent Red */
    border: none !important;
    padding: 0 32px !important;
    border-radius: 16px !important;
    color: #fff !important;
    font-weight: 800 !important;
    font-size: 17px !important;
    text-decoration: none !important;
    transition: all 0.2s;
    cursor: pointer;
    height: 54px !important;
    box-shadow: 0 4px 20px rgba(255, 51, 71, 0.4) !important;
    box-sizing: border-box;
    white-space: nowrap;
}
.btn-header-primary:hover {
    background: #e62e40 !important;
    transform: translateY(-2px);
    box-shadow: 0 8px 30px rgba(255, 51, 71, 0.5) !important;
}

/* 2. Secondary Button (Subscribe, Reviews) - Standard Gray/Transparent */
.btn-secondary-styled {
    display: inline-flex !important;
    align-items: center;
    justify-content: center;
    gap: 10px;
    background: rgba(255,255,255,0.08) !important;
    border: 1px solid rgba(255,255,255,0.08) !important;
    padding: 0 24px !important;
    border-radius: 16px !important;
    color: #fff !important;
    font-weight: 600 !important;
    font-size: 15px !important;
    text-decoration: none !important;
    transition: all 0.2s;
    cursor: pointer;
    overflow: visible;
    height: 54px !important;
    box-sizing: border-box;
    white-space: nowrap;
}
.btn-secondary-styled:hover {
    background: rgba(255,255,255,0.15) !important;
    transform: translateY(-2px);
    border-color: rgba(255,255,255,0.2) !important;
}

/* 3. Reviews Badge - BLUE Background */
.review-icon-box {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 28px;
}
.review-badge {
    position: absolute;
    top: -6px;
    right: -10px;
    background: #0077FF !important; /* BLUE Badge */
    color: #fff;
    font-size: 11px;
    font-weight: 800;
    min-width: 18px;
    height: 18px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0 5px;
    border: 2px solid #2a2a2c;
    box-shadow: 0 2px 8px rgba(0,0,0,0.4);
    z-index: 10;
}

/* Base Styles (Underline, Tags, etc.) */
.marker-underline-wrapper{position:relative;display:inline-block;white-space:nowrap}
.marker-underline-svg{position:absolute;bottom:-10px;left:-5%;width:110%;height:15px;pointer-events:none;z-index:-1}
.marker-path{fill:none;stroke:#ff3347;stroke-width:4;stroke-linecap:round;stroke-linejoin:round;opacity:.9;stroke-dasharray:200;stroke-dashoffset:200;animation:dash 1s cubic-bezier(.25,.46,.45,.94) forwards}
@keyframes dash{to{stroke-dashoffset:0}}
.client-tag{transition:all .3s ease}
.client-tag.blue{background:linear-gradient(135deg,#0077FF 0%,#0055cc 100%);box-shadow:0 4px 15px rgba(0,119,255,.35);border:1px solid rgba(255,255,255,.1)}
.clients-full-width{margin-top:80px !important;margin-bottom:40px !important}
.clients-header{margin-bottom:50px !important}
.info-icon-wrapper{display:inline-flex;align-items:center;vertical-align:middle;margin-left:10px;position:relative;top:-3px;z-index:50}
.info-icon{display:flex;align-items:center;justify-content:center;width:24px;height:24px;border-radius:50%;background:rgba(255,255,255,.1);color:rgba(255,255,255,.6);cursor:help;transition:all .2s ease}
.info-icon svg{width:16px;height:16px}
.info-icon:hover{background:#0077FF;color:#fff;transform:scale(1.1)}
.info-tooltip{position:absolute;bottom:140%;left:50%;transform:translateX(-50%) translateY(10px);background:#1c1c1e;border:1px solid rgba(255,255,255,.15);padding:12px 16px;border-radius:12px;width:260px;color:#fff;font-family:'Manrope',sans-serif;font-size:13px;font-weight:500;line-height:1.5;text-align:center;white-space:normal;word-spacing:normal;letter-spacing:.3px;pointer-events:none;opacity:0;visibility:hidden;transition:all .25s cubic-bezier(.165,.84,.44,1);box-shadow:0 10px 40px rgba(0,0,0,.6);z-index:1000}
.info-tooltip::after{content:"";position:absolute;top:100%;left:50%;margin-left:-6px;border-width:6px;border-style:solid;border-color:#1c1c1e transparent transparent transparent}
.info-icon-wrapper:hover .info-tooltip{opacity:1;visibility:visible;transform:translateX(-50%) translateY(0)}
.profile-actions{gap:12px !important; flex-wrap: wrap; justify-content: center;}


/* CLIENTS SECTION STYLES (MOVED FROM JS) */

                .clients-full-width {
    grid-column: 1 / -1 !important; margin-top: 10px; margin-bottom: 30px; width: 100%; }
                .clients-container { max-width: 1440px; margin: 0 auto; padding: 0 20px; }

                .clients-header { font-size: 42px; font-weight: 800; margin-bottom: 40px; color: #fff; display: flex; align-items: center; gap: 16px; letter-spacing: -1px; }
                .clients-header .blue-arrow { color: #0077FF; width: 32px; height: 32px; }

                /* Grid with stretch */
                .clients-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }

                .client-column { 
                    background: linear-gradient(180deg, rgba(28,28,30,0.8) 0%, rgba(20,20,22,0.95) 100%);
                    backdrop-filter: blur(20px);
                    border-radius: 32px; 
                    padding: 32px; 
                    border: 1px solid rgba(255,255,255,0.06); 
                    box-shadow: 0 20px 40px rgba(0,0,0,0.2);
                    height: 100%; /* Force full height of the grid cell */
                    box-sizing: border-box; /* Include padding in height */
                    display: flex;
                    flex-direction: column;
                }
                .col-title { font-size: 20px; font-weight: 500; margin-bottom: 24px; color: #fff; opacity: 1; }

                .tags-wrap { display: flex; flex-wrap: wrap; gap: 12px; align-content: flex-start; }

                .client-tag { 
                    background: linear-gradient(145deg, #2a2a2c, #1f1f21);
                    height: 44px;
                    padding: 0 20px; 
                    border-radius: 24px; 
                    font-size: 16px; 
                    font-weight: 500;
                    color: #e0e0e0; 
                    transition: 0.2s;
                    cursor: default;
                    display: inline-flex;
                    align-items: center;
                    justify-content: center;
                    gap: 8px;
                    line-height: 1;
                    border: 1px solid rgba(255,255,255,0.03);
                }
                .client-tag span { position: relative; top: -1px; }

                .client-tag:hover { transform: translateY(-2px); border-color: rgba(255,255,255,0.1); }

                .client-tag.blue {
                    background: linear-gradient(90deg, #0077FF 0%, #0066dd 100%);
                    color: #fff;
                    box-shadow: 0 4px 16px rgba(0, 119, 255, 0.3);
                    border: none;
                }

                .tag-arrow { width: 16px; height: 16px; opacity: 0; transition: 0.2s; transform: translateX(-4px); display: block; }
                .client-tag:hover .tag-arrow { opacity: 1; transform: translateX(0); }
                .client-tag.blue .tag-arrow { opacity: 1; transform: translateX(0); }

                @media(max-width: 800px) { .clients-grid { grid-template-columns: 1fr; } }
              

/* MASONRY FIXES */
.masonry-wrap {
    display: flex !important;
    flex-direction: row !important;
    align-items: flex-start !important;
    width: 100% !important;
    box-sizing: border-box !important;
    padding: 0 20px !important; /* Ensure padding doesn't squeeze */
}
.masonry-col {
    display: flex !important;
    flex-direction: column !important;
    flex: 1 1 0px !important; 
    min-width: 0 !important;
    gap: 20px !important;
    max-width: 100% !important; /* Prevent overflow */
}
.img-container {
    width: 100% !important;
    background: #232325 !important;
}
.photo-item {
    width: 100% !important;
    margin-bottom: 0 !important;
}


/* --- TABS & TARIFFS (RESTORED) --- */
:root { --vk: #0077FF; --gold: #F0C674; --red: #FF3333; }

.tab-nav { display:flex; justify-content:center; gap:30px; margin:10px 0 30px; padding:0 20px; }
.tab-btn { background:transparent; border:none; color: var(--text-sec); padding:10px 0; cursor:pointer; font-size:18px; font-weight:700; font-family:'Manrope', sans-serif; transition: .3s; position:relative; }
.tab-btn:hover, .tab-btn.active { color:#fff; }
.tab-btn.active::after { content:''; position:absolute; left:0; bottom:0; width:100%; height:2px; background: var(--vk); box-shadow: 0 0 10px var(--vk); }

.tariff-header { text-align:center; max-width:820px; margin:0 auto 50px; padding: 0 20px; }
.section-title { font-size:32px; font-weight:800; margin:0 0 10px; color:#fff; }
.section-subtitle { color: var(--text-sec); margin:0; font-size:16px; }

.tariffs-grid { display:grid; grid-template-columns: repeat(3, 1fr); gap:30px; max-width:1200px; margin:0 auto 80px; padding:0 20px; align-items:flex-start; }

.tariff-wrapper { display:flex; flex-direction:column; gap:30px; }
.tariff-card { background:#1f1f21; border:1px solid rgba(255,255,255,0.05); border-radius:24px; padding:40px 30px; display:flex; flex-direction:column; transition:.3s; }
.tariff-card:hover { transform: translateY(-10px); box-shadow: 0 20px 50px -10px rgba(0,0,0,0.5); background:#252527; }

.tariff-note { margin-top:14px; color:var(--text-sec); font-size:14px; line-height:1.5; padding:0; border-radius:0; border:none; background:transparent; display:block; box-shadow:none; }
.tariff-note-title { color:#fff; font-weight:800; font-size:15px; margin-bottom:6px; letter-spacing:0.2px; }
.tariff-note-text { color:#f1f1f3; font-weight:600; display:flex; align-items:flex-start; gap:8px; }
.tariff-note-text .note-accent { color: var(--red); font-weight:900; line-height:1; }

.tariff-name { font-size:24px; font-weight:700; margin:0 0 20px; display:flex; align-items:center; gap:12px; padding:12px 24px; background: rgba(255,255,255,0.05); border-radius: 8px; justify-content:space-between; }
.tariff-title { display:inline-flex; align-items:center; gap:10px; }
.tariffs-grid > :nth-child(2) .tariff-name { background: var(--red); color:#fff; }
.tariffs-grid > :nth-child(3) .tariff-name { background: var(--gold); color:#1a1a1a; }

.discount-badge { background: rgba(255, 255, 255, 0.12); color:#fff; font-size:12px; font-weight:800; padding:4px 10px; border-radius:8px; margin-left:auto; display:inline-flex; align-items:center; }
.tariffs-grid > :nth-child(3) .discount-badge { background: rgba(0,0,0,0.18); color:#1a1a1a; }

.tariff-features { list-style:none; padding:0; margin:0 0 24px; flex-grow:1; }

/* rows */
.tariff-feature-item { display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px; font-size:14px; color: var(--text-sec); line-height:1.5; user-select:none; }
.tariff-feature-item.excluded { opacity:0.5; text-decoration: line-through; }
.tariff-feature-item.excluded .qty-control { opacity:0.5; pointer-events:none; }
.item-left { display:flex; align-items:center; gap:10px; flex-grow:1; }
.item-left > span { display:inline-flex; align-items:center; gap:6px; }

/* Minimal checkbox (smaller) */
.feature-checkbox { appearance:none; width:16px; height:16px; border:1px solid rgba(255,255,255,0.18); border-radius:5px; background:rgba(255,255,255,0.02); cursor:pointer; position:relative; transition:.18s ease; flex-shrink:0; box-shadow: inset 0 0 0 1px rgba(255,255,255,0.04); }
.feature-checkbox:hover { border-color: var(--red); box-shadow: inset 0 0 0 1px rgba(255,51,51,0.25); }
.feature-checkbox:checked { border-color: var(--red); background: rgba(255,51,51,0.18); box-shadow: 0 6px 14px rgba(255,51,51,0.18); }
.feature-checkbox:checked::after { content:''; position:absolute; inset:3px; border-radius:3px; background: var(--red); box-shadow: 0 6px 12px rgba(255,51,51,0.25); mask: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="white" d="M6.2 11.2 3.3 8.3l-1 1 3.9 3.9 7.5-7.5-1-1z"/></svg>') center/10px 10px no-repeat; -webkit-mask: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="white" d="M6.2 11.2 3.3 8.3l-1 1 3.9 3.9 7.5-7.5-1-1z"/></svg>') center/10px 10px no-repeat; }
.feature-checkbox:disabled { opacity:0.8; cursor:not-allowed; border-color: rgba(255,51,51,0.5); }

.qty-control.disabled { opacity:0.35; pointer-events:none; filter: grayscale(0.3); }
.qty-checkbox { margin-right:6px; }
.qty-checkbox[disabled] { opacity:1; }

.item-icon { display:none; }

/* qty control */
.qty-control { display:flex; align-items:center; background: rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.08); border-radius: 10px; padding:0 4px; gap:4px; height:30px; color:#d7d7db; min-width:92px; }
.qty-btn { width:24px; height:24px; border:none; background:transparent; color:inherit; cursor:pointer; font-size:15px; display:flex; align-items:center; justify-content:center; border-radius:6px; transition:.18s ease; }
.qty-btn:hover { background: rgba(255,255,255,0.08); color:#fff; }
.qty-val { min-width:28px; text-align:center; font-size:13px; font-weight:800; color:inherit; letter-spacing:0.5px; }

/* addons */
.addon-section { margin-top:18px; border-top: 1px dashed rgba(255,255,255,0.12); padding-top:18px; }
.addon-toggle { background:none; border:none; color: var(--vk); font-size:14px; font-weight:800; cursor:pointer; padding:0; display:flex; align-items:center; gap:6px; }
.addon-list { display:none; margin-top:10px; list-style:none; padding:0; }
.addon-list.open { display:block; }

/* tooltip icon */
.info-icon { display:inline-flex; align-items:center; justify-content:center; width:16px; height:16px; border: 1px solid rgba(255,255,255,0.18); border-radius:50%; color: rgba(255,255,255,0.6); font-size:10px; margin-left:8px; cursor:help; flex-shrink:0; position: relative; vertical-align: middle; transform: translateY(-1px); line-height:1; }
.info-icon:hover { border-color: rgba(255,255,255,0.8); color:#fff; }
.info-icon:hover::after { content: attr(data-tooltip); position:absolute; bottom: 120%; left:50%; transform: translateX(-50%);
  background:#0f0f10; border:1px solid rgba(255,255,255,0.12); color:#fff;
  padding:10px 12px; border-radius:10px; font-size:12px; white-space: pre-wrap;
  width:240px; z-index:100; box-shadow: 0 10px 30px rgba(0,0,0,0.8); pointer-events:none; }
.tariffs-grid > :nth-child(3) .tariff-name .info-icon { border-color: rgba(0,0,0,0.30); color: rgba(0,0,0,0.65); }
.tariffs-grid > :nth-child(3) .tariff-name .info-icon:hover { border-color:#000; color:#000; }

.tariff-price { font-size:34px; font-weight:900; margin: 12px 0 6px; color:#fff; letter-spacing: 0.5px; }
.price-note { color: var(--text-sec); font-size:12px; font-weight:700; margin-bottom:18px; }
.scroll-hint { margin-top:10px; color:var(--text-sec); font-size:13px; display:flex; align-items:center; gap:8px; justify-content:center; opacity:0.85; letter-spacing:0.1px; }
.scroll-hint .hint-arrow { display:inline-flex; width:22px; height:22px; border-radius:8px; background: rgba(255,255,255,0.08); align-items:center; justify-content:center; color:#fff; box-shadow: inset 0 0 0 1px rgba(255,255,255,0.08); animation: hint-bounce 1.6s infinite; }
.scroll-hint strong { color:#fff; }

@keyframes hint-bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(4px); } }

.speed-badge { margin-top:18px; margin-bottom:24px; padding:14px 14px; background: rgba(240,198,116,0.10); border: 1px solid var(--gold); border-radius: 12px; color: var(--gold); font-size:13px; font-weight:800; display:flex; align-items:center; gap:12px; }
.duration-note { display:block; color: inherit; opacity:0.85; font-weight:600; line-height:1.2; margin-left:0; }

.tariff-btn { width:100%; padding:16px; background:transparent; border:1px solid rgba(255,255,255,0.10); color:#fff; border-radius: 12px; font-weight:900; font-size:16px; cursor:pointer; transition:.3s; margin-top:auto; }
.tariff-btn:hover { background:#fff; color:#000; border-color:#fff; }
.tariffs-grid > :nth-child(2) .tariff-btn { background: var(--red); border-color: var(--red); }
.tariffs-grid > :nth-child(2) .tariff-btn:hover { background:#D61E1E; border-color:#D61E1E; color:#fff; }
.tariffs-grid > :nth-child(3) .tariff-btn { color: var(--gold); border-color: var(--gold); }
.tariffs-grid > :nth-child(3) .tariff-btn:hover { background: var(--gold); color:#1a1a1a; }

/* stages */
.stages-grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap:30px; max-width:1200px; margin:0 auto 80px; padding:0 20px; }
.stage-card { background:#1f1f21; border:1px solid rgba(255,255,255,0.05); border-radius:20px; padding:30px; position:relative; overflow:hidden; transition: transform .3s; }
.stage-card:hover { transform: translateY(-5px); }
.stage-number { position:absolute; top:-15px; right:-10px; font-size:120px; font-weight:900; color: rgba(255,255,255,0.02); line-height:1; pointer-events:none; }
.stage-icon { width:60px; height:60px; background: rgba(0,119,255,0.10); border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 0 20px; color: var(--vk); }
.stage-card h3 { font-size:20px; margin:0 0 15px; color:#fff; }
.stage-card h3 span { color: var(--vk); }
.stage-card p { color: var(--text-sec); line-height:1.6; font-size:14px; margin:0; }

@media (max-width: 900px) { .tariffs-grid { grid-template-columns: 1fr; } }

</style>
<link rel="icon" type="image/png" href="https://vk.com/images/camera_50.png">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

<style>
/* v68 STYLES */
.card-overlay { display: none !important; }

::-webkit-scrollbar { width: 10px; background: transparent; }
::-webkit-scrollbar-track { background: rgba(255,255,255,0.04); }
::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.18); border-radius: 10px; border: 2px solid rgba(20,20,20,1); }
::-webkit-scrollbar-thumb:hover { background: rgba(0,119,255,0.55); }

.scroll-top-link { background: transparent !important; border: none !important; opacity: 0.5 !important; transition: opacity 0.3s !important; }
.scroll-top-link:hover { opacity: 1 !important; transform: translateY(-3px); }
.scroll-top-link.visible { opacity: 0.5; pointer-events: auto; }

.ref-overlay-btn { background: rgba(0,0,0,0.3) !important; border: 1.5px solid rgba(255,255,255,0.3) !important; width: 36px !important; height: 36px !important; transition: all 0.3s !important; opacity: 0; backdrop-filter: blur(4px); }
.ref-overlay-btn:hover { opacity: 1 !important; border-color: #fff !important; transform: scale(1.1) rotate(90deg); background: rgba(0,0,0,0.6) !important; }
.ref-overlay-btn.active { background: rgba(0,119,255,0.9) !important; border-color: #0077ff !important; opacity: 1 !important; }

#months-bar { display:none; justify-content:center; flex-wrap:wrap; gap:10px; margin:-8px 0 18px; padding: 0 4%; }
.month-chip { background: transparent; border: 1px solid #444; color:#888; padding: 6px 14px; border-radius: 20px; cursor: pointer; font-size: 14px; transition: all 0.2s; }
.month-chip:hover { border-color: rgba(255,255,255,0.5); color:#fff; }
.month-chip.active { background: rgba(0,119,255,0.25); border-color: rgba(0,119,255,0.65); color:#fff; }

body { cursor: none; }
@media (hover: none) { body { cursor: auto; } }
.custom-cursor { width: 20px; height: 20px; border: 1px solid rgba(255,255,255,0.8); border-radius: 50%; position: fixed; pointer-events: none; z-index: 10001; transform: translate(-50%, -50%); mix-blend-mode: difference; display:block; }
.custom-cursor-dot { width: 4px; height: 4px; background: white; border-radius: 50%; position: fixed; pointer-events: none; z-index: 10001; transform: translate(-50%, -50%); mix-blend-mode: difference; display:block; }
.custom-cursor.hover { width: 50px; height: 50px; background: white; mix-blend-mode: exclusion; border-color: transparent; }

/* TOAST TOP RIGHT */
#toast-notification {
    position: fixed; top: 30px; right: 30px; left: auto; transform: translateX(120%);
    background: rgba(20, 20, 20, 0.95); border: 1px solid rgba(255,255,255,0.2);
    color: #fff; padding: 12px 24px; border-radius: 12px;
    z-index: 10000; transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    backdrop-filter: blur(10px); box-shadow: 0 10px 30px rgba(0,0,0,0.6);
    font-size: 14px; font-weight: 500; display: flex; align-items: center; gap: 10px; pointer-events: none;
}
#toast-notification.show { transform: translateX(0); }

/* Rating Styles */
#header-rating:hover svg { fill: #FFD700; }

/* FIX BUTTONS & COLORS */
.profile-actions { 
    display: flex; 
    justify-content: center; 
    gap: 12px; 
    flex-wrap: wrap; 
}
.btn-primary, .header-btn, .btn-profile {
    flex: 0 0 auto; 
    white-space: nowrap; 
    min-width: fit-content;
    padding: 10px 20px !important;
}
/* Restore Colors if lost (User said "Red and Blue") */
/* Original CSS usually handles .btn-primary (Red) and .header-btn (Blue) */
/* I will reinforce them just in case */
.btn-primary { background-color: #ff5252 !important; color: white !important; border: none !important; }
.header-btn { background-color: #0077ff !important; color: white !important; border: none !important; }
.btn-reviews { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); }

/* VERIFIED ICON BG */
#verified-icon-container {
    background: white; 
    border-radius: 50%; 
    width: 14px; height: 14px; 
    display: flex; align-items: center; justify-content: center;
    margin-left: 6px;
    position: relative;
}
#verified-icon {
    position: absolute;
    width: 20px; height: 20px;
}

#notificationModal {
    z-index: 100000 !important;
}
.notification-item {
    z-index: 100001 !important;
    position: relative;
}
/* Animation for preview icon */
.preview-icon, .overlay svg {
    transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}
.card:hover .preview-icon, .card:hover .overlay svg {
    transform: scale(1.2) rotate(5deg);
}
/* Modal Order Button */
.btn-order-modal {
    background: var(--vk);
    color: #fff;
    margin-left: 10px;
    border: none;
    box-shadow: 0 4px 12px rgba(0, 119, 255, 0.3);
}
.btn-order-modal:hover {
    background: var(--vk-hover);
    transform: translateY(-2px);
}


#scroll-top { opacity: 0; visibility: hidden; pointer-events: none; transition: all 0.3s; }
#scroll-top.visible { opacity: 1; visibility: visible; pointer-events: auto; }

</style>


<style>
/* BUTTON FIXES */
.header-btn {
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    gap: 8px !important;
    white-space: nowrap !important;
    height: 44px !important;
    padding: 0 20px !important;
}
.header-btn svg {
    display: block !important;
    width: 20px !important;
    height: 20px !important;
    min-width: 20px !important;
    fill: currentColor !important;
    margin: 0 !important;
}
.profile-actions {
    display: flex !important;
    gap: 12px !important;
    align-items: center !important;
}

/* GALLERY FIXES (Ensure containers are visible) */
#months-bar {
    display: flex;
    gap: 10px;
    overflow-x: auto;
    padding: 10px 0;
    scrollbar-width: none;
}
#months-bar::-webkit-scrollbar { display: none; }

#notificationModal {
    z-index: 100000 !important;
}
.notification-item {
    z-index: 100001 !important;
    position: relative;
}
/* Animation for preview icon */
.preview-icon, .overlay svg {
    transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}
.card:hover .preview-icon, .card:hover .overlay svg {
    transform: scale(1.2) rotate(5deg);
}
/* Modal Order Button */
.btn-order-modal {
    background: var(--vk);
    color: #fff;
    margin-left: 10px;
    border: none;
    box-shadow: 0 4px 12px rgba(0, 119, 255, 0.3);
}
.btn-order-modal:hover {
    background: var(--vk-hover);
    transform: translateY(-2px);
}


#scroll-top { opacity: 0; visibility: hidden; pointer-events: none; transition: all 0.3s; }
#scroll-top.visible { opacity: 1; visibility: visible; pointer-events: auto; }

</style>

<style>
:root{
    --vk: #0077FF;
    --vk-hover: #0066CC;
    --bg-color: #141414; 
    --card-bg: #1f1f21;
    --text-main: #ffffff;
    --text-sec: #9fa0a5;
    --border: rgba(255,255,255,0.08);
    --glass: rgba(20, 20, 20, 0.85);
}

body{
    font-family: 'Manrope', system-ui, sans-serif;
    background: var(--bg-color);
    color: var(--text-main);
    margin:0;
    min-height: 100vh;
    cursor: none; /* Скрываем стандартный курсор */
}


/* HEADER PROGRESS BAR */
#header-progress {
    position: absolute;
    top: 0;
    left: 0;
    height: 3px;
    background: var(--vk);
    width: 0%;
    transition: width 0.1s linear, opacity 0.3s;
    z-index: 102;
    opacity: 0;
    pointer-events: none;
    box-shadow: 0 0 10px var(--vk);
}

/* CUSTOM CURSOR */
.cursor-dot,
.cursor-outline {
    position: fixed;
    top: 0;
    left: 0;
    transform: translate(-50%, -50%);
    border-radius: 50%;
    z-index: 9999;
    pointer-events: none;
}
.cursor-dot {
    width: 8px;
    height: 8px;
    background-color: var(--vk);
}
.cursor-outline {
    width: 40px;
    height: 40px;
    border: 1px solid rgba(255, 255, 255, 0.5);
    transition: width 0.2s, height 0.2s, background-color 0.2s;
}
body:hover .cursor-outline.hovered {
    width: 60px;
    height: 60px;
    background-color: rgba(255, 255, 255, 0.1);
    border-color: transparent;
    backdrop-filter: blur(2px);
}
/* Скрываем кастомный курсор на тач-устройствах */
@media (hover: none) and (pointer: coarse) {
    .cursor-dot, .cursor-outline { display: none; }
    body { cursor: auto; }
}

.container{max-width:1440px;margin:auto;padding:20px;}

/* PROFILE HEADER */
.profile-header {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    margin-bottom: 40px;
    margin-top: 20px;
    animation: fadeIn 0.8s ease;
}

.profile-avatar {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    border: 3px solid #2a2a2c;
    margin-bottom: 16px;
    object-fit: cover;
    background: #2a2a2c;
}

.profile-name {
    font-size: 26px;
    font-weight: 800;
    margin: 0 0 6px 0;
    letter-spacing: 0.5px;
}

.profile-desc {
    font-size: 15px;
    color: #d1d1d6;
    max-width: 600px;
    margin: 0 auto 12px auto;
    line-height: 1.5;
}

.profile-meta {
    font-size: 14px;
    color: var(--text-sec);
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 24px;
}

.profile-actions {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    justify-content: center;
}

.btn-profile {
    padding: 10px 24px;
    border-radius: 12px;
    text-decoration: none;
    font-weight: 600;
    font-size: 14px;
    transition: all 0.2s;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    cursor: none; /* Для кастомного курсора */
}

.btn-sub {
    background: var(--vk);
    color: #fff;
}
.btn-sub:hover { background: var(--vk-hover); transform: translateY(-2px); box-shadow: 0 4px 15px rgba(0,119,255,0.3); }

.btn-reviews {
    background: rgba(255,255,255,0.08);
    color: #fff;
    border: 1px solid var(--border);
}
.btn-reviews:hover { background: rgba(255,255,255,0.15); transform: translateY(-2px); }

/* HEADER STICKY */
.header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    margin-bottom:20px;
    position:sticky;
    top:20px;
    background: var(--glass);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    z-index:100;
    padding:12px 20px;
    border-radius: 24px;
    border: 1px solid var(--border);
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
}

h1{font-size:18px;font-weight:700;margin:0;flex:1;text-align:center;color:var(--text-main); letter-spacing: 0.5px;}
.subtitle{font-size:13px;color:var(--text-sec);text-align:center;font-weight: 500;}

.btn{
    background:rgba(255,255,255,0.05);
    border:1px solid var(--border);
    width:44px;height:44px;
    border-radius:14px;
    cursor:none; /* custom cursor */
    display:flex;align-items:center;justify-content:center;
    color:var(--text-main);
    transition:all .3s cubic-bezier(0.25, 0.8, 0.25, 1);
}
.btn:hover{background:rgba(255,255,255,0.15); transform: scale(1.05);}
.btn.active{background:var(--vk);border-color:var(--vk); box-shadow: 0 0 15px rgba(0,119,255,0.4);}

/* TAGS FILTER */
.tags-container {
    display: flex;
    gap: 10px;
    overflow-x: auto;
    padding-bottom: 15px;
    margin-bottom: 15px;
    scrollbar-width: none;
}
.tags-container::-webkit-scrollbar { display: none; }
.tag-chip {
    padding: 8px 16px;
    background: rgba(255,255,255,0.05);
    border: 1px solid var(--border);
    border-radius: 20px;
    font-size: 13px;
    white-space: nowrap;
    cursor: none;
    transition: .2s;
    color: var(--text-sec);
}
.tag-chip:hover { background: rgba(255,255,255,0.1); color: #fff; }
.tag-chip.active { background: var(--vk); color: #fff; border-color: var(--vk); }

/* GRID LAYOUTS */
.grid{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(320px,1fr));
    gap:24px;
    padding-top: 10px;
}

.masonry-wrap {
    display: flex;
    gap: 20px;
    width: 100%;
    align-items: flex-start;
}
.masonry-col {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 20px;
    min-width: 0;
}

/* CARDS */
.card{
    background:var(--card-bg);
    border-radius:24px;
    overflow:hidden;
    cursor:none;
    border:1px solid var(--border);
    box-shadow:0 4px 20px rgba(0,0,0,0.2);
    transition:all .4s cubic-bezier(0.25, 0.8, 0.25, 1);
    position: relative;
}
.card:hover{transform:translateY(-8px) scale(1.01);box-shadow:0 20px 40px rgba(0,0,0,0.4); border-color: rgba(255,255,255,0.2);}

.card-img{position:relative;width:100%;padding-top:85%;overflow:hidden;background:#2c2c2e;}
.card-img img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;opacity:0;transition:opacity .6s ease; filter: brightness(0.9);}
.card:hover .card-img img { filter: brightness(1.1); transform: scale(1.05); transition: transform 0.6s, opacity 0.6s, filter 0.6s;}
.card-img img.loaded{opacity:1}

.card-icon-center {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
}

.card-info {
    padding: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.card-title{font-size:16px;color:var(--text-main);font-weight:600; line-height: 1.3;}
.card-count {
    background: rgba(255,255,255,0.1);
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 13px;
    color: var(--text-sec);
    font-weight: 600;
}

/* MARKET ITEMS (SERVICES) */
.market-card {
    background: var(--card-bg);
    border-radius: 24px;
    overflow: hidden;
    border: 1px solid var(--border);
    cursor: none;
    transition: .3s;
}
.market-card:hover { transform: translateY(-5px); border-color: var(--vk); }
.market-img { width: 100%; height: 250px; object-fit: cover; background: #2c2c2e; }
.market-content { padding: 20px; }
.market-title { font-size: 16px; font-weight: 700; margin-bottom: 8px; color: #fff; }
.market-price { font-size: 18px; font-weight: 800; color: var(--vk); margin-bottom: 15px; }
.market-btn { 
    width: 100%; padding: 12px; background: rgba(255,255,255,0.1); 
    border-radius: 12px; text-align: center; font-weight: 600; 
    transition: .2s; color: #fff; cursor: none;
}
.market-card:hover .market-btn { background: var(--vk); }

/* PHOTO ITEMS */
.photo-item{
    border-radius:16px;
    overflow:hidden;
    cursor:none;
    box-shadow:0 4px 15px rgba(0,0,0,0.2);
    transition:.3s;
    position:relative;
    background: #2c2c2e;
    width: 100%;
}
.photo-item:hover { filter: brightness(1.1); transform: translateY(-4px); }

.img-container {
    position: relative;
    width: 100%;
    overflow: hidden;
    background: #232325;
}
.img-container img{
    position:absolute;
    top: 0; left: 0;
    width:100%;
    height:100%;
    object-fit:cover;
    transition:opacity .5s ease;
    opacity:0;
}
.img-container img.loaded{opacity:1}

/* REVIEWS STYLE */
.review-card {
    background: var(--card-bg);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 20px;
    margin-bottom: 20px;
    display: flex;
    gap: 15px;
    transition: transform 0.2s;
    cursor: none;
}
.review-card:hover { transform: translateY(-3px); border-color: rgba(255,255,255,0.2); background: #262629; }
.review-avatar {
    width: 48px; height: 48px;
    border-radius: 50%;
    object-fit: cover;
    background: #333;
    flex-shrink: 0;
}
.review-content { flex: 1; }
.review-header {
    display: flex; justify-content: space-between; margin-bottom: 8px;
}
.review-name {
    font-weight: 700; font-size: 15px; color: var(--text-main);
    text-decoration: none;
    pointer-events: none; /* Let card handle click */
}
.review-date { font-size: 12px; color: var(--text-sec); }
.review-text {
    font-size: 14px; line-height: 1.5; color: #d1d1d6;
    white-space: pre-wrap;
}

/* SKELETONS */
.skel {
    width: 100%;
    background: linear-gradient(110deg, #232325 8%, #2c2c2e 18%, #232325 33%);
    background-size: 200% 100%;
    animation: shine 1.5s linear infinite;
    border-radius: 16px;
}
@keyframes shine { to { background-position-x: -200%; } }

/* SCROLL TO TOP */
.scroll-top {
    position: fixed;
    bottom: 30px;
    right: 30px;
    width: 50px;
    height: 50px;
    background: var(--vk);
    color: #fff;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: none;
    box-shadow: 0 10px 30px rgba(0,119,255,0.4);
    opacity: 0;
    visibility: hidden;
    transform: translateY(20px);
    transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    z-index: 90;
    border: none;
}
.scroll-top.visible {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}
.scroll-top:hover {
    background: var(--vk-hover);
    transform: translateY(-5px);
}

/* MODAL */
#modal,#order-modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.9);backdrop-filter: blur(10px);align-items:center;justify-content:center;opacity:0;transition:opacity .4s;padding:20px;box-sizing:border-box;z-index:2000;cursor:none}
#modal.open,#order-modal.open{display:flex;opacity:1}
.modal-content{
    max-width:1400px;
    width:100%;
    display:flex;
    background:#1c1c1e;
    border-radius:24px;
    overflow:hidden;
    position:relative;
    height:85vh;
    box-shadow:0 30px 80px rgba(0,0,0,0.8);
    cursor:default;
    border: 1px solid var(--border);
    transition: transform 0.2s; /* Для свайпа */
}

.modal-left{flex:1;display:flex;flex-direction:column;background:#000;position:relative}
.modal-img{flex:1;display:flex;align-items:center;justify-content:center;overflow:hidden;position:relative; cursor: zoom-in;}

.modal-img img{max-width:100%;max-height:100%;object-fit:contain; transition: transform 0.4s ease;}
.modal-img.zoomed { 
    cursor: zoom-out; 
    align-items: flex-start; 
    justify-content: flex-start; 
    overflow: auto;
}
.modal-img.zoomed img { 
    transform-origin: var(--mouse-x, 50%) var(--mouse-y, 50%);
    transform: scale(2); 
}

.modal-preview{opacity:1;transition:opacity .3s}
.modal-full{position:absolute;opacity:0;transition:opacity .5s}
.modal-full.loaded{opacity:1}
.modal-preview.faded{opacity:0}

.modal-bottom-bar{
    height:60px;
    background:rgba(20,20,20,0.8);
    display:flex;
    align-items:center;
    padding:0 25px;
    justify-content:space-between;
    color:#888;
    font-size:14px; 
    border-top: 1px solid #333;
}
.modal-bottom-bar .left {
    display: flex;
    align-items: center;
    gap: 20px;
}
.modal-bottom-bar .right {
    display: flex;
    align-items: center;
    gap: 20px;
}
.vk-link-bottom{color:var(--text-sec);text-decoration:none; transition: .2s; cursor: none;}
.vk-link-bottom:hover{color:var(--vk);}

.more-actions {
    position: relative;
}
.more-btn {
    color: var(--text-sec);
    cursor: none;
    padding: 8px;
    border-radius: 8px;
    transition: .2s;
}
.more-btn:hover {
    background: rgba(255,255,255,0.1);
}
.more-menu {
    position: absolute;
    bottom: 100%;
    right: 0;
    background: #1c1c1e;
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 8px 0;
    min-width: 220px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    display: none;
    flex-direction: column;
}
.more-menu a {
    padding: 12px 20px;
    color: var(--text-main);
    text-decoration: none;
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 12px;
    transition: .2s;
}
.more-menu a:hover {
    background: rgba(255,255,255,0.1);
}
.more-actions:hover .more-menu {
    display: flex;
}

/* RIGHT PANEL */
.modal-right{width:400px;display:flex;flex-direction:column;background:#1c1c1e;border-left:1px solid var(--border);position:relative}
.modal-info-scroll{flex:1;overflow-y:auto;padding:30px; position: relative;}
.modal-info-scroll::-webkit-scrollbar {width: 6px;}
.modal-info-scroll::-webkit-scrollbar-thumb {background: #3a3a3c; border-radius: 3px;}

.modal-header{display:flex;align-items:center;gap:14px;margin-bottom:20px;text-decoration:none;color:inherit; margin-right: 40px; cursor: none;}
.modal-avatar{width:48px;height:48px;border-radius:50%; border: 2px solid var(--border);}
.modal-author{font-weight:700;font-size:15px;color:var(--text-main); margin-bottom: 2px;}
.modal-date{font-size:12px;color:var(--text-sec)}

.modal-text{font-size:14px;line-height:1.6;margin-bottom:15px;white-space:pre-wrap;color:#d1d1d6;position:relative;overflow:hidden}
.modal-text.collapsed{max-height:100px; mask-image: linear-gradient(to bottom, black 50%, transparent 100%);}
.show-more-btn{color:var(--vk);cursor:none;font-size:13px;font-weight: 600;display:none;margin-bottom:25px}
.show-more-btn.active{display:block}

.order-btn{
    background:var(--vk);
    color:#fff;
    border:none;
    padding:16px;
    border-radius:16px;
    width:100%;
    font-weight:700;
    font-size:15px;
    cursor:none;
    margin-bottom:30px;
    transition:.2s;
    box-shadow: 0 4px 15px rgba(0, 119, 255, 0.3);
}
.order-btn:hover{background:var(--vk-hover);transform:translateY(-2px); box-shadow: 0 8px 25px rgba(0, 119, 255, 0.4);}

.modal-actions-bar{display:flex;gap:20px;padding-bottom:20px;border-bottom:1px solid var(--border);margin-bottom:20px}
.action-item{display:flex;align-items:center;gap:6px;color:var(--text-sec);font-size:14px;font-weight:600}
.action-item svg{fill:var(--text-sec); transition: .2s}
.has-likes svg{fill:#ff3347}

/* COMMENTS */
.comments-section{margin-top:10px}
.comment-item{display:flex;gap:12px;margin-bottom:20px}
.comment-avatar{width:36px;height:36px;border-radius:50%;object-fit:cover; border: 1px solid var(--border); flex-shrink: 0; background: #333;}
.comment-body {flex: 1; min-width: 0;}
.comment-name{font-weight:600;color:var(--text-main);font-size:13px;margin-right:5px;cursor:none; transition: .2s;}
.comment-name:hover {color: var(--vk);}
.comment-text{font-size:13px;line-height:1.5;margin-bottom:6px; color: #ccc; word-wrap: break-word;}

/* ATTACHMENTS IN COMMENTS */
.comment-attachments { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px; }
.comment-attach-img { width: 100px; height: 100px; object-fit: cover; border-radius: 8px; cursor: none; border: 1px solid rgba(255,255,255,0.1); }
.comment-attach-img:hover { opacity: 0.8; }

.nav{position:absolute;top:50%;transform:translateY(-50%);width:60px;height:60px;background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.1);backdrop-filter: blur(5px);cursor:none;display:flex;align-items:center;justify-content:center;color:#fff;font-size:24px;border-radius:50%;z-index:10;transition:0.3s}
.nav:hover{background:rgba(255,255,255,0.25); transform: translateY(-50%) scale(1.1);}
.nav-left{left:20px}.nav-right{right:20px}

/* SINGLE CLOSE BUTTON */
.close-in-modal{
    position:absolute;
    top: 20px;
    right: 20px;
    background:rgba(255,255,255,0.1);
    border-radius:50%;
    width:36px;
    height:36px;
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:none;
    color:#fff;
    border:none;
    z-index:20; 
    transition: .2s;
}
.close-in-modal:hover{background: rgba(255,255,255,0.25);}
.close-in-modal svg {width: 20px; height: 20px; stroke: currentColor; stroke-width: 2.5;}

/* CONTACT MODAL */
.order-choice{background:#1c1c1e;padding:40px;border-radius:30px;max-width:380px;width:100%;text-align:center;position:relative; border: 1px solid var(--border); box-shadow: 0 20px 60px rgba(0,0,0,0.5);}
.order-choice h2{margin-top:0;font-size:22px;margin-bottom:12px; color: #fff;}
.order-choice p{color:var(--text-sec);font-size:15px;margin-bottom:30px; line-height: 1.4;}
.contact-list{display:flex;flex-direction:column;gap:12px}
.contact-link{display:flex;align-items:center;justify-content:center;gap:12px;padding:16px;border-radius:16px;text-decoration:none;font-weight:600;transition:.2s;color:#fff; font-size: 15px; cursor: none;}
.link-vk{background:#0077FF}.link-vk:hover{background:#0066CC}
.link-tg{background:#24A1DE}.link-tg:hover{background:#1d85b9}

/* Empty State */
.empty-album{text-align:center;padding:100px 20px;color:var(--text-sec);font-size:18px}

/* Comments loader */
.comments-loader svg{width:32px;height:32px;animation:spin 1s linear infinite; stroke: var(--text-sec);}
@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}

/* FLOATING MESSAGE BUBBLE - DARK STYLE */
.message-bubble {
    position: fixed;
    bottom: 30px;
    right: 30px;
    background: var(--card-bg);
    color: var(--text-main);
    border-radius: 20px;
    padding: 16px 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.4);
    max-width: 320px;
    z-index: 95;
    cursor: pointer;
    transition: transform 0.3s, opacity 0.3s;
    display: flex;
    align-items: center;
    gap: 14px;
    border: 1px solid var(--border);
}
.message-bubble:hover {
    transform: translateY(-5px);
}
.message-bubble img {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    object-fit: cover;
}
.message-bubble-text {
    flex: 1;
}
.message-bubble-title {
    font-weight: 700;
    font-size: 15px;
    margin-bottom: 4px;
}
.message-bubble-desc {
    font-size: 14px;
    color: var(--text-sec);
}
.message-bubble-btn {
    background: var(--vk);
    color: #fff;
    padding: 8px 16px;
    border-radius: 30px;
    font-size: 14px;
    font-weight: 600;
    margin-top: 10px;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

@media(max-width:1000px){
  .message-bubble {bottom: 90px; right: 20px; max-width: 280px;}
}
@keyframes fadeIn {from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

.skel { margin-bottom: 15px; }
.header-btn {
    display: inline-flex; align-items: center; justify-content: center;
    padding: 0 20px; border-radius: 12px; text-decoration: none; font-weight: 500;
    margin-right: 12px; cursor: pointer; border: none; font-size: 15px; height: 44px;
    box-sizing: border-box; vertical-align: middle; font-family: -apple-system, BlinkMacSystemFont, 'Roboto', sans-serif; 
}
.header-btn svg { margin-right: 8px; width: 20px; height: 20px; display: block; fill: currentColor; }
.header-btn-red { background-color: #e54643; color: #fff; }
.header-btn-red:hover { background-color: #d43f3c; }
.header-profile a, .header-profile button { text-decoration: none; }


.ref-btn { display: inline-flex; align-items: center; justify-content: center; background: #333; color: #fff; padding: 10px 20px; border-radius: 8px; margin-top: 15px; cursor: pointer; font-size: 14px; border:none; width: 100%; box-sizing: border-box; }
.ref-btn.active { background: #4caf50; }
.ref-btn:hover { background: #444; }
.ref-btn.active:hover { background: #45a049; }
#ref-bar { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: #222; color: #fff; padding: 12px 24px; border-radius: 50px; display: none; align-items: center; gap: 15px; z-index: 9999; box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
#ref-bar.visible { display: flex; }
.ref-copy-btn { background: #0077FF; color: #fff; border: none; padding: 6px 12px; border-radius: 15px; cursor: pointer; font-size: 13px; }
.ref-clear-btn { background: transparent; color: #aaa; border: none; cursor: pointer; font-size: 18px; }


.modal-buttons-row { display: flex; gap: 12px; margin-top: 15px; width: 100%; align-items: stretch; }
#ref-btn-container { display: flex; flex: 1; margin: 0; padding: 0; }
.order-btn, .ref-btn {
    flex: 1;
    border: none; border-radius: 12px;
    height: 44px; font-size: 14px; font-weight: 500; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    padding: 0 10px;
    white-space: nowrap;
    text-decoration: none;
    box-sizing: border-box;
}
.order-btn { background: #0077FF; color: #fff; }
.ref-btn { background: #2a2a2c; color: #fff; margin: 0 !important; width: 100%; }
.ref-btn.active { background: #4caf50; }
.order-btn svg, .ref-btn svg { margin-right: 8px; width: 20px; height: 20px; fill: currentColor; flex-shrink: 0; }

#toast {
    position: fixed; top: 20px; right: 20px; background: #333; color: #fff;
    padding: 12px 24px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    z-index: 10000; opacity: 0; transition: opacity 0.3s; pointer-events: none; font-weight: 500;
}
#toast.show { opacity: 1; }

.modal-img-container { flex: 1; display: flex; align-items: center; justify-content: center; overflow: hidden; position: relative; width: 100%; height: 100%; min-height: 0; }
.modal-img-container img { max-width: 100%; max-height: 100%; width: auto; height: auto; object-fit: contain; display: block; }
.modal-img-container.zoomed img { max-width: none; max-height: none; cursor: zoom-out; }


.loader-spinner { position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); width:40px; height:40px; border:3px solid rgba(255,255,255,0.1); border-radius:50%; border-top-color:#0077FF; animation:spin 0.8s linear infinite; z-index:10; opacity:0; transition:opacity 0.3s; pointer-events:none; }
.loader-spinner.active { opacity:1; }
@keyframes spin { 100% { transform: translate(-50%, -50%) rotate(360deg); } }
#preview { transition: filter 0.3s ease, opacity 0.3s ease; }
#preview.blur { filter: blur(15px); opacity: 0.8; }


.footer-socials{display:flex;flex-wrap:wrap;justify-content:flex-start;gap:24px;margin-top:100px;margin-bottom:36px;padding-top:18px;border-top:1px solid var(--border);}
.footer-link{flex:0 0 auto;display:inline-flex;align-items:center;gap:12px;padding:10px 14px;border-radius:14px;text-decoration:none;background:transparent;border:1px solid transparent;transition:.2s;cursor:pointer;}
.footer-link:hover{background:rgba(255,255,255,.03);border-color:rgba(255,255,255,.1);}
.footer-icon{width:42px;height:42px;border-radius:12px;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,.05);flex-shrink:0;}
.footer-icon svg{width:22px;height:22px;display:block;margin:auto;}
.vk-group-icon{color:#9aa0a6;}.tg-icon{color:#9aa0a6;}.vk-user-icon{color:#9aa0a6;}.be-icon{color:#9aa0a6;}.pin-icon{color:#9aa0a6;}
.footer-text{display:flex;flex-direction:column;line-height:1.05;}
.footer-title{font-size:13px;font-weight:700;color:var(--text-main);margin-bottom:2px;}
.footer-sub{font-size:11px;color:var(--text-sec);opacity:.72;}
@media(max-width:700px){.footer-link{width:100%;}}


.scroll-top-link {
    position: fixed !important;
    top: 20px !important;
    left: 20px !important;
    bottom: auto !important;
    right: auto !important;
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
    color: var(--text-sec);
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    background: transparent;
    border-radius: 8px;
    transition: opacity 0.3s, background 0.2s;
    z-index: 90;
    opacity: 0;
    pointer-events: none;
}
.scroll-top-link.visible { opacity: 0.7; pointer-events: auto; }
.scroll-top-link.visible:hover { opacity: 1; background: rgba(255,255,255,0.05); }
.scroll-top-link svg { color: var(--text-sec); }
@media(max-width: 1000px) { .scroll-top-link { display: none; } } 


.modal-progress-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: rgba(255,255,255,0.1);
    z-index: 99999;
    pointer-events: none;
}
#modal-progress-bar {
    height: 100%;
    background: #0077FF;
    width: 0%;
    transition: width 0.1s linear;
    box-shadow: 0 0 8px #0077FF;
}
.message-bubble {
    position: fixed;
    bottom: 30px;
    right: 30px;
    /* ensure relative for absolute child if not fixed? But fixed works too for child absolute */
    /* Wait, message-bubble is already defined in base css. I should just append specific overrides. */
    /* To be safe, I won't redefine .message-bubble main props, just position context if needed. */
    /* Actually, fixed element can contain absolute elements relative to it. */
}
.message-bubble-close {
    position: absolute;
    top: 10px;
    right: 10px;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-sec);
    opacity: 0.5;
    cursor: pointer;
    transition: 0.2s;
    border-radius: 50%;
    background: transparent;
}
.message-bubble-close:hover { opacity: 1; background: rgba(255,255,255,0.1); color: #fff; }


/* GRID & MOBILE */
@media (max-width: 768px) {
    .navbar { display: none; flex-direction: column; position: absolute; top: 100%; left: 0; width: 100%; background: #000; padding: 20px; box-sizing:border-box; }
    .navbar.active { display: flex; }
    #menu-icon { display: block !important; font-size: 30px; cursor: pointer; color: #fff; padding-right:20px; }
    .services-container, .portfolio-container { flex-direction: column; }
    .grid { grid-template-columns: 1fr !important; }
}
.grid { grid-template-columns: repeat(auto-fill, 320px) !important; justify-content: center; }

/* PROGRESS BAR */
#modal-progress-bar { position: fixed; top: 0; left: 0; height: 4px; background: #0077ff; width: 0%; z-index: 100001; transition: width 0.2s; }

/* LEFT SCROLL */
#left-scroll-area { position: fixed; top: 0; left: 0; width: 80px; height: 100vh; z-index: 9998; cursor: pointer; }
#left-scroll-area:hover { background: rgba(255,255,255,0.02); }
#scroll-indicator { position: fixed; top: 50%; left: 20px; transform: translateY(-50%); color: rgba(255,255,255,0.3); font-size: 24px; pointer-events: none; z-index: 9999; transition: opacity 0.3s; opacity: 0; }
#left-scroll-area:hover + #scroll-indicator { opacity: 1; }

/* REF BAR */
#ref-bar { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); display: none; gap: 10px; padding: 10px 15px; background: rgba(20,20,20,0.9); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; z-index: 10000; align-items: center; color: white; }
#ref-bar.visible { display: flex; }
.ref-btn-icon { background: rgba(255,255,255,0.1); border: none; color: white; padding: 8px 12px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 6px; font-size: 13px; }
.ref-btn-icon:hover { background: rgba(255,255,255,0.2); }

/* OVERLAY BUTTON */
.ref-overlay-btn { position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.6); color: white; border: 1px solid rgba(255,255,255,0.3); width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; opacity: 0; transition: all 0.2s; z-index: 10; }
.ref-overlay-btn.active { background: #0077ff; border-color: #0077ff; opacity: 1; }
.photo-item:hover .ref-overlay-btn { opacity: 1; }
.ref-overlay-btn:hover { background: rgba(255,255,255,0.2); transform: scale(1.1); }

/* SUBSCRIBE */
.btn-subscribed { background: #2a2a2a !important; color: #888 !important; border-color: #444 !important; }

/* YEARS BAR */
#years-bar { display: none; justify-content: center; flex-wrap: wrap; gap: 10px; margin: 10px 0 20px; padding: 0 4%; }
.year-chip { background: transparent; border: 1px solid #444; color: #888; padding: 6px 14px; border-radius: 20px; cursor: pointer; font-size: 14px; transition: all 0.2s; }
.year-chip:hover { border-color: #777; color: #fff; }
.year-chip.active { background: #fff; color: #000; border-color: #fff; }


#notificationModal {
    z-index: 100000 !important;
}
.notification-item {
    z-index: 100001 !important;
    position: relative;
}
/* Animation for preview icon */
.preview-icon, .overlay svg {
    transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}
.card:hover .preview-icon, .card:hover .overlay svg {
    transform: scale(1.2) rotate(5deg);
}
/* Modal Order Button */
.btn-order-modal {
    background: var(--vk);
    color: #fff;
    margin-left: 10px;
    border: none;
    box-shadow: 0 4px 12px rgba(0, 119, 255, 0.3);
}
.btn-order-modal:hover {
    background: var(--vk-hover);
    transform: translateY(-2px);
}


#scroll-top { opacity: 0; visibility: hidden; pointer-events: none; transition: all 0.3s; }
#scroll-top.visible { opacity: 1; visibility: visible; pointer-events: auto; }

</style>
<style>
.profile-avatar { transition: transform 0.3s ease; } .profile-main-link:hover .profile-avatar { transform: scale(1.05); }
.profile-main-link:hover .profile-name { opacity: 0.7; transition: opacity 0.2s; } .hover-subs { transition: opacity 0.2s; } .hover-subs:hover { opacity: 0.7; }
a.profile-meta { display: flex; align-items: center; justify-content: center; gap: 8px; }
::selection { background: #e54643; color: white; } ::-moz-selection { background: #e54643; color: white; }
.iframe-container { -webkit-overflow-scrolling: touch; overflow-y: auto; }
</style>
</head>
<body><div id="modal-progress-bar"></div>




<div class="container">
  
  <div id="profile-header" class="profile-header"></div>

  <div class="header">
    <button id="back" class="btn" onclick="goBack()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" width="22" stroke-width="2.5"><path d="M15 18l-6-6 6-6"/></svg>
    </button>
    <div>
      <h1 id="title">ПОРТФОЛИО</h1>
      <div id="subtitle" class="subtitle"></div>
    </div>
    <button id="sort" class="btn" onclick="toggleChronological()" title="Сменить порядок">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" width="22" stroke-width="2.5"><path d="M7 15l5 5 5-5M7 9l5-5 5 5"/></svg>
    </button>
    <div id="header-progress"></div>
  </div>
  
  
  <div class="tab-nav">
    <button class="tab-btn active" onclick="switchTab('portfolio', this)">Портфолио</button>
    <button class="tab-btn" onclick="switchTab('tariffs', this)">Тарифы & Услуги</button>
  </div>
  <div id="tab-portfolio" class="tab-content" style="display:block;">
<div id="years-bar"></div>
<div id="months-bar"></div>
<div id="tags-bar" class="tags-container" style="display:none;"></div>
  
  <div id="area">Загрузка...</div>

<!-- VK VIDEO EMBEDS -->
<div id="vkvideo-section" style="max-width: 1440px; margin: 0 auto; padding: 0 20px;">
  <div style="display:flex; align-items:center; justify-content:space-between; gap: 16px; flex-wrap: wrap; margin-top: 40px; margin-bottom: 18px;">
    <h3 style="font-size: 22px; font-weight: 800; margin: 0; color: #fff;">Видео</h3>
    <a href="https://vkvideo.ru/@dsgnjr" target="_blank" rel="noopener" style="text-decoration:none; color: #0077FF; font-weight: 500; font-size: 15px; margin-left: 12px;">Показать все</a>
  </div>

  <div class="vkvideo-grid">
    
    <div class="vkvideo-item">
      <div class="vkvideo-embed">
        <iframe src="https://vkvideo.ru/video_ext.php?oid=-163936790&id=456239087&hash=7eac5b11bacb4c63&hd=3" allow="autoplay; encrypted-media; fullscreen; picture-in-picture; screen-wake-lock;" frameborder="0" allowfullscreen loading="lazy"></iframe>
      </div>
    </div>
    
    <div class="vkvideo-item">
      <div class="vkvideo-embed">
        <iframe src="https://vkvideo.ru/video_ext.php?oid=-163936790&id=456239072&hash=f516e69802be7f48&hd=3" allow="autoplay; encrypted-media; fullscreen; picture-in-picture; screen-wake-lock;" frameborder="0" allowfullscreen loading="lazy"></iframe>
      </div>
    </div>
    
    <div class="vkvideo-item">
      <div class="vkvideo-embed">
        <iframe src="https://vkvideo.ru/video_ext.php?oid=-163936790&id=456239128&hash=11744cfc1023d4b4&hd=3" allow="autoplay; encrypted-media; fullscreen; picture-in-picture; screen-wake-lock;" frameborder="0" allowfullscreen loading="lazy"></iframe>
      </div>
    </div>
    
    <div class="vkvideo-item">
      <div class="vkvideo-embed">
        <iframe src="https://vkvideo.ru/video_ext.php?oid=-163936790&id=456239127&hash=ec339c4e38aa37ac&hd=3" allow="autoplay; encrypted-media; fullscreen; picture-in-picture; screen-wake-lock;" frameborder="0" allowfullscreen loading="lazy"></iframe>
      </div>
    </div>
    
    <div class="vkvideo-item">
      <div class="vkvideo-embed">
        <iframe src="https://vkvideo.ru/video_ext.php?oid=-163936790&id=456239114&hash=782d00be1546dcf9&hd=3" allow="autoplay; encrypted-media; fullscreen; picture-in-picture; screen-wake-lock;" frameborder="0" allowfullscreen loading="lazy"></iframe>
      </div>
    </div>
    
    <div class="vkvideo-item">
      <div class="vkvideo-embed">
        <iframe src="https://vkvideo.ru/video_ext.php?oid=-163936790&id=456239102&hash=e3269a09a1e824a9&hd=3" allow="autoplay; encrypted-media; fullscreen; picture-in-picture; screen-wake-lock;" frameborder="0" allowfullscreen loading="lazy"></iframe>
      </div>
    </div>
    
    <div class="vkvideo-item">
      <div class="vkvideo-embed">
        <iframe src="https://vkvideo.ru/video_ext.php?oid=-163936790&id=456239107&hash=dccb24e21f730322&hd=3" allow="autoplay; encrypted-media; fullscreen; picture-in-picture; screen-wake-lock;" frameborder="0" allowfullscreen loading="lazy"></iframe>
      </div>
    </div>
    
<div class="vkvideo-item">
  <a class="vkvideo-placeholder" href="https://vkvideo.ru/@dsgnjr" target="_blank" rel="noopener">
    <div class="vkvideo-placeholder-inner">
      <div class="vkvideo-placeholder-title">Добавить 8-е видео</div>
      <div class="vkvideo-placeholder-sub">Пришли ссылку video_ext.php</div>
    </div>
  </a>
</div>

  </div>
</div>



  </div>
  <div id="tab-tariffs" class="tab-content" style="display:none;">
    <div class="tariff-header">
      <h2 class="section-title">Перейдем <span>к тарифам</span></h2>
      <p class="section-subtitle">Для Вас я подготовил их несколько, выберите необходимый</p>
    </div>
    <div class="tariffs-grid">
    <div class="tariff-wrapper" data-base-price="10000">
      <div class="tariff-card">
        <div class="tariff-name">
          <div class="tariff-title">Стандарт <span class="info-icon" data-tooltip="Для старта или небольшого проекта: базовая упаковка сообщества/страницы без лишних опций.">?</span></div>
        </div>
        <ul class="tariff-features">
    <li class="tariff-feature-item" data-type="base">
      <label class="item-left" style="cursor:pointer;">
        <input type="checkbox" class="feature-checkbox" data-price="0" value="Аватар" checked disabled>
        <span>Аватар <span class="info-icon" data-tooltip="Изображение профиля/сообщества: логотип или фото.">?</span></span>
      </label>
    </li>

    <li class="tariff-feature-item" data-type="base">
      <label class="item-left" style="cursor:pointer;">
        <input type="checkbox" class="feature-checkbox" data-price="0" value="Десктопная обложка" checked disabled>
        <span>Десктопная обложка <span class="info-icon" data-tooltip="Шапка для ПК версии сообщества.">?</span></span>
      </label>
    </li>

    <li class="tariff-feature-item" data-type="base">
      <label class="item-left" style="cursor:pointer;">
        <input type="checkbox" class="feature-checkbox" data-price="0" value="Мобильная статичная обложка" checked disabled>
        <span>Мобильная статичная обложка <span class="info-icon" data-tooltip="Обложка для мобильной версии (статичная картинка).">?</span></span>
      </label>
    </li>

    <li class="tariff-feature-item" data-type="base" data-mode="qty" data-unit-price="2000" data-base-qty="1" data-label="Варианты дизайна десктопной обложки" data-min="1">
      <div class="item-left">
        <input type="checkbox" class="feature-checkbox qty-checkbox" checked disabled aria-label="Обязательная позиция">
        <span>Варианты дизайна десктопной обложки <span class="info-icon" data-tooltip="Сколько концепций десктопной обложки подготовить на выбор.">?</span></span>
      </div>
      <div class="qty-control">
        <button class="qty-btn" type="button" onclick="changeQty(this, -1, 1, 6)">−</button>
        <span class="qty-val">1</span>
        <button class="qty-btn" type="button" onclick="changeQty(this, 1, 1, 6)">+</button>
      </div>
    </li>

    <li class="tariff-feature-item" data-type="base" data-mode="qty" data-unit-price="700" data-base-qty="3" data-label="Плитки виджета" data-min="3">
      <div class="item-left">
        <input type="checkbox" class="feature-checkbox qty-checkbox" checked disabled aria-label="Обязательная позиция">
        <span>Плитки виджета <span class="info-icon" data-tooltip="Минимум 3 плитки включено: можно добавить больше для витрины.">?</span></span>
      </div>
      <div class="qty-control">
        <button class="qty-btn" type="button" onclick="changeQty(this, -1, 3, 12)">−</button>
        <span class="qty-val">3</span>
        <button class="qty-btn" type="button" onclick="changeQty(this, 1, 3, 12)">+</button>
      </div>
    </li>

    <li class="tariff-feature-item" data-type="base">
      <label class="item-left" style="cursor:pointer;">
        <input type="checkbox" class="feature-checkbox" data-price="0" value="Иконки меню (до 5 шт)" checked onchange="updatePrice(this)">
        <span>Иконки меню (до 5 шт) <span class="info-icon" data-tooltip="Набор иконок для пунктов меню (до 5) с возможностью добавить больше через блок \"Доп. иконки меню\".">?</span></span>
      </label>
    </li>
    </ul>
        <div class="addon-section"><button class="addon-toggle" type="button" onclick="toggleAddons(this)"><span>+</span> Добавить услуги</button><ul class="addon-list">
    <li class="tariff-feature-item" data-type="addon" data-mode="qty" data-unit-price="300" data-base-qty="0" data-label="Доп. иконки меню" data-min="0">
      <div class="item-left">
        <input type="checkbox" class="feature-checkbox qty-checkbox" onchange="toggleQtyState(this)" aria-label="Добавить доп. иконки">
        <span>Доп. иконки меню <span class="info-icon" data-tooltip="Дополнительные иконки сверх 5 (макс. +3, итого до 8).">?</span></span>
      </div>
      <div class="qty-control">
        <button class="qty-btn" type="button" onclick="changeQty(this, -1, 0, 3)">−</button>
        <span class="qty-val">0</span>
        <button class="qty-btn" type="button" onclick="changeQty(this, 1, 0, 3)">+</button>
      </div>
    </li>

    <li class="tariff-feature-item" data-type="addon" data-mode="qty" data-unit-price="1000" data-base-qty="0" data-label="Баннер для закрепа" data-min="0">
      <div class="item-left">
        <input type="checkbox" class="feature-checkbox qty-checkbox" onchange="toggleQtyState(this)" aria-label="Добавить баннер для закрепа">
        <span>Баннер для закрепа <span class="info-icon" data-tooltip="Креатив для закрепленного поста.">?</span></span>
      </div>
      <div class="qty-control">
        <button class="qty-btn" type="button" onclick="changeQty(this, -1, 0, 10)">−</button>
        <span class="qty-val">0</span>
        <button class="qty-btn" type="button" onclick="changeQty(this, 1, 0, 10)">+</button>
      </div>
    </li>

    <li class="tariff-feature-item" data-type="addon" data-mode="qty" data-unit-price="1000" data-base-qty="0" data-label="Баннеры для рекламы" data-min="0">
      <div class="item-left">
        <input type="checkbox" class="feature-checkbox qty-checkbox" onchange="toggleQtyState(this)" aria-label="Добавить баннеры для рекламы">
        <span>Баннеры для рекламы <span class="info-icon" data-tooltip="Отдельные баннеры под рекламные размещения.">?</span></span>
      </div>
      <div class="qty-control">
        <button class="qty-btn" type="button" onclick="changeQty(this, -1, 0, 10)">−</button>
        <span class="qty-val">0</span>
        <button class="qty-btn" type="button" onclick="changeQty(this, 1, 0, 10)">+</button>
      </div>
    </li>

    <li class="tariff-feature-item" data-type="addon" data-mode="qty" data-unit-price="500" data-base-qty="0" data-label="Карточки товаров" data-min="0">
      <div class="item-left">
        <input type="checkbox" class="feature-checkbox qty-checkbox" onchange="toggleQtyState(this)" aria-label="Добавить карточки товаров">
        <span>Карточки товаров <span class="info-icon" data-tooltip="Добавьте оформление карточек товаров как в Премиум/VIP: регулируйте количество под ассортимент.">?</span></span>
      </div>
      <div class="qty-control">
        <button class="qty-btn" type="button" onclick="changeQty(this, -1, 0, 20)">−</button>
        <span class="qty-val">0</span>
        <button class="qty-btn" type="button" onclick="changeQty(this, 1, 0, 20)">+</button>
      </div>
    </li>

    <li class="tariff-feature-item" data-type="addon">
      <label class="item-left" style="cursor:pointer;">
        <input type="checkbox" class="feature-checkbox" data-price="3500" value="Мобильная анимированная обложка (до 15 сек)"  onchange="updatePrice(this)">
        <span>Мобильная анимированная обложка <span class="duration-note">(до 15 сек)</span> <span class="info-icon" data-tooltip="Живая обложка (анимация/видео) для мобильной версии.">?</span></span>
      </label>
    </li>

    <li class="tariff-feature-item" data-type="addon">
      <label class="item-left" style="cursor:pointer;">
        <input type="checkbox" class="feature-checkbox" data-price="1000" value="Шаблон обложки статьи"  onchange="updatePrice(this)">
        <span>Шаблон обложки статьи <span class="info-icon" data-tooltip="Шаблон для лонгридов/статей (редактируемый).">?</span></span>
      </label>
    </li>

    <li class="tariff-feature-item" data-type="addon">
      <label class="item-left" style="cursor:pointer;">
        <input type="checkbox" class="feature-checkbox" data-price="1000" value="Шаблон постов"  onchange="updatePrice(this)">
        <span>Шаблон постов <span class="info-icon" data-tooltip="Шаблон для оформления постов (редактируемый).">?</span></span>
      </label>
    </li>

    <li class="tariff-feature-item" data-type="addon">
      <label class="item-left" style="cursor:pointer;">
        <input type="checkbox" class="feature-checkbox" data-price="1000" value="Шаблон превью видео"  onchange="updatePrice(this)">
        <span>Шаблон превью видео <span class="info-icon" data-tooltip="Шаблон обложки для видео.">?</span></span>
      </label>
    </li>

    <li class="tariff-feature-item" data-type="addon" data-mode="qty" data-unit-price="1000" data-base-qty="0" data-label="Шаблон изображений к постам со ссылкой (сниппет)" data-min="0">
      <div class="item-left">
        <input type="checkbox" class="feature-checkbox qty-checkbox" onchange="toggleQtyState(this)" aria-label="Добавить сниппеты">
        <span>Шаблон изображений к постам со ссылкой (сниппет) <span class="info-icon" data-tooltip="Сколько вариантов сниппетов нужно: можно убрать или добавить любое количество.">?</span></span>
      </div>
      <div class="qty-control">
        <button class="qty-btn" type="button" onclick="changeQty(this, -1, 0, 12)">−</button>
        <span class="qty-val">0</span>
        <button class="qty-btn" type="button" onclick="changeQty(this, 1, 0, 12)">+</button>
      </div>
    </li>

    <li class="tariff-feature-item" data-type="addon">
      <label class="item-left" style="cursor:pointer;">
        <input type="checkbox" class="feature-checkbox" data-price="1500" value="Обложка для подписной страницы Senler рассылок"  onchange="updatePrice(this)">
        <span>Обложка для подписной страницы Senler рассылок <span class="info-icon" data-tooltip="Обложка для страницы подписки Senler.">?</span></span>
      </label>
    </li>
    </ul></div>

        <div class="tariff-price">10 000 ₽</div>
        <button class="tariff-btn" type="button" onclick="sendOrder(this, 'Стандарт')">Выбрать</button>
      </div>

<div class="tariff-note">
  <div class="tariff-note-title">Важный момент:</div>
  <div class="tariff-note-text"><span class="note-accent">*</span>Отмечайте галочкой нужные позиции, количество меняйте счётчиками (в том числе в блоках с несколькими позициями). Цена обновляется сразу — соберите комплект как в конструкторе и отправьте, ничего не потеряется.</div>
</div>

    </div>
    
    <div class="tariff-wrapper" data-base-price="20000">
      <div class="tariff-card">
        <div class="tariff-name">
          <div class="tariff-title">Премиум <span class="info-icon" data-tooltip="Для активных продаж и продвижения: усиленная упаковка с доп. графикой и вариативностью.">?</span></div>
          <div class="discount-badge" title="Выгода 15% при комплексном заказе всех элементов.">Скидка 15%</div>
        </div>
        <ul class="tariff-features">
    <li class="tariff-feature-item" data-type="base">
      <label class="item-left" style="cursor:pointer;">
        <input type="checkbox" class="feature-checkbox" data-price="0" value="Аватар" checked disabled>
        <span>Аватар <span class="info-icon" data-tooltip="Изображение профиля/сообщества: логотип или фото.">?</span></span>
      </label>
    </li>
    
    <li class="tariff-feature-item" data-type="base">
      <label class="item-left" style="cursor:pointer;">
        <input type="checkbox" class="feature-checkbox" data-price="0" value="Десктопная обложка" checked disabled>
        <span>Десктопная обложка <span class="info-icon" data-tooltip="Шапка для ПК версии сообщества.">?</span></span>
      </label>
    </li>
    
    <li class="tariff-feature-item" data-type="base">
      <label class="item-left" style="cursor:pointer;">
        <input type="checkbox" class="feature-checkbox" data-price="0" value="Мобильная анимированная обложка (до 15 сек)" checked disabled>
        <span>Мобильная анимированная обложка <span class="duration-note">(до 15 сек)</span> <span class="info-icon" data-tooltip="Живая обложка (анимация/видео) для мобильной версии.">?</span></span>
      </label>
    </li>
    
    <li class="tariff-feature-item" data-type="base" data-mode="qty" data-unit-price="2000" data-base-qty="2" data-label="Варианты дизайна десктопной обложки" data-min="2">
      <div class="item-left">
        <input type="checkbox" class="feature-checkbox qty-checkbox" checked disabled aria-label="Обязательная позиция">
        <span>Варианты дизайна десктопной обложки <span class="info-icon" data-tooltip="Сколько концепций десктопной обложки подготовить на выбор.">?</span></span>
      </div>
      <div class="qty-control">
        <button class="qty-btn" type="button" onclick="changeQty(this, -1, 1, 6)">−</button>
        <span class="qty-val">2</span>
        <button class="qty-btn" type="button" onclick="changeQty(this, 1, 1, 6)">+</button>
      </div>
    </li>
    
    <li class="tariff-feature-item" data-type="base">
      <label class="item-left" style="cursor:pointer;">
        <input type="checkbox" class="feature-checkbox" data-price="0" value="Иконки меню (до 5 шт)" checked onchange="updatePrice(this)">
        <span>Иконки меню (до 5 шт) <span class="info-icon" data-tooltip="Набор иконок для пунктов меню (до 5) с возможностью добавить больше через блок "Доп. иконки меню".">?</span></span>
      </label>
    </li>
    
    <li class="tariff-feature-item" data-type="base" data-mode="qty" data-unit-price="700" data-base-qty="3" data-label="Плитки виджета" data-min="3">
      <div class="item-left">
        <input type="checkbox" class="feature-checkbox qty-checkbox" checked disabled aria-label="Обязательная позиция">
        <span>Плитки виджета <span class="info-icon" data-tooltip="Плитки для виджетов (минимум 3, можно увеличить).">?</span></span>
      </div>
      <div class="qty-control">
        <button class="qty-btn" type="button" onclick="changeQty(this, -1, 3, 12)">−</button>
        <span class="qty-val">3</span>
        <button class="qty-btn" type="button" onclick="changeQty(this, 1, 3, 12)">+</button>
      </div>
    </li>
    
    <li class="tariff-feature-item" data-type="base" data-mode="qty" data-unit-price="500" data-base-qty="5" data-label="Карточки товаров" data-min="5">
      <div class="item-left">
        <input type="checkbox" class="feature-checkbox qty-checkbox" checked disabled aria-label="Обязательная позиция">
        <span>Карточки товаров <span class="info-icon" data-tooltip="Оформление карточек товаров (можно уменьшить/увеличить).">?</span></span>
      </div>
      <div class="qty-control">
        <button class="qty-btn" type="button" onclick="changeQty(this, -1, 0, 20)">−</button>
        <span class="qty-val">5</span>
        <button class="qty-btn" type="button" onclick="changeQty(this, 1, 0, 20)">+</button>
      </div>
    </li>
    
    <li class="tariff-feature-item" data-type="base" data-mode="qty" data-unit-price="1000" data-base-qty="1" data-label="Баннер для закрепа" data-min="1">
      <div class="item-left">
        <input type="checkbox" class="feature-checkbox qty-checkbox" checked disabled aria-label="Обязательная позиция">
        <span>Баннер для закрепа <span class="info-icon" data-tooltip="Креатив под закрепленный пост, входит в пакет.">?</span></span>
      </div>
      <div class="qty-control">
        <button class="qty-btn" type="button" onclick="changeQty(this, -1, 1, 10)">−</button>
        <span class="qty-val">1</span>
        <button class="qty-btn" type="button" onclick="changeQty(this, 1, 1, 10)">+</button>
      </div>
    </li>

    <li class="tariff-feature-item" data-type="base" data-mode="qty" data-unit-price="1000" data-base-qty="1" data-label="Баннеры для рекламы" data-min="1">
      <div class="item-left">
        <input type="checkbox" class="feature-checkbox qty-checkbox" checked disabled aria-label="Обязательная позиция">
        <span>Баннеры для рекламы <span class="info-icon" data-tooltip="Готовые баннеры для рекламных размещений.">?</span></span>
      </div>
      <div class="qty-control">
        <button class="qty-btn" type="button" onclick="changeQty(this, -1, 1, 10)">−</button>
        <span class="qty-val">1</span>
        <button class="qty-btn" type="button" onclick="changeQty(this, 1, 1, 10)">+</button>
      </div>
    </li>
    </ul>
        <div class="addon-section"><button class="addon-toggle" type="button" onclick="toggleAddons(this)"><span>+</span> Добавить услуги</button><ul class="addon-list">
    <li class="tariff-feature-item" data-type="addon" data-mode="qty" data-unit-price="300" data-base-qty="0" data-label="Доп. иконки меню" data-min="0">
      <div class="item-left">
        <input type="checkbox" class="feature-checkbox qty-checkbox" onchange="toggleQtyState(this)" aria-label="Добавить доп. иконки">
        <span>Доп. иконки меню <span class="info-icon" data-tooltip="Дополнительные иконки сверх 5 (макс. +3, итого до 8).">?</span></span>
      </div>
      <div class="qty-control">
        <button class="qty-btn" type="button" onclick="changeQty(this, -1, 0, 3)">−</button>
        <span class="qty-val">0</span>
        <button class="qty-btn" type="button" onclick="changeQty(this, 1, 0, 3)">+</button>
      </div>
    </li>
    
    <li class="tariff-feature-item" data-type="addon">
      <label class="item-left" style="cursor:pointer;">
        <input type="checkbox" class="feature-checkbox" data-price="2000" value="Мобильная анимированная обложка (до 30 сек)"  onchange="updatePrice(this)">
        <span>Мобильная анимированная обложка <span class="duration-note">(до 30 сек)</span> <span class="info-icon" data-tooltip="Увеличение длительности/сложности анимации.">?</span></span>
      </label>
    </li>
    
    <li class="tariff-feature-item" data-type="addon">
      <label class="item-left" style="cursor:pointer;">
        <input type="checkbox" class="feature-checkbox" data-price="1000" value="Шаблон обложки статьи"  onchange="updatePrice(this)">
        <span>Шаблон обложки статьи <span class="info-icon" data-tooltip="Шаблон для статей/лонгридов.">?</span></span>
      </label>
    </li>
    
    <li class="tariff-feature-item" data-type="addon">
      <label class="item-left" style="cursor:pointer;">
        <input type="checkbox" class="feature-checkbox" data-price="1000" value="Шаблон постов"  onchange="updatePrice(this)">
        <span>Шаблон постов <span class="info-icon" data-tooltip="Шаблон для постов.">?</span></span>
      </label>
    </li>
    
    <li class="tariff-feature-item" data-type="addon">
      <label class="item-left" style="cursor:pointer;">
        <input type="checkbox" class="feature-checkbox" data-price="1000" value="Шаблон превью видео"  onchange="updatePrice(this)">
        <span>Шаблон превью видео <span class="info-icon" data-tooltip="Шаблон превью для видео.">?</span></span>
      </label>
    </li>
    
    <li class="tariff-feature-item" data-type="addon" data-mode="qty" data-unit-price="1000" data-base-qty="0" data-label="Шаблон изображений к постам со ссылкой (сниппет)" data-min="0">
      <div class="item-left">
        <input type="checkbox" class="feature-checkbox qty-checkbox" onchange="toggleQtyState(this)" aria-label="Добавить сниппеты">
        <span>Шаблон изображений к постам со ссылкой (сниппет) <span class="info-icon" data-tooltip="Сколько вариантов сниппетов нужно: можно убрать или добавить любое количество.">?</span></span>
      </div>
      <div class="qty-control">
        <button class="qty-btn" type="button" onclick="changeQty(this, -1, 0, 12)">−</button>
        <span class="qty-val">0</span>
        <button class="qty-btn" type="button" onclick="changeQty(this, 1, 0, 12)">+</button>
      </div>
    </li>
    
    <li class="tariff-feature-item" data-type="addon">
      <label class="item-left" style="cursor:pointer;">
        <input type="checkbox" class="feature-checkbox" data-price="1500" value="Обложка для подписной страницы Senler рассылок"  onchange="updatePrice(this)">
        <span>Обложка для подписной страницы Senler рассылок <span class="info-icon" data-tooltip="Обложка для страницы подписки Senler.">?</span></span>
      </label>
    </li>
    </ul></div>
        
        <div class="tariff-price">20 000 ₽</div>
        <div class="price-note">Выгода по пакету: 15%</div>
        <button class="tariff-btn" type="button" onclick="sendOrder(this, 'Премиум')">Выбрать</button>
      </div>

      <div class="scroll-hint"><span class="hint-arrow">↓</span></div>

    </div>
    
    <div class="tariff-wrapper" data-base-price="30000">
      <div class="tariff-card">
        <div class="tariff-name">
          <div class="tariff-title">VIP <span class="info-icon" data-tooltip="Для масштабных запусков и премиум-задач: максимум материалов + приоритет по срокам.">?</span></div>
          <div class="discount-badge" title="Выгода 25% за комплекс: максимальный пакет дешевле, чем заказывать по отдельности.">Скидка 25%</div>
        </div>
        <ul class="tariff-features">
    <li class="tariff-feature-item" data-type="base">
      <label class="item-left" style="cursor:pointer;">
        <input type="checkbox" class="feature-checkbox" data-price="0" value="Аватар" checked disabled>
        <span>Аватар <span class="info-icon" data-tooltip="Изображение профиля/сообщества: логотип или фото.">?</span></span>
      </label>
    </li>
    
    <li class="tariff-feature-item" data-type="base" data-mode="qty" data-unit-price="2000" data-base-qty="3" data-label="Варианты дизайна десктопной обложки" data-min="3">
      <div class="item-left">
        <input type="checkbox" class="feature-checkbox qty-checkbox" checked disabled aria-label="Обязательная позиция">
        <span>Варианты дизайна десктопной обложки <span class="info-icon" data-tooltip="Сколько концепций десктопной обложки подготовить на выбор.">?</span></span>
      </div>
      <div class="qty-control">
        <button class="qty-btn" type="button" onclick="changeQty(this, -1, 1, 10)">−</button>
        <span class="qty-val">3</span>
        <button class="qty-btn" type="button" onclick="changeQty(this, 1, 1, 10)">+</button>
      </div>
    </li>
    
    <li class="tariff-feature-item" data-type="base">
      <label class="item-left" style="cursor:pointer;">
        <input type="checkbox" class="feature-checkbox" data-price="0" value="Мобильная анимированная обложка (до 30 сек)" checked disabled>
        <span>Мобильная анимированная обложка <span class="duration-note">(до 30 сек)</span> <span class="info-icon" data-tooltip="Живая обложка (анимация/видео) до 30 сек.">?</span></span>
      </label>
    </li>
    
    <li class="tariff-feature-item" data-type="base">
      <label class="item-left" style="cursor:pointer;">
        <input type="checkbox" class="feature-checkbox" data-price="0" value="Иконки меню (до 5 шт)" checked onchange="updatePrice(this)">
        <span>Иконки меню (до 5 шт) <span class="info-icon" data-tooltip="Набор иконок для пунктов меню (до 5) с возможностью добавить больше через блок "Доп. иконки меню".">?</span></span>
      </label>
    </li>
    
    <li class="tariff-feature-item" data-type="base" data-mode="qty" data-unit-price="700" data-base-qty="3" data-label="Плитки виджета" data-min="3">
      <div class="item-left">
        <input type="checkbox" class="feature-checkbox qty-checkbox" checked disabled aria-label="Обязательная позиция">
        <span>Плитки виджета <span class="info-icon" data-tooltip="Плитки для виджетов (минимум 3, можно увеличить).">?</span></span>
      </div>
      <div class="qty-control">
        <button class="qty-btn" type="button" onclick="changeQty(this, -1, 3, 20)">−</button>
        <span class="qty-val">3</span>
        <button class="qty-btn" type="button" onclick="changeQty(this, 1, 3, 20)">+</button>
      </div>
    </li>
    
    <li class="tariff-feature-item" data-type="base" data-mode="qty" data-unit-price="500" data-base-qty="5" data-label="Карточки товаров" data-min="5">
      <div class="item-left">
        <input type="checkbox" class="feature-checkbox qty-checkbox" checked disabled aria-label="Обязательная позиция">
        <span>Карточки товаров <span class="info-icon" data-tooltip="Оформление карточек товаров (до 5 в базе).">?</span></span>
      </div>
      <div class="qty-control">
        <button class="qty-btn" type="button" onclick="changeQty(this, -1, 0, 30)">−</button>
        <span class="qty-val">5</span>
        <button class="qty-btn" type="button" onclick="changeQty(this, 1, 0, 30)">+</button>
      </div>
    </li>
    
    <li class="tariff-feature-item" data-type="base" data-mode="qty" data-unit-price="1000" data-base-qty="1" data-label="Баннер для закрепа" data-min="1">
      <div class="item-left">
        <input type="checkbox" class="feature-checkbox qty-checkbox" checked disabled aria-label="Обязательная позиция">
        <span>Баннер для закрепа <span class="info-icon" data-tooltip="Креатив под закрепленный пост, входит в пакет.">?</span></span>
      </div>
      <div class="qty-control">
        <button class="qty-btn" type="button" onclick="changeQty(this, -1, 1, 20)">−</button>
        <span class="qty-val">1</span>
        <button class="qty-btn" type="button" onclick="changeQty(this, 1, 1, 20)">+</button>
      </div>
    </li>

    <li class="tariff-feature-item" data-type="base" data-mode="qty" data-unit-price="1000" data-base-qty="2" data-label="Баннеры для рекламы" data-min="2">
      <div class="item-left">
        <input type="checkbox" class="feature-checkbox qty-checkbox" checked disabled aria-label="Обязательная позиция">
        <span>Баннеры для рекламы <span class="info-icon" data-tooltip="Готовые баннеры для рекламных размещений.">?</span></span>
      </div>
      <div class="qty-control">
        <button class="qty-btn" type="button" onclick="changeQty(this, -1, 2, 20)">−</button>
        <span class="qty-val">2</span>
        <button class="qty-btn" type="button" onclick="changeQty(this, 1, 2, 20)">+</button>
      </div>
    </li>
    
    <li class="tariff-feature-item" data-type="base">
      <label class="item-left" style="cursor:pointer;">
        <input type="checkbox" class="feature-checkbox" data-price="0" value="Шаблон обложки статьи" checked onchange="updatePrice(this)">
        <span>Шаблон обложки статьи <span class="info-icon" data-tooltip="Шаблон для статей/лонгридов.">?</span></span>
      </label>
    </li>
    
    <li class="tariff-feature-item" data-type="base">
      <label class="item-left" style="cursor:pointer;">
        <input type="checkbox" class="feature-checkbox" data-price="0" value="Шаблон постов" checked onchange="updatePrice(this)">
        <span>Шаблон постов <span class="info-icon" data-tooltip="Шаблон для оформления постов.">?</span></span>
      </label>
    </li>
    
    <li class="tariff-feature-item" data-type="base">
      <label class="item-left" style="cursor:pointer;">
        <input type="checkbox" class="feature-checkbox" data-price="0" value="Шаблон превью видео" checked onchange="updatePrice(this)">
        <span>Шаблон превью видео <span class="info-icon" data-tooltip="Шаблон для превью видеоматериалов.">?</span></span>
      </label>
    </li>
    
    <li class="tariff-feature-item" data-type="base" data-mode="qty" data-unit-price="1000" data-base-qty="1" data-label="Шаблон изображений к постам со ссылкой (сниппет)" data-min="1">
      <div class="item-left">
        <input type="checkbox" class="feature-checkbox qty-checkbox" checked disabled aria-label="Обязательная позиция">
        <span>Шаблон изображений к постам со ссылкой (сниппет) <span class="info-icon" data-tooltip="Можно добавить больше вариантов сниппетов или убрать лишние — цена сразу изменится.">?</span></span>
      </div>
      <div class="qty-control">
        <button class="qty-btn" type="button" onclick="changeQty(this, -1, 0, 12)">−</button>
        <span class="qty-val">1</span>
        <button class="qty-btn" type="button" onclick="changeQty(this, 1, 0, 12)">+</button>
      </div>
    </li>
    
    <li class="tariff-feature-item" data-type="base">
      <label class="item-left" style="cursor:pointer;">
        <input type="checkbox" class="feature-checkbox" data-price="0" value="Обложка для подписной страницы Senler рассылок" checked onchange="updatePrice(this)">
        <span>Обложка для подписной страницы Senler рассылок <span class="info-icon" data-tooltip="Обложка для страницы подписки Senler.">?</span></span>
      </label>
    </li>
    </ul>
        <div class="addon-section"><button class="addon-toggle" type="button" onclick="toggleAddons(this)"><span>+</span> Добавить услуги</button><ul class="addon-list">
    <li class="tariff-feature-item" data-type="addon" data-mode="qty" data-unit-price="300" data-base-qty="0" data-label="Доп. иконки меню" data-min="0">
      <div class="item-left">
        <input type="checkbox" class="feature-checkbox qty-checkbox" onchange="toggleQtyState(this)" aria-label="Добавить доп. иконки">
        <span>Доп. иконки меню <span class="info-icon" data-tooltip="Дополнительные иконки сверх 5 (макс. +3, итого до 8).">?</span></span>
      </div>
      <div class="qty-control">
        <button class="qty-btn" type="button" onclick="changeQty(this, -1, 0, 3)">−</button>
        <span class="qty-val">0</span>
        <button class="qty-btn" type="button" onclick="changeQty(this, 1, 0, 3)">+</button>
      </div>
    </li>
    </ul></div>
        
        <div class="speed-badge">
          <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>
          <div>Высокая скорость выполнения проекта: Вы вне очереди <span class="info-icon" data-tooltip="Приоритетное выполнение: ваш проект идёт без очереди, сроки максимально сжатые.">?</span></div>
        </div>
        
        <div class="tariff-price">30 000 ₽</div>
        <div class="price-note">Выгода по пакету: 25%</div>
        <button class="tariff-btn" type="button" onclick="sendOrder(this, 'VIP')">Выбрать</button>
      </div>
      
    </div>
    </div>
    
  <div class="tariff-header" style="margin-top:40px;">
    <h2 class="section-title">Этапы <span>работы</span></h2>
    <p class="section-subtitle">Как проходит работа со мной:</p>
  </div>
  <div class="stages-grid">
    <div class="stage-card">
      <div class="stage-number">01</div>
      <div class="stage-icon"><svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg></div>
      <h3>Общение <br><span>с клиентом</span></h3>
      <p>Мини-брифинг. Сбор нужной информации по проекту. Изучаю задачу, вникаю в проект, озвучиваю сроки.</p>
    </div>
    <div class="stage-card">
      <div class="stage-number">02</div>
      <div class="stage-icon"><svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg></div>
      <h3>Анализ <br><span>и дизайн</span></h3>
      <p>Изучаю конкурентов, выявляю слабые места. Разрабатываю уникальный дизайн, который выделит вас.</p>
    </div>
    <div class="stage-card">
      <div class="stage-number">03</div>
      <div class="stage-icon"><svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg></div>
      <h3>Утверждение <br><span>и сдача</span></h3>
      <p>Презентация дизайна. Если всё нравится — передаю все файлы и исходники. Если нужны правки — дорабатываем.</p>
    </div>
  </div>

  </div>

<div class="footer-socials" style="max-width: 1440px; margin: 40px auto 36px auto; padding: 18px 20px 0 20px; justify-content: center;">
  <a href="https://vk.com/dsgnjr" target="_blank" class="footer-link" title="Группа VK" rel="noopener">
    <div class="footer-icon vk-group-icon">
      <svg viewBox="0 0 24 24"><path fill="currentColor" d="M15.013 19.43c-5.83 0-9.138-3.99-9.278-10.645H8.62c.1 4.88 2.25 6.944 3.955 7.37V8.785h2.75v4.209c1.683-.18 3.44-2.09 4.037-4.21h2.75a8.77 8.77 0 01-3.71 5.378 8.875 8.875 0 014.288 5.268h-3.023a5.55 5.55 0 00-4.04-3.614v3.614h-1.874z"/></svg>
    </div>
    <div class="footer-text"><div class="footer-title">Группа VK</div><div class="footer-sub">9 650 подписчиков</div></div>
  </a>

  <a href="https://t.me/r_zhegulyaev" target="_blank" class="footer-link" title="Telegram" rel="noopener">
    <div class="footer-icon tg-icon">
      <svg viewBox="0 0 24 24"><path fill="currentColor" d="M21.8 4.6L2.9 11.9c-1.2.5-1.2 1.2-.2 1.5l4.8 1.5 1.8 5.7c.2.6.1.8.7.8.5 0 .7-.2 1-.5l2.3-2.2 4.8 3.6c.9.5 1.5.2 1.7-.8l3.1-14.5c.3-1.2-.5-1.7-1.4-1.4zM9 15.5l10.8-8.6c.5-.4 1-.2.6.2l-8.7 9c-.3.3-.5.6-.5 1l-.2 2.7-1.1-3.8-3.8-1.2c-.8-.2-.8-.7.2-1.1l15.4-6"/></svg>
    </div>
    <div class="footer-text"><div class="footer-title">Telegram</div><div class="footer-sub">3k+ подписчиков</div></div>
  </a>

  <a href="https://vk.com/zhegulyaev" target="_blank" class="footer-link" title="Страница VK" rel="noopener">
    <div class="footer-icon vk-user-icon">
      <svg viewBox="0 0 24 24"><path fill="currentColor" d="M12 12c2.2 0 4-1.8 4-4S14.2 4 12 4 8 5.8 8 8s1.8 4 4 4zm0 2c-3.3 0-8 1.7-8 5v1h16v-1c0-3.3-4.7-5-8-5z"/></svg>
    </div>
    <div class="footer-text"><div class="footer-title">Страница VK</div><div class="footer-sub">Профиль</div></div>
  </a>

  <a href="https://www.behance.net/r_zhegulyaev" target="_blank" class="footer-link" title="Behance" rel="noopener">
    <div class="footer-icon be-icon">
      <svg viewBox="0 0 24 24"><path fill="currentColor" d="M8.2 12.1c.6-.4 1-1.1 1-1.9 0-1.6-1.1-2.7-3.2-2.7H2v12h4c2.5 0 4-1.3 4-3.4 0-1.4-.7-2.4-1.8-3zM4.4 7.4h1.4c1 0 1.5.4 1.5 1.2 0 .9-.5 1.3-1.5 1.3H4.4V7.4zm1.6 9.2H4.4v-3h1.6c1.2 0 1.8.5 1.8 1.5 0 1-.6 1.5-1.8 1.5zM14 9h6V7h-6v2zm3.1 10.8c2.3 0 3.8-1.2 4.2-3h-2c-.2.7-.9 1.2-2 1.2-1.4 0-2.3-1-2.4-2.4h6.5v-.8c0-2.8-1.6-4.8-4.3-4.8-2.7 0-4.4 2-4.4 4.9 0 3 1.7 4.9 4.4 4.9zm0-7.9c1.2 0 2 .7 2.1 1.9h-4.3c.2-1.2 1-1.9 2.2-1.9z"/></svg>
    </div>
    <div class="footer-text"><div class="footer-title">Behance</div><div class="footer-sub">Портфолио</div></div>
  </a>

  <a href="https://ru.pinterest.com/zhegulyaev/" target="_blank" class="footer-link" title="Pinterest" rel="noopener">
    <div class="footer-icon pin-icon">
      <svg viewBox="0 0 24 24"><path fill="currentColor" d="M12 2C6.5 2 2 6.3 2 11.7c0 4 2.3 7.4 5.6 8.9-.1-.8-.2-2 .1-2.9.2-.8 1.4-5.1 1.4-5.1s-.4-.9-.4-2.1c0-2 1.2-3.5 2.6-3.5 1.2 0 1.8.9 1.8 2 0 1.2-.8 3-1.2 4.7-.3 1.4.7 2.5 2.1 2.5 2.5 0 4.4-2.6 4.4-6.3 0-3.3-2.4-5.6-5.7-5.6-3.9 0-6.2 2.9-6.2 5.9 0 1.2.5 2.4 1 3.1.1.1.1.3.1.5-.1.6-.3 1.4-.4 1.6-.1.2-.2.2-.4.1-1.5-.7-2.4-2.9-2.4-4.6 0-3.8 2.8-7.3 8-7.3 4.2 0 7.5 3 7.5 7 0 4.2-2.6 7.5-6.2 7.5-1.2 0-2.3-.6-2.7-1.3l-.7 2.7c-.2.9-.8 2-1.2 2.7.9.3 1.9.5 3 .5 5.5 0 10-4.3 10-9.7C22 6.3 17.5 2 12 2z"/></svg>
    </div>
    <div class="footer-text"><div class="footer-title">Pinterest</div><div class="footer-sub">Вдохновение</div></div>
  </a>
</div>

</div>

<div id="scroll-top" class="scroll-top-link" onclick="window.scrollTo({top:0,behavior:'smooth'})"><svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M18 15l-6-6-6 6"/></svg> <span>Наверх</span></div>

<!-- FLOATING MESSAGE BUBBLE - DARK STYLE -->
<div class="message-bubble" onclick="openOrder()">
    <img id="bubble-avatar" src="" alt="Аватар">
    <div class="message-bubble-text">
        <div class="message-bubble-title" style="display:flex; justify-content:space-between; align-items:center;">
            Появятся вопросы — пишите! 
            <span style="cursor:pointer; opacity:0.6; display:flex; padding:4px;" onclick="event.stopPropagation(); this.closest('.message-bubble').style.display='none'" onmouseover="this.style.opacity=1" onmouseout="this.style.opacity=0.6">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </span>
        </div>
        <div class="message-bubble-desc">Отвечу в ближайшее время 😌</div>
        <div class="message-bubble-btn">
            <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
            Написать
        </div>
    </div>
</div>

<div id="modal" onclick="closeModal(event)">
  <div class="modal-content" id="modal-content-inner" onclick="event.stopPropagation()">
    <div class="modal-left">
      <button class="nav nav-left" onclick="move(-1)">&#10094;</button>
      <div class="modal-img" id="modal-img-container" onclick="toggleZoom(event)">
        <img id="preview" class="modal-preview">
        <img id="full" class="modal-full"><div id="modal-loader" class="loader-spinner"></div>
      </div>
      <button class="nav nav-right" onclick="move(1)">&#10095;</button>
      <div class="modal-bottom-bar">
        <div class="left">
          <span id="photo-index"></span>
        </div>
        <div class="right">
          <a id="vk-link-orig" href="#" target="_blank" class="vk-link-bottom">Открыть в ВК</a>


          <div class="share-btn-modal vk-link-bottom" onclick="copyLink()">Поделиться</div>
          <div class="more-actions">
            <div class="more-btn">Ещё ∨</div>
            <div class="more-menu">
              <a id="original-link" href="#" target="_blank">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
                Показать в оригинале
              </a>
              <a id="download-link" href="#" download>
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                Скачать
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-right">
      <button class="close-in-modal" onclick="closeModal()">
        <svg viewBox="0 0 24 24" fill="none"><path d="M18 6L6 18M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </button>
      <div class="modal-info-scroll">
        <a id="group-link" href="https://vk.com/zhegulyaev" target="_blank" class="modal-header">
            <img id="header-avatar" class="modal-avatar" src="">
            <div>
                <div id="header-author" class="modal-author">Роман Жегуляев</div>
                <div id="header-date" class="modal-date"></div>
            </div>
        </a>
        <div id="modal-text" class="modal-text collapsed"></div>
        <div id="show-more" class="show-more-btn" onclick="toggleText()">Показать ещё</div>
        
        
        <div class="modal-buttons-row">
            <button class="order-btn" onclick="openOrder()">Обсудить проект</button>
            <div id="ref-btn-container"></div>
        </div>

        
        <div class="modal-actions-bar">
            <div id="likes-box" class="action-item">
                <svg width="20" height="20" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                <span id="likes-count">0</span>
            </div>
            <div class="action-item" style="margin-left: auto;">
                 <svg width="20" height="20" viewBox="0 0 24 24"><path d="M21 6h-2v9H6v2c0 .55.45 1 1 1h11l4 4V7c0-.55-.45-1-1-1zm-4 6V3c0-.55-.45-1-1-1H3c-.55 0-1 .45-1 1v14l4-4h10c.55 0 1-.45 1-1z"/></svg>
                 <span id="comments-count">0</span>
            </div>
        </div>
        
<div id="comments-container" class="comments-section"></div>
      </div>
    </div>
  </div>
</div>

<div id="order-modal" onclick="closeOrder(event)">
    <div class="order-choice">
        <h2>Связаться со мной</h2>
        <p>Выберите удобный способ для связи и обсуждения проекта</p>
        <div class="contact-list">
            <a href="https://vk.com/im?sel=-163936790" target="_blank" class="contact-link link-vk">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="#fff"><path d="M15.013 19.43c-5.83 0-9.138-3.99-9.278-10.645H8.62c.1 4.88 2.25 6.944 3.955 7.37V8.785h2.75v4.209c1.683-.18 3.44-2.09 4.037-4.21h2.75a8.77 8.77 0 01-3.71 5.378 8.875 8.875 0 014.288 5.268h-3.023a5.55 5.55 0 00-4.04-3.614v3.614h-1.874z"/></svg>
                ВКонтакте
            </a>
            <a href="https://t.me/zhegulyaev" target="_blank" class="contact-link link-tg">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="#fff"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.8c-.15 1.58-.8 5.42-1.13 7.19-.14.75-.42 1-.68 1.03-.58.05-1.02-.38-1.58-.75-.88-.58-1.38-.94-2.23-1.5-.99-.65-.35-1.01.22-1.59.15-.15 2.71-2.48 2.76-2.69a.2.2 0 00-.05-.18c-.06-.05-.14-.03-.21-.02-.09.02-1.49.95-4.22 2.79-.4.27-.76.41-1.08.4-.36-.01-1.04-.2-1.55-.37-.63-.2-1.12-.31-1.08-.66.02-.18.27-.36.74-.55 2.91-1.27 4.85-2.11 5.82-2.52 2.77-1.16 3.35-1.36 3.72-1.37.08 0 .27.02 .39.12.1.08.13.19.14.27-.01.06.01.24 0 .38z"/></svg>
                Telegram
            </a>
        </div>
    </div>
</div>

<script>
let scrollBeforeModal = 0;
const TOKEN = 'vk1.a.tOSblOYWMeA4uLbJ9r07EnvpkA9cTBfz9uHD0aUBxQGRhjXkVh1B6ir4IGgcXnPb6n-IP4I-tNP5m_hKAivnDbn1rjQZtDRj-9-kPiK6CLO1YupE1qWL2e9GhnO9uxscgv-AhchfWy-VgYcR8V2oCeHmBX9g_LpZ-YUF2d21zO6NvGUDeyc-T6gVgvCo8HwKC3F3hQYpftnfQQ-xspyVQA';
const OWNER = '-163936790';
const REVIEW_TOPIC_ID = '37742383';

let photos = [], raw = [], idx = 0, hist = [], covers = {}, alb = null, rev = 0, revReviews = 0, albumCounts = {}, groupInfo = null, currentMenu = [], totalWorks = 0; let selectedRefs = new Set();
let services = [], currentServiceId = null;
let currentFolderId = null;
let currentSection = 'main';

const cursorDot = document.querySelector('.cursor-dot');
const cursorOutline = document.querySelector('.cursor-outline');
window.addEventListener('mousemove', (e) => {
    const posX = e.clientX;
    const posY = e.clientY;
    cursorDot.style.left = `${posX}px`;
    cursorDot.style.top = `${posY}px`;
    // cursorOutline.animate({ left: `${posX}px`, top: `${posY}px` }, { duration: 500, fill: "forwards" });
});
document.addEventListener('mouseover', (e) => {
    if (e.target.closest('a') || e.target.closest('button') || e.target.closest('.card') || e.target.closest('.photo-item') || e.target.closest('.cursor-pointer')) {
        cursorOutline.classList.add('hovered');
    } else {
        cursorOutline.classList.remove('hovered');
    }
});

function api(m,p,cb){
  const s=document.createElement('script');
  s.src=`https://api.vk.com/method/${m}?${p}&access_token=${TOKEN}&v=5.131&callback=${cb}`;
  document.head.appendChild(s);
  s.onload=()=>s.remove();
}

function getUrlParams() {
  const params = new URLSearchParams(location.search);
  return {
    album: params.get('album'),
    photo: params.get('photo') ? parseInt(params.get('photo')) - 1 : null,
    service: params.get('service'),
    folder: params.get('folder'),
    section: params.get('section')
  };
}

function applyStateFromUrl() {
  const {album, photo, service, folder, section} = getUrlParams();
  hist = [];
  currentSection = 'main';

  if (section === 'reviews') { openReviewsSection(true); return; }
  if (section === 'services') { loadServices(true); return; }

  menuShow(menu, "ПОРТФОЛИО");
  if (folder) openFolderById(folder);
  if (album) openAlbumById(album, photo);
  if (service) openService(service);
}


function updateUrl(albumId = null, photoIndex = null, serviceId = null, folderId = null, section = null) {
  const params = new URLSearchParams();
  if (albumId) params.set('album', albumId);
  if (photoIndex !== null && photoIndex >= 0) params.set('photo', photoIndex + 1);
  if (serviceId) params.set('service', serviceId);
  if (folderId) params.set('folder', folderId);
  if (section) params.set('section', section);
  const queryString = params.toString() ? '?' + params.toString() : '';
  const newUrl = queryString || location.pathname;
  const currentSearch = location.search;
  if (currentSearch === queryString) {
      history.replaceState(null, '', newUrl + location.hash);
      return;
  }
  if (photoIndex !== null) {
      history.replaceState(null, '', newUrl + location.hash);
  } else {
      history.pushState(null, '', newUrl + location.hash);
  }
}
window.addEventListener('popstate', () => { applyStateFromUrl(); });


function startBackgroundPreload() {
    if(!photos || photos.length === 0) return;
    let loadedCount = 0;
    const preloadStep = (index) => {
        if(index >= photos.length) return;
        const p1 = photos[index];
        const p2 = photos[index+1];
        const loadImg = (url) => { if(!url) return; const i = new Image(); i.src = url; };
        if(p1) loadImg(p1.mid);
        if(p2) loadImg(p2.mid);
        setTimeout(() => preloadStep(index + 2), 200);
    };
    setTimeout(() => preloadStep(0), 1000);
}

window.addEventListener('scroll', () => {
    // Progress Bar Logic
    const bar = document.getElementById('header-progress');
    if (alb && bar) {
        const scrollTop = window.scrollY;
        const docHeight = document.documentElement.scrollHeight - window.innerHeight;
        const scrollPercent = docHeight > 0 ? (scrollTop / docHeight) * 100 : 0;
        bar.style.width = scrollPercent + '%';
    }

    const btn = document.getElementById('scroll-top');
    if (window.scrollY > 500) {
        btn.classList.add('visible');
    } else {
        btn.classList.remove('visible');
    }
});

function renderGroupHeader(g) {
    if(!g) return;
    const container = document.getElementById('profile-header');
    const photo = g.photo_200 || 'https://vk.com/images/camera_200.png';
    const name = g.name;
    const members = g.members_count ? g.members_count.toLocaleString('ru-RU') : 0;
    const desc = g.status || g.description || '';
    
    container.innerHTML = `
        <a href="https://vk.ru/dsgnjr" target="_blank" class="profile-main-link" style="text-decoration:none;color:inherit;display:flex;flex-direction:column;align-items:center;">
            <img class="profile-avatar" src="${photo}" alt="${name}">
            <h2 class="profile-name">${name}</h2>
        </a>
        ${desc ? `<p class="profile-desc">${desc}</p>` : ''}
        <a href="https://vk.ru/dsgnjr" target="_blank" class="profile-meta hover-subs" style="text-decoration:none; color:inherit; cursor:pointer;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
            ${members} подписчиков
        </a>
        
<div class="profile-actions">
    <!-- Discuss Project (RED #ff3347) -->
    <a onclick="openOrder()" class="btn-header-primary">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
        <span>Обсудить проект</span>
    </a>

    <!-- Subscribe (Gray) -->
    <a href="https://vk.com/dsgnjr" target="_blank" class="btn-secondary-styled">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="8.5" cy="7" r="4"></circle><line x1="20" y1="8" x2="20" y2="14"></line><line x1="23" y1="11" x2="17" y2="11"></line></svg>
        <span>Подписаться</span>
    </a>

    <!-- Reviews (Gray, Blue Badge) -->
    <div onclick="openReviewsSection()" class="btn-secondary-styled">
        <div class="review-icon-box">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="currentColor"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></svg>
            <div class="review-badge" id="reviews-badge-count">458</div>
        </div>
        <span>Отзывы</span>
    </div>
</div>

        </div>
    `;
}

window.setGroup = d => { 
    if(d.response) {
        groupInfo = d.response[0]; 
        renderGroupHeader(groupInfo);
    updateFooterMembers();

        const avatarUrl = groupInfo.photo_200 || groupInfo.photo_100 || groupInfo.photo_50 || 'https://vk.com/images/camera_200.png';
        document.getElementById('bubble-avatar').src = avatarUrl;
        document.getElementById('header-avatar').src = avatarUrl;
    }
};
api('groups.getById', `group_id=dsgnjr&fields=members_count,photo_200,photo_100,photo_50,description,status`, 'setGroup');

window.saveCovers = d => {
  if(d.response){
    d.response.items.forEach(a=>{
      const sizes = a.sizes || [];
      const best = sizes.length ? sizes.sort((x,y) => y.width - x.width)[0] : null;
      covers[a.id] = best ? best.url : (a.thumb_src || '');
      albumCounts[a.id] = a.size || 0;
      if (a.id !== -211 && a.id !== -212) { totalWorks += a.size || 0; }
    });
    api('execute', 'code=' + encodeURIComponent('var o=Args.owner_id; return [API.photos.get({"owner_id":o,"album_id":270856221,"count":7}),API.photos.get({"owner_id":o,"album_id":269040903,"offset":6,"count":1}),API.photos.get({"owner_id":o,"album_id":309328278,"offset":69,"count":1}),API.photos.get({"owner_id":o,"album_id":279127223,"offset":0,"count":1}),API.photos.get({"owner_id":o,"album_id":284187693,"offset":2,"count":1}),API.photos.get({"owner_id":o,"album_id":264642934,"offset":14,"count":1}),API.photos.get({"owner_id":o,"album_id":269062586,"offset":12,"count":1}),API.photos.get({"owner_id":o,"album_id":278088695,"offset":2,"count":1}),API.photos.get({"owner_id":o,"album_id":282455381,"offset":24,"count":1})];') + '&owner_id=' + OWNER, 'saveCustomCovers');
    api('board.getTopics', `group_id=${Math.abs(OWNER)}&topic_ids=${REVIEW_TOPIC_ID}&preview=1`, 'saveReviewsCount');
  }
};


window.saveCustomCovers = d => {
  if(d.response){
     const [social, banners, posters, music, wb, insta, yt, preview, avatars] = d.response;
     const getUrl = (list, idx) => {
         if(!list || !list.items) return '';
         const item = list.items[idx] || list.items[0]; 
         if(!item) return '';
         const s = item.sizes.find(x => x.type === 'x') || item.sizes.find(x => x.type === 'y') || item.sizes.find(x => x.type === 'z') || item.sizes.find(x => x.type === 'w') || item.sizes.sort((a,b)=>(b.width||0)-(a.width||0))[0];
         return s ? s.url : '';
     };
     covers['270856221'] = getUrl(social, 0); covers['folder_social'] = getUrl(social, 6); covers['269040903'] = getUrl(banners, 0); covers['309328278'] = getUrl(posters, 0); covers['279127223'] = getUrl(music, 0); covers['284187693'] = getUrl(wb, 0); covers['264642934'] = getUrl(insta, 0); covers['269062586'] = getUrl(yt, 0); covers['278088695'] = getUrl(preview, 0); covers['282455381'] = getUrl(avatars, 0);
     if(typeof currentMenu !== 'undefined') menuShow(currentMenu, document.getElementById('title').innerText);
  }
};
window.saveReviewsCount = d => {
    if(d.response && d.response.items && d.response.items.length > 0) {
        albumCounts['reviews'] = d.response.items[0].comments;
    }
    document.getElementById('subtitle').innerText = `· ${totalWorks} работ${totalWorks % 10 === 1 && totalWorks % 100 !== 11 ? 'а' : 'ы'}`;
    applyStateFromUrl();
};

const menu=[
  {title:"Оформление соцсетей",isFolder:true,id:"folder_social",items:[
    {title:"Оформление сообществ",id:"270856221"},
    {title:"Оформление INSTA/TG",id:"264642934"},
    {title:"Оформление YouTube",id:"269062586"},
    {title:"Превью",id:"278088695"},
    {title:"Аватарки для соцсетей",id:"282455381"}
  ]},
  {title:"Рекламные баннеры",id:"269040903"},
  {title:"Постеры",id:"309328278"},
  {title:"Дизайн Wildberries",id:"284187693"},
  {title:"Музыкальные обложки",id:"279127223"},
  {title:"Отзывы клиентов",id:"reviews_link", special: true},
  {title:"Клиенты", id:"services_link", type: "clients", special: true}
];

function findMenuItem(list, targetId, path = []) {
  for (const item of list) {
    if (item.isFolder) {
      const found = findMenuItem(item.items, targetId, [...path, item]);
      if (found) return found;
    } else if (item.id === targetId) {
      return {item, path};
    }
  }
  return null;
}

function openFolderById(folderId) {
  const found = findMenuItem(menu, folderId);
  if (!found) return;

  hist = [];
  let currentList = menu;
  let currentTitle = "ПОРТФОЛИО";

  for (const folder of found.path) {
    hist.push({l: currentList, t: currentTitle, b: true});
    currentList = folder.items;
    currentTitle = folder.title;
    menuShow(currentList, currentTitle, true);
  }
}

function openAlbumById(id, photoIdx = null) {
  const found = findMenuItem(menu, id);
  if (!found) return;

  hist = [];
  let currentList = menu;
  let currentTitle = "ПОРТФОЛИО";

  if (found.path) {
    for (const folder of found.path) {
      hist.push({l: currentList, t: currentTitle, b: true});
      currentList = folder.items;
      currentTitle = folder.title;
      menuShow(currentList, currentTitle, true);
    }
  }

  hist.push({l: currentList, t: currentTitle, b: true});
  loadAlb(id, found.item.title);

  if (photoIdx !== null && photoIdx >= 0) {
    const check = setInterval(() => {
      if (raw.length > 0) {
        clearInterval(check);
        if (photoIdx < raw.length) openModal(photoIdx);
      }
    }, 200);
  }
}

function openReviewsSection(skipUrlUpdate = false) {
    currentSection = 'reviews';
    if (!skipUrlUpdate) hist.push({l: currentMenu, t: document.getElementById('title').innerText, b: true});
    if (!skipUrlUpdate) updateUrl(null, null, null, null, 'reviews');
    loadReviews();
}

function loadServices(skipUrlUpdate = false) { window.scrollTo(0,0); document.getElementById("header-progress").style.opacity = 0;
    currentSection = 'services';
    if (!skipUrlUpdate) updateUrl(null, null, null, null, 'services');
    alb = null;
    currentServiceId = null;
    currentFolderId = null;
    const r = document.getElementById('area');
    r.innerHTML = '<div class="comments-loader" style="padding: 100px; text-align: center;"><svg viewBox="0 0 50 50"><circle cx="25" cy="25" r="20" fill="none" stroke="#888" stroke-width="5" stroke-dasharray="31.4 31.4" transform="rotate(-90 25 25)"><animateTransform attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="1s" repeatCount="indefinite"/></circle></svg></div>';
    
    document.getElementById('title').innerText = "УСЛУГИ";
    document.getElementById('title').dataset.original = "УСЛУГИ";
    document.getElementById('subtitle').innerText = "";
    document.getElementById('back').classList.add('active');
    document.getElementById('sort').classList.remove('active');
    document.getElementById('tags-bar').style.display = 'none';

    api('market.get', `owner_id=${OWNER}&count=200&extended=1`, 'renderServicesList');
}

window.renderServicesList = d => {
  const r = document.getElementById('area');
  r.innerHTML = '';
  r.className = 'grid';

  // 1. Handle Access Denied (Token/Settings issue)
  if (d.error) {
       console.error('VK API Error:', d.error);
       r.innerHTML = `<div class="empty-album" style="max-width:550px; margin: 50px auto; padding: 0 20px;">
        <div style="font-size: 48px; margin-bottom: 15px;">🔒</div>
        <h3 style="margin-bottom:10px; color:#fff;">Ошибка доступа к Услугам</h3>
        <p style="color:#aaa; font-size:15px; line-height:1.6;">
            VK API вернул ошибку: <b>Access denied</b> (код 15).<br><br>
            <b>Важный момент:</b><br>
            В VK API разделы «Услуги» и «Товары» работают через одну систему.
            Даже если вы используете только Услуги, для работы API <b>необходимо</b>, чтобы в настройках сообщества был включен раздел <b>«Товары»</b> (Market), либо токен имел права <b>market</b>.<br><br>
            <b>Что сделать:</b><br>
            1. Зайдите в <i>Управление → Разделы</i> и проверьте, что галочка «Товары» включена (или переключите тип раздела).<br>
            2. Если используете токен — перевыпустите его с правами <b>market</b>.
        </p>
      </div>`;
      return;
  }

  if(!d.response || d.response.items.length === 0) {
       r.innerHTML = '<div class="empty-album">Услуг пока нет</div>';
       return;
  }

  
  // Filter: Keep only items with "по договорённости" (agreement) or price = 0
  // This helps distinguish Services from cheap Products (like 1 rub items)
  const allItems = d.response.items;
  const serviceItems = allItems.filter(i => (i.price && (i.price.text.toLowerCase().includes('договор') || i.price.amount === 0)));

  // Use filtered list if not empty, otherwise fallback to all
  services = serviceItems.length > 0 ? serviceItems : allItems;


  document.getElementById('title').innerText = `УСЛУГИ · ${services.length}`;

  services.forEach(item => {
    const thumb = item.thumb_photo || 'https://vk.com/images/camera_200.png';
    const card = document.createElement('div');
    card.className = 'market-card';
    card.innerHTML = `
        <img src="${thumb}" class="market-img" alt="${item.title}">
        <div class="market-content">
            <div class="market-title">${item.title}</div>
            <div class="market-price">${item.price.text}</div>
            <div class="market-btn">Подробнее</div>
        </div>
    `;
    card.onclick = () => openService(item.id);
    r.appendChild(card);
  });
};

function openService(serviceId) { window.scrollTo(0,0); document.getElementById("header-progress").style.opacity = 0;
  const service = services.find(s => s.id === serviceId);
  if (!service) return;

  currentServiceId = serviceId;
  updateUrl(null, null, serviceId);

  hist.push({l: currentMenu, t: document.getElementById('title').innerText, b: true});

  const r = document.getElementById('area');
  r.innerHTML = '';
  r.className = 'grid';

  document.getElementById('title').innerText = service.title;
  document.getElementById('title').dataset.original = service.title;
  document.getElementById('back').classList.add('active');

  const thumb = service.thumb_photo || 'https://vk.com/images/camera_200.png';

  const card = document.createElement('div');
  card.className = 'market-card';
  card.style.maxWidth = '500px';
  card.style.margin = '0 auto';
  card.innerHTML = `
      <img src="${thumb}" class="market-img" alt="${service.title}">
      <div class="market-content">
          <div class="market-title">${service.title}</div>
          <div class="market-price">${service.price.text}</div>
          <div style="margin-bottom: 20px; color: #d1d1d6; white-space: pre-wrap; font-size: 14px;">${service.description || 'Нет описания'}</div>
          <div class="market-btn" onclick="window.open('https://vk.com/im?sel=${OWNER}&message=Здравствуйте! Хочу заказать: ${encodeURIComponent(service.title)}', '_blank')">Заказать</div>
      </div>
  `;
  r.appendChild(card);
}

function loadReviews() { window.scrollTo(0,0); document.getElementById("header-progress").style.opacity = 0;
    alb = null;
    const r = document.getElementById('area');
    r.innerHTML = '<div class="comments-loader" style="padding: 100px; text-align: center;"><svg viewBox="0 0 50 50"><circle cx="25" cy="25" r="20" fill="none" stroke="#888" stroke-width="5" stroke-dasharray="31.4 31.4" transform="rotate(-90 25 25)"><animateTransform attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="1s" repeatCount="indefinite"/></circle></svg></div>';
    
    document.getElementById('title').innerText = "ОТЗЫВЫ";
    document.getElementById('title').dataset.original = "ОТЗЫВЫ";
    document.getElementById('subtitle').innerText = "";
    document.getElementById('back').classList.add('active');
    document.getElementById('tags-bar').style.display = 'none';
    
    document.getElementById('sort').classList.add('active');
    document.getElementById('sort').classList.toggle('active', revReviews === 1);
    document.getElementById('sort').title = revReviews === 0 ? "Сначала новые" : "Сначала старые";

    const sortOrder = revReviews === 0 ? 'desc' : 'asc';
    api('board.getComments', `group_id=${Math.abs(OWNER)}&topic_id=${REVIEW_TOPIC_ID}&extended=1&sort=${sortOrder}&count=100`, 'renderReviews');
}

window.renderReviews = d => {
    const r = document.getElementById('area');
    r.innerHTML = '';
    
    if(!d.response || d.response.items.length === 0) {
         r.innerHTML = '<div class="empty-album">Отзывов пока нет</div>';
         return;
    }
    
    r.className = 'masonry-wrap';
    const colCount = getColCount();
    const columns = [];
    for(let i=0; i<colCount; i++) {
        const col = document.createElement('div');
        col.className = 'masonry-col';
        r.appendChild(col);
        columns.push(col);
    }
    
    const profiles = d.response.profiles || [];
    const groups = d.response.groups || [];
    
    d.response.items.forEach((c, i) => {
        let user;
        if (c.from_id > 0) user = profiles.find(u => u.id === c.from_id);
        else user = groups.find(g => g.id === -c.from_id);
        
        const photo = user?.photo_100 || 'https://vk.com/images/camera_100.png';
        const name = user?.first_name ? `${user.first_name} ${user.last_name}` : (user?.name || 'Пользователь');
        
        let attachHTML = '';
        if(c.attachments) {
            const photos = c.attachments.filter(a => a.type === 'photo');
            if(photos.length > 0) {
                attachHTML = '<div class="comment-attachments">';
                photos.forEach(ph => {
                     const size = ph.photo.sizes.sort((a,b) => b.width - a.width)[0];
                     const small = ph.photo.sizes.find(s => s.type === 'q') || size;
                     attachHTML += `<img src="${small.url}" class="comment-attach-img" onclick="event.stopPropagation(); window.open('${size.url}', '_blank')">`;
                });
                attachHTML += '</div>';
            }
        }

        const vkLink = `https://vk.com/topic${OWNER}_${REVIEW_TOPIC_ID}?post=${c.id}`;

        const card = document.createElement('div');
        card.className = 'review-card';
        card.onclick = () => window.open(vkLink, '_blank');
        card.innerHTML = `
            <img class="review-avatar" src="${photo}">
            <div class="review-content">
                <div class="review-header">
                    <span class="review-name">${name}</span>
                    <span class="review-date">${new Date(c.date*1000).toLocaleDateString('ru-RU')}</span>
                </div>
                <div class="review-text">${c.text}</div>
                ${attachHTML}
            </div>
        `;
        
        columns[i % colCount].appendChild(card);
    });
    
    document.getElementById('title').innerText = `ОТЗЫВЫ · ${d.response.count}`;
}

function menuShow(l,t,b=false){ document.getElementById("header-progress").style.opacity = 0;
  l.sort((a, b) => {
      const getCount = (item) => {
          if (item.special) return -1;
          let c = 0;
          if (item.isFolder) {
             item.items.forEach(sub => c += (albumCounts[sub.id] || 0));
          } else {
             c = albumCounts[item.id] || 0;
          }
          return c;
      };
      return getCount(b) - getCount(a);
  });

  currentMenu = l;
  alb = null; 
  currentServiceId = null;
  currentFolderId = null;
  currentSection = 'main';
  const r=document.getElementById('area');
  r.innerHTML=''; 
  r.className='grid';
  document.getElementById('title').innerText=t;
  document.getElementById('title').dataset.original = t;
  document.getElementById('subtitle').innerText = b ? '' : `· ${totalWorks} работ${totalWorks % 10 === 1 && totalWorks % 100 !== 11 ? 'а' : 'ы'}`;
  document.getElementById('back').classList.toggle('active',b);
  document.getElementById('tags-bar').style.display = 'none';
  
  document.getElementById('sort').classList.add('active');
  document.getElementById('sort').classList.toggle('active', rev === 0);

  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        const img = entry.target.querySelector('img');
        if (img && img.dataset.src) {
          img.src = img.dataset.src;
          img.onload = () => img.classList.add('loaded');
          delete img.dataset.src;
        }
        observer.unobserve(entry.target);
      }
    });
  }, {rootMargin: '200px'});

  l.forEach(i=>{
    if(i.special) {
        const c=document.createElement('div');
        c.className='card';
        
        
        if (i.type === 'services' || i.type === 'clients') {
             c.className = 'clients-full-width';
             c.style.gridColumn = '1 / -1';
             c.style.width = '100%';
             c.style.cursor = 'default';
             c.style.background = 'transparent';
             c.style.border = 'none';
             c.style.boxShadow = 'none';
             c.innerHTML=`
              <div class="clients-container">
                <div class="clients-header">
                    <svg class="blue-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
                    Среди <span class="marker-underline-wrapper">моих клиентов<svg class="marker-underline-svg" viewBox="0 0 200 15" preserveAspectRatio="none"><path class="marker-path" d="M5,12 C50,14 100,12 195,5" /></svg></span>
<div class="info-icon-wrapper">
  <div class="info-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg></div>
  <div class="info-tooltip">Проекты, над которыми я работал.<br>Нажмите, чтобы открыть кейс.</div>
</div>

                </div>

                <div class="clients-grid">
                    <div class="client-column">
                        <div class="col-title">Компании</div>
                        <div class="tags-wrap">
                            <div class="client-tag blue"><span>Kaino</span><svg class="tag-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div><div class="client-tag"><span>Good Label</span><svg class="tag-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div><div class="client-tag"><span>Призыва.Нет</span><svg class="tag-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div><div class="client-tag"><span>Суши Мама</span><svg class="tag-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div><div class="client-tag blue"><span>Wikkeo</span><svg class="tag-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div><div class="client-tag"><span>СитиПроф</span><svg class="tag-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div><div class="client-tag"><span>D.Roll</span><svg class="tag-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div><div class="client-tag blue"><span>Chop-Chop</span><svg class="tag-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div><div class="client-tag"><span>Метар</span><svg class="tag-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div><div class="client-tag"><span>Black Witer</span><svg class="tag-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div><div class="client-tag"><span>AIRYBEATS</span><svg class="tag-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div><div class="client-tag"><span>Сочи ЮДВ</span><svg class="tag-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div><div class="client-tag blue"><span>Space Base</span><svg class="tag-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div><div class="client-tag"><span>Академия Excel</span><svg class="tag-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div><div class="client-tag"><span>Greefon</span><svg class="tag-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div><div class="client-tag"><span>Сытофф</span><svg class="tag-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div><div class="client-tag blue"><span>Duck Will</span><svg class="tag-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div><div class="client-tag"><span>Cóho</span><svg class="tag-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div><div class="client-tag"><span>Звездный</span><svg class="tag-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div><div class="client-tag blue"><span>Exort</span><svg class="tag-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div><div class="client-tag"><span>Друг Кузя</span><svg class="tag-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div><div class="client-tag"><span>и другие</span><svg class="tag-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div>
                        </div>
                    </div>

                    <div class="client-column">
                        <div class="col-title">Личности</div>
                        <div class="tags-wrap">
                            <div class="client-tag blue"><span>Дмитрий Ладесов</span><svg class="tag-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div><div class="client-tag"><span>Александр Иванищев</span><svg class="tag-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div><div class="client-tag"><span>Ирина Старкова</span><svg class="tag-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div><div class="client-tag"><span>Ника Зебра</span><svg class="tag-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div><div class="client-tag blue"><span>SHKRED</span><svg class="tag-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div><div class="client-tag"><span>Евгений Жамкачиев</span><svg class="tag-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div><div class="client-tag blue"><span>Антон Дейнеко</span><svg class="tag-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div><div class="client-tag"><span>Олеся Новикова</span><svg class="tag-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div><div class="client-tag blue"><span>Анна Вар</span><svg class="tag-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div><div class="client-tag"><span>и другие</span><svg class="tag-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div>
                        </div>
                    </div>
                </div>
              </div>`;
             c.onclick = null;
        }
 else {
            c.innerHTML=`
              <div class="card-img" style="background:#2a2a2c;">
                 <div class="card-icon-center">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#555" stroke-width="1.5"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg>
                 </div>
              </div>
              <div class="card-info">
                <div class="card-title">${i.title}</div>
                <div class="card-count">${albumCounts['reviews'] || 0}</div>
              </div>`;
            c.onclick=()=> openReviewsSection();
        }
        r.appendChild(c);
        return;
    }

    let count = 0;
    let albumId = i.id;
    if (i.isFolder) {
        albumId = i.items[0].id;
        i.items.forEach(sub => count += (albumCounts[sub.id] || 0));
    } else {
        count = albumCounts[i.id] || 0;
    }
    const coverUrl = covers[i.id] || covers[albumId] || '';
    const c=document.createElement('div');
    c.className='card';
    c.innerHTML=`
      <div class="card-img">
        <img data-src="${coverUrl}" alt="">
      </div>
      <div class="card-info">
        <div class="card-title">${i.title}</div>
        <div class="card-count">${count}</div>
      </div>`;
    c.onclick=()=>{
      if(i.isFolder){ 
        hist.push({l: currentMenu, t, b}); 
        currentFolderId = i.id;
        updateUrl(null, null, null, i.id);
        menuShow(i.items,i.title,true); 
      } else { 
        hist.push({l: currentMenu, t, b}); 
        loadAlb(i.id,i.title); 
      }
    };
    r.appendChild(c);
    observer.observe(c.querySelector('.card-img'));
  });
}

function toggleChronological() {
  const currentTitle = document.getElementById('title').dataset.original;
  
  if (currentTitle === "ОТЗЫВЫ") {
      revReviews = revReviews === 1 ? 0 : 1;
      loadReviews();
      return;
  }
  if (currentTitle === "УСЛУГИ") return;

  if(!alb) return; 
  rev = rev === 1 ? 0 : 1;
  document.getElementById('sort').classList.toggle('active', rev === 0);
  
  loadAlb(alb, currentTitle || "Альбом");
}

function loadAlb(id,t){ window.scrollTo(0,0); document.getElementById("header-progress").style.opacity = 1;
  alb=id; 
  currentServiceId = null;
  updateUrl(id);
  const r=document.getElementById('area');
  r.innerHTML='';
  r.className='masonry-wrap';
  document.getElementById('title').innerText=t;
  document.getElementById('title').dataset.original = t; 
  document.getElementById('subtitle').innerText = '';
  document.getElementById('back').classList.add('active');
  document.getElementById('sort').classList.add('active');
  document.getElementById('sort').classList.toggle('active', rev === 0);
  document.getElementById('sort').title = "Сменить порядок";
  
  document.getElementById('tags-bar').style.display = 'none';
  activeTag = null; activeYear = null;

  const colCount = getColCount();
  for(let i=0; i<colCount; i++){
    const col = document.createElement('div');
    col.className = 'placeholder-col';
    col.style.flex = 1;
    r.appendChild(col);
  }
  
  const placeholders = r.querySelectorAll('.placeholder-col');
  for(let i=0; i<12; i++){
      const div = document.createElement('div');
      div.className = 'skel';
      div.style.height = Math.floor(Math.random() * (350 - 150 + 1) + 150) + 'px';
      placeholders[i % colCount].appendChild(div);
  }

  api('photos.get',`owner_id=${OWNER}&album_id=${id}&rev=${rev}&extended=1&count=1000`,'setPhotos');
}

function getColCount() {
    let w = window.innerWidth;
    if (!w || w === 0) w = document.documentElement.clientWidth;
    if (!w || w === 0) w = document.body.clientWidth;
    // Force at least 3 columns for desktop-ish widths even if detection is slightly off
    // But mostly rely on w
    if (w > 1200) return 4;
    if (w > 800) return 3;
    if (w > 500) return 2;
    return 1;
}

function extractTags(items) {
    const tags = new Set();
    items.forEach(item => {
        const text = item.text || '';
        const matches = text.match(/#[а-яА-Яa-zA-Z0-9_]+/g);
        if (matches) {
            matches.forEach(tag => tags.add(tag));
        }
    });
    return Array.from(tags);
}

function renderTags() {
    const tags = extractTags(raw);
    const container = document.getElementById('tags-bar');
    if (tags.length === 0) {
        container.style.display = 'none';
        return;
    }
    
    container.style.display = 'flex';
    container.innerHTML = `<button class="tag-chip active" onclick="filterByTag(null, this)">Все</button>`;
    
    tags.forEach(tag => {
        const btn = document.createElement('button');
        btn.className = 'tag-chip';
        btn.innerText = tag;
        btn.onclick = (e) => filterByTag(tag, e.target);
        container.appendChild(btn);
    });
}

function filterByTag(tag, btnElement) {
    activeTag = tag;
    
    const buttons = document.querySelectorAll('.tag-chip');
    buttons.forEach(b => b.classList.remove('active'));
    btnElement.classList.add('active');
    
    renderYears();
    renderPhotosFromData();
}

function renderPhotosFromData() {
  const r = document.getElementById('area');
  r.innerHTML = '';

  const colCount = getColCount();
  const columns = [];
  
  for(let i=0; i<colCount; i++) {
      const col = document.createElement('div');
      col.className = 'masonry-col';
      r.appendChild(col);
      columns.push(col);
  }

  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        const img = entry.target.querySelector('img');
        if (img && img.dataset.src) {
          img.src = img.dataset.src;
          img.onload = () => img.classList.add('loaded');
          delete img.dataset.src;
        }
        observer.unobserve(entry.target);
      }
    });
  }, {rootMargin: '100px'});

  
    let filteredPhotos = raw;
    if (activeTag) {
        filteredPhotos = filteredPhotos.filter(p => (p.text || '').includes(activeTag));
    }
    if (activeYear) {
        filteredPhotos = filteredPhotos.filter(p => p.date && new Date(p.date*1000).getFullYear() === activeYear);
    }
    

  filteredPhotos.forEach((p, index) => {
    const originalIndex = raw.findIndex(rp => rp.id === p.id);
    const photoObj = photos[originalIndex];
    
    const ratio = p.height && p.width ? (p.height / p.width * 100) : 100;
    
    const div = document.createElement('div');
    div.className = 'photo-item';
    
    const imgContainer = document.createElement('div');
    imgContainer.className = 'img-container';
    imgContainer.style.paddingTop = ratio + '%';

    const img = document.createElement('img');
    img.dataset.src = photoObj.mid;
    img.alt = '';
    
    imgContainer.appendChild(img);
    
    const refBtn = document.createElement('div');
    refBtn.className = 'ref-overlay-btn';
    refBtn.dataset.url = photoObj.full;
    refBtn.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2z"/></svg>';
    refBtn.onclick = (e) => { e.stopPropagation(); toggleRefBtn(photoObj.full, refBtn); };
    if(selectedRefs.has(photoObj.full)) refBtn.classList.add('active');
    div.appendChild(refBtn);
    div.appendChild(imgContainer);

    div.onclick = () => openModal(originalIndex);

    columns[index % colCount].appendChild(div);
    observer.observe(div);
  });
  
  if(filteredPhotos.length === 0) {
      r.innerHTML = '<div class="empty-album">Нет работ с таким тегом</div>';
  }
  
  startBackgroundPreload();
}

window.addEventListener('resize', () => {
    if(alb && raw.length > 0) {
        renderPhotosFromData();
    } else if (!alb && document.getElementById('title').dataset.original === 'ОТЗЫВЫ') {
        loadReviews();
    }
});

window.setPhotos = d => {
  if(!d.response) {
    document.getElementById('area').innerHTML = '<div class="empty-album">В этом альбоме пока нет работ</div>';
    return;
  }
  raw = d.response.items;
  photos = raw.map(p => {
    const sizes = p.sizes || [];
    const gridPriority = ['x', 'r', 'q', 'p', 'o', 'm', 's'];
    let gridSize = null;
    for (const type of gridPriority) { gridSize = sizes.find(s => s.type === type); if (gridSize) break; }
    if (!gridSize && sizes.length > 0) gridSize = [...sizes].sort((a,b) => (a.width||999999) - (b.width||999999))[0];

    const viewPriority = ['z', 'y', 'x', 'w'];
    let viewSize = null;
    for (const type of viewPriority) { viewSize = sizes.find(s => s.type === type); if (viewSize) break; }
    if (!viewSize && sizes.length > 0) viewSize = [...sizes].sort((a,b) => (b.width||0) - (a.width||0))[0];

    const fullSize = sizes.length > 0 ? [...sizes].sort((a,b) => (b.width||0) - (a.width||0))[0] : null;

    return { mid: gridSize ? gridSize.url : '', view: viewSize ? viewSize.url : '', full: fullSize ? fullSize.url : '', width: viewSize ? viewSize.width : 100, height: viewSize ? viewSize.height : 100 };});
  
  raw.forEach((p, i) => {
      p.width = photos[i].width;
      p.height = photos[i].height;
  });

  if (raw.length === 0) {
    document.getElementById('area').innerHTML = '<div class="empty-album">В этом альбоме пока нет работ</div>';
  } else {
    renderTags(); renderYears();
    renderPhotosFromData();
    // Safety re-render for layout stability
    setTimeout(renderPhotosFromData, 100);
  }

  const originalTitle = document.getElementById('title').dataset.original || 'Альбом';
  document.getElementById('title').innerText = `${originalTitle} · ${raw.length}`;
};

function toggleZoom(e) {
    if(window.innerWidth < 800) return;
    const container = document.getElementById('modal-img-container');
    const img = document.getElementById('full');

    if (container.classList.contains('zoomed')) {
        container.classList.remove('zoomed');
    } else {
        const rect = img.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        const percentX = (x / rect.width) * 100;
        const percentY = (y / rect.height) * 100;
        container.style.setProperty('--mouse-x', `${percentX}%`);
        container.style.setProperty('--mouse-y', `${percentY}%`);
        container.classList.add('zoomed');
    }
    e.stopPropagation();
}

function openModal(i){
  const pBar = document.getElementById('modal-progress-bar'); if(pBar && photos.length) pBar.style.width = (((i + 1) / photos.length) * 100) + '%';
  const preview = document.getElementById('preview');
  preview.src = ''; 
  preview.classList.add('fading');
  
  const modalImgContainer = document.getElementById('modal-img-container');
  modalImgContainer.classList.remove('zoomed');

  document.getElementById('full').src = '';
  document.getElementById('full').classList.remove('loaded');

  idx=i; 
  updateUrl(alb, i);
  const p=raw[idx];

    
    const siteLink = location.origin + location.pathname + '?album=' + alb + '&photo=' + (idx + 1);
    const isRef = selectedRefs.has(siteLink);
    const refBtnText = isRef ? '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2z"/></svg> В референсах' : '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2z"/></svg> В референсы';
    const refBtnClass = isRef ? 'ref-btn active' : 'ref-btn';
    const refContainer = document.getElementById('ref-btn-container');
    if(refContainer) {
        refContainer.innerHTML = `<button id="ref-btn" class="${refBtnClass}" onclick="toggleRef(${p.id}, '${siteLink}')">${refBtnText}</button>`;
    }


  document.getElementById('modal').classList.add('open');
  
  document.title = `Работа #${idx+1} - Роман Жегуляев — Портфолио`;

  preview.classList.remove('fading');
  preview.src = photos[idx].mid;
  
  document.getElementById('photo-index').innerText = `${idx+1} из ${raw.length}`;
  document.getElementById('vk-link-orig').href = `https://vk.com/photo${OWNER}_${p.id}`;
  
  document.getElementById('original-link').href = photos[idx].full;
  document.getElementById('download-link').href = photos[idx].full;

  document.getElementById('likes-count').innerText = p.likes.count;
  document.getElementById('likes-box').classList.toggle('has-likes', p.likes.count > 0);
  document.getElementById('comments-count').innerText = p.comments.count;

  const groupAvatar = groupInfo?.photo_50 || 'https://vk.com/images/camera_50.png';
  document.getElementById('header-avatar').src = groupAvatar;
  document.getElementById('header-author').innerText = 'Роман Жегуляев';
  document.getElementById('header-date').innerText = new Date(p.date*1000).toLocaleDateString('ru-RU');

  const textEl = document.getElementById('modal-text');
  textEl.innerText = p.text || '';
  textEl.classList.add('collapsed');
  
  setTimeout(() => {
    const btn = document.getElementById('show-more');
    if (textEl.scrollHeight > 100) {
        btn.classList.add('active');
        btn.innerText = 'Показать ещё';
    } else {
        btn.classList.remove('active');
    }
  }, 10);

  document.getElementById('comments-container').innerHTML = `
    <div class="comments-loader">
      <svg viewBox="0 0 50 50">
        <circle cx="25" cy="25" r="20" fill="none" stroke="#888" stroke-width="5" stroke-dasharray="31.4 31.4" transform="rotate(-90 25 25)">
          <animateTransform attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="1s" repeatCount="indefinite"/>
        </circle>
      </svg>
    </div>`;

  api('photos.getComments', `owner_id=${OWNER}&photo_id=${p.id}&need_likes=1&extended=1`, 'setComments');

  
  document.getElementById('modal-loader').classList.add('active');
  document.getElementById('preview').classList.add('blur');
  const fullImg = new Image();
  fullImg.onload = () => { 
    if(idx===i){ 
      document.getElementById('full').src = fullImg.src; 
      document.getElementById('full').classList.add('loaded'); 
      document.getElementById('modal-loader').classList.remove('active');
      document.getElementById('preview').classList.remove('blur');
      preloadNeighbors(i);
    } 
  };
  fullImg.src = photos[idx].view;
  preloadNeighbors(i);

  scrollBeforeModal = window.scrollY; document.body.style.position = 'fixed'; document.body.style.top = `-${scrollBeforeModal}px`; document.body.style.width = '100%'; document.body.style.overflow = 'hidden';
}

let touchStartY = 0;
let touchEndY = 0;
const modalContent = document.getElementById('modal-content-inner');

modalContent.addEventListener('touchstart', (e) => {
    if(document.getElementById('modal-img-container').classList.contains('zoomed')) return;
    touchStartY = e.changedTouches[0].screenY;
}, {passive: true});

modalContent.addEventListener('touchmove', (e) => {
    if(document.getElementById('modal-img-container').classList.contains('zoomed')) return;
    touchEndY = e.changedTouches[0].screenY;
    const diff = touchEndY - touchStartY;
    if(diff > 0 && window.innerWidth < 1000) {
        modalContent.style.transform = `translateY(${diff}px)`;
    }
}, {passive: true});

modalContent.addEventListener('touchend', (e) => {
    if(document.getElementById('modal-img-container').classList.contains('zoomed')) return;
    touchEndY = e.changedTouches[0].screenY;
    const diff = touchEndY - touchStartY;
    
    if (diff > 150 && window.innerWidth < 1000) {
        closeModal();
    } else {
        modalContent.style.transform = '';
    }
}, {passive: true});


function openOrder(){ document.getElementById('order-modal').classList.add('open'); }
function closeOrder(e){ if(e.target.id==='order-modal') document.getElementById('order-modal').classList.remove('open'); }

function toggleText() {
    const textEl = document.getElementById('modal-text');
    const btn = document.getElementById('show-more');
    if (textEl.classList.contains('collapsed')) {
        textEl.classList.remove('collapsed');
        btn.innerText = 'Свернуть';
    } else {
        textEl.classList.add('collapsed');
        btn.innerText = 'Показать ещё';
    }
}

function copyLink() {
    const url = window.location.href;
    navigator.clipboard.writeText(url).then(() => {
        alert('Ссылка скопирована!');
    });
}

window.setComments = d => {
    const cDiv = document.getElementById('comments-container');
    if(!d.response || d.response.items.length === 0) {
        cDiv.innerHTML = `<div style="text-align:center; padding:30px 10px; color:#555;">Комментариев пока нет</div>`;
        return;
    }
    cDiv.innerHTML = '';
    const profiles = d.response.profiles || [];
    const groups = d.response.groups || [];

    d.response.items.forEach(c => {
        let ownerId = c.from_id;
        let user;
        if (ownerId > 0) {
            user = profiles.find(u => u.id === ownerId);
        } else {
            user = groups.find(g => g.id === -ownerId);
        }

        const photo = user?.photo_50 || user?.photo_100 || 'https://vk.com/images/camera_100.png';
        const name = user?.first_name ? `${user.first_name} ${user.last_name}` : (user?.name || 'Пользователь');
        
        let attachmentsHTML = '';
        if (c.attachments) {
            const photosAtt = c.attachments.filter(a => a.type === 'photo');
            if (photosAtt.length > 0) {
                attachmentsHTML = '<div class="comment-attachments">';
                photosAtt.forEach(ph => {
                    const size = ph.photo.sizes.sort((a,b) => b.width - a.width)[0];
                    const small = ph.photo.sizes.find(s => s.type === 'q') || size;
                    attachmentsHTML += `<img src="${small.url}" class="comment-attach-img" onclick="window.open('${size.url}', '_blank')">`;
                });
                attachmentsHTML += '</div>';
            }
        }
        
        const item = document.createElement('div');
        item.className = 'comment-item';
        item.innerHTML = `
            <img class="comment-avatar" src="${photo}" onerror="this.src='https://vk.com/images/camera_100.png'">
            <div class="comment-body">
                <span class="comment-name" onclick="window.open('https://vk.com/id${Math.abs(ownerId)}', '_blank')">${name}</span>
                <div class="comment-text">${c.text || ''}</div>
                ${attachmentsHTML}
                <div style="color:#666; font-size:11px; margin-top:4px;">${new Date(c.date*1000).toLocaleDateString('ru-RU')}</div>
            </div>`;
        cDiv.appendChild(item);
    });
};

function move(d){ idx=(idx+d+photos.length)%photos.length; openModal(idx); }

function closeModal(e){ 
  if (e && e.target !== document.getElementById('modal') && e.target.closest && !e.target.closest('.close-in-modal')) return;
  document.getElementById('modal').classList.remove('open'); 
  document.getElementById('order-modal').classList.remove('open');
  document.title = 'Роман Жегуляев — Портфолио';
  document.getElementById('modal-content-inner').style.transform = '';
  updateUrl(alb, null, currentServiceId, currentFolderId, currentSection === 'main' ? null : currentSection);
  document.body.style.overflow = ''; document.body.style.position = ''; document.body.style.top = ''; document.body.style.width = ''; window.scrollTo(0, scrollBeforeModal); 
}

function goBack(){ 
  if(hist.length > 0){ 
    const p=hist.pop(); 
    menuShow(p.l,p.t,p.b); 
    updateUrl();
  } 
}

document.addEventListener('keydown', e => {
    if (e.key === 'Escape') closeModal({target: document.getElementById('modal')});
    if (document.getElementById('modal').classList.contains('open')) {
        if (e.key === 'ArrowRight') move(1);
        if (e.key === 'ArrowLeft') move(-1);
    }
});

api('photos.getAlbums',`owner_id=${OWNER}&need_covers=1`,'saveCovers');

function toggleRef(id, url) {
    const btn = document.getElementById('ref-btn');
    if (selectedRefs.has(url)) {
        selectedRefs.delete(url);
        if(btn) { btn.classList.remove('active'); btn.innerText = 'Добавить в референсы'; }
    } else {
        selectedRefs.add(url);
        if(btn) { btn.classList.add('active'); btn.innerText = 'В референсах (удалить)'; }
    }
    updateRefBar();
}

function copyRefs() {
    const links = Array.from(selectedRefs).join('\n');
    navigator.clipboard.writeText(links).then(() => { alert('Ссылки скопированы!'); });
}
function clearRefs() {
    selectedRefs.clear();
    updateRefBar();
    const btn = document.getElementById('ref-btn');
    if(btn) { btn.classList.remove('active'); btn.innerText = 'Добавить в референсы'; }
}


function showToast(msg) {
    let t = document.getElementById('toast');
    if(!t) {
        t = document.createElement('div');
        t.id = 'toast';
        document.body.appendChild(t);
    }
    t.innerText = msg;
    t.classList.add('show');
    setTimeout(() => t.classList.remove('show'), 3000);
}

function toggleRef(id, url) {
    const btn = document.getElementById('ref-btn');
    if (selectedRefs.has(url)) {
        selectedRefs.delete(url);
        if(btn) { 
            btn.classList.remove('active'); 
            btn.innerHTML = '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2z"/></svg> В референсы'; 
        }
    } else {
        selectedRefs.add(url);
        if(btn) { 
            btn.classList.add('active'); 
            btn.innerHTML = '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2z"/></svg> В референсах'; 
        }
    }
    updateRefBar();
}



function copyRefs() {
    const links = Array.from(selectedRefs).join('\n');
    navigator.clipboard.writeText(links).then(() => {
        showToast('Ссылки скопированы!');
    });
}

function clearRefs() {
    selectedRefs.clear();
    updateRefBar();
    const btn = document.getElementById('ref-btn');
    if(btn) { 
        btn.classList.remove('active'); 
        btn.innerHTML = '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2z"/></svg> В референсы'; 
    }
}



function preloadImage(url) { if (!url) return; const img = new Image(); img.src = url; }
function preloadNeighbors(index) {
  if (!photos || photos.length === 0) return;
  const nextIdx = (index + 1) % photos.length; if (photos[nextIdx]?.view) preloadImage(photos[nextIdx].view);
  const prevIdx = (index - 1 + photos.length) % photos.length; if (photos[prevIdx]?.view) preloadImage(photos[prevIdx].view);
  const nextNextIdx = (index + 2) % photos.length; if (photos[nextNextIdx]?.view) preloadImage(photos[nextNextIdx].view);
}


function renderFooterSocials() {
  const area = document.getElementById('area');
  if (!area) return;
  if (document.querySelector('.footer-socials')) return;
  const footer = document.createElement('div');
  footer.className = 'footer-socials';
  footer.innerHTML = `
    <a href="https://vk.com/dsgnjr" target="_blank" class="footer-link" title="Группа ВКонтакте">
      <div class="footer-icon vk-group-icon">
        <svg viewBox="0 0 24 24"><path fill="currentColor" d="M15.013 19.43c-5.83 0-9.138-3.99-9.278-10.645H8.62c.1 4.88 2.25 6.944 3.955 7.37V8.785h2.75v4.209c1.683-.18 3.44-2.09 4.037-4.21h2.75a8.77 8.77 0 01-3.71 5.378 8.875 8.875 0 014.288 5.268h-3.023a5.55 5.55 0 00-4.04-3.614v3.614h-1.874z"/></svg>
      </div>
      <div class="footer-text"><div class="footer-title">Группа VK</div><div class="footer-sub" id="vk-group-members">Подписаться</div></div>
    </a>
    <a href="https://t.me/r_zhegulyaev" target="_blank" class="footer-link" title="Telegram канал">
      <div class="footer-icon tg-icon">
        <svg viewBox="0 0 24 24"><path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.8c-.15 1.58-.8 5.42-1.13 7.19-.14.75-.42 1-.68 1.03-.58.05-1.02-.38-1.58-.75-.88-.58-1.38-.94-2.23-1.5-.99-.65-.35-1.01.22-1.59.15-.15 2.71-2.48 2.76-2.69a.2.2 0 00-.05-.18c-.06-.05-.14-.03-.21-.02-.09.02-1.49.95-4.22 2.79-.4.27-.76.41-1.08.4-.36-.01-1.04-.2-1.55-.37-.63-.2-1.12-.31-1.08-.66.02-.18.27-.36.74-.55 2.91-1.27 4.85-2.11 5.82-2.52 2.77-1.16 3.35-1.36 3.72-1.37.08 0 .27.02 .39.12.1.08.13.19.14.27-.01.06.01.24 0 .38z"/></svg>
      </div>
      <div class="footer-text"><div class="footer-title">Telegram</div><div class="footer-sub">3к+ подписчиков</div></div>
    </a>
    <a href="https://vk.com/zhegulyaev" target="_blank" class="footer-link" title="Страница ВКонтакте">
      <div class="footer-icon vk-user-icon">
        <svg viewBox="0 0 24 24"><path fill="currentColor" d="M15.013 19.43c-5.83 0-9.138-3.99-9.278-10.645H8.62c.1 4.88 2.25 6.944 3.955 7.37V8.785h2.75v4.209c1.683-.18 3.44-2.09 4.037-4.21h2.75a8.77 8.77 0 01-3.71 5.378 8.875 8.875 0 014.288 5.268h-3.023a5.55 5.55 0 00-4.04-3.614v3.614h-1.874z"/></svg>
      </div>
      <div class="footer-text"><div class="footer-title">Страница VK</div><div class="footer-sub">Профиль</div></div>
    </a>
    <a href="https://www.behance.net/r_zhegulyaev" target="_blank" class="footer-link" title="Behance">
      <div class="footer-icon be-icon">
        <svg viewBox="0 0 16 16"><path fill="currentColor" d="M4.654 3c.461 0 .887.035 1.278.14.39.07.711.216.996.391s.497.426.641.747c.14.32.216.711.216 1.137 0 .496-.106.922-.356 1.242-.215.32-.566.606-.997.817.606.176 1.067.496 1.348.922s.461.957.461 1.563c0 .496-.105.922-.285 1.278a2.3 2.3 0 0 1-.782.887c-.32.215-.711.39-1.137.496a5.3 5.3 0 0 1-1.278.176L0 12.803V3zm-.285 3.978c.39 0 .71-.105.957-.285.246-.18.355-.497.355-.887 0-.216-.035-.426-.105-.567a1 1 0 0 0-.32-.355 1.8 1.8 0 0 0-.461-.176c-.176-.035-.356-.035-.567-.035H2.17v2.31c0-.005 2.2-.005 2.2-.005zm.105 4.193c.215 0 .426-.035.606-.07.176-.035.356-.106.496-.216s.25-.215.356-.39c.07-.176.14-.391.14-.641 0-.496-.14-.852-.426-1.102-.285-.215-.676-.32-1.137-.32H2.17v2.734h2.305zm6.858-.035q.428.427 1.278.426c.39 0 .746-.106 1.032-.286q.426-.32.53-.64h1.74c-.286.851-.712 1.457-1.278 1.848-.566.355-1.243.566-2.06.566a4.1 4.1 0 0 1-1.527-.285 2.8 2.8 0 0 1-1.137-.782 2.85 2.85 0 0 1-.712-1.172c-.175-.461-.25-.957-.25-1.528 0-.531.07-1.032.25-1.493.18-.46.426-.852.747-1.207.32-.32.711-.606 1.137-.782a4 4 0 0 1 1.493-.285c.606 0 1.137.105 1.598.355.46.25.817.532 1.102.958.285.39.496.851.641 1.348.07.496.105.996.07 1.563h-5.15c0 .58.21 1.11.496 1.396m2.24-3.732c-.25-.25-.642-.391-1.103-.391-.32 0-.566.07-.781.176s-.356.25-.496.39a.96.96 0 0 0-.25.497c-.036.175-.07.32-.07.46h3.196c-.07-.526-.25-.882-.497-1.132zm-3.127-3.728h3.978v.957h-3.978z"/></svg>
      </div>
      <div class="footer-text"><div class="footer-title">Behance</div><div class="footer-sub">Портфолио</div></div>
    </a>
    <a href="https://ru.pinterest.com/zhegulyaev/" target="_blank" class="footer-link" title="Pinterest">
      <div class="footer-icon pin-icon">
        <svg viewBox="0 0 24 24"><path fill="currentColor" d="M12.017 0C5.396 0 .029 5.367.029 11.987c0 5.079 3.158 9.417 7.618 11.162-.105-.949-.199-2.403.041-3.439.219-.937 1.406-5.957 1.406-5.957s-.359-.72-.359-1.781c0-1.663.967-2.911 2.168-2.911 1.024 0 1.518.769 1.518 1.688 0 1.029-.653 2.567-.992 3.992-.285 1.193.6 2.165 1.775 2.165 2.128 0 3.768-2.245 3.768-5.487 0-2.861-2.063-4.869-5.008-4.869-3.41 0-5.409 2.562-5.409 5.199 0 1.033.394 2.143.889 2.741.099.12.112.225.085.345-.09.375-.293 1.199-.334 1.363-.053.225-.172.271-.399.165-1.487-.695-2.435-2.878-2.435-4.646 0-3.776 2.748-7.252 7.951-7.252 4.173 0 7.41 2.967 7.41 6.923 0 4.135-2.607 7.462-6.233 7.462-1.214 0-2.354-.629-2.758-1.379l-.749 2.848c-.269 1.045-1.004 2.352-1.498 3.146 1.123.345 2.306.535 3.55.535 6.607 0 11.985-5.365 11.985-11.987C23.97 5.367 18.62 0 12.017 0z"/></svg>
      </div>
      <div class="footer-text"><div class="footer-title">Pinterest</div><div class="footer-sub">Вдохновение</div></div>
    </a>
  `;
  area.insertAdjacentElement('afterend', footer);
  updateFooterMembers();
}
function updateFooterMembers() {
  if (typeof groupInfo !== 'undefined' && groupInfo && groupInfo.members_count) {
    const el = document.getElementById('vk-group-members');
    if (el) el.textContent = groupInfo.members_count.toLocaleString('ru-RU') + ' подписчиков';
  }
}
window.addEventListener('DOMContentLoaded', renderFooterSocials);


window.addEventListener('scroll', () => {
    // Progress Bar Logic
    const bar = document.getElementById('header-progress');
    if (alb && bar) {
        const scrollTop = window.scrollY;
        const docHeight = document.documentElement.scrollHeight - window.innerHeight;
        const scrollPercent = docHeight > 0 ? (scrollTop / docHeight) * 100 : 0;
        bar.style.width = scrollPercent + '%';
    }

    const btn = document.getElementById('scroll-top');
    if (!btn) return;
    if (window.scrollY > 300) {
        btn.classList.add('visible');
    } else {
        btn.classList.remove('visible');
    }
});

</script>

<script>
// --- GLOBALS ---
let activeYear = null;
let lastScrollPos = 0;
const REF_TTL = 86400000; 
const REF_KEY = 'refs_v5'; 
const REF_TIME = 'refs_time_v5';

// --- YEAR FILTER LOGIC ---
function renderYears() {
    const years = new Set();
    raw.forEach(p => {
        if(p.date) {
            const y = new Date(p.date * 1000).getFullYear();
            years.add(y);
        }
    });
    const sortedYears = Array.from(years).sort((a,b) => b - a);

    const container = document.getElementById('years-bar');
    if(sortedYears.length < 2) { 
        container.style.display = 'none'; 
        return; 
    }

    container.style.display = 'flex';
    container.innerHTML = `<button class="year-chip ${activeYear===null?'active':''}" onclick="filterByYear(null, this)">Все года</button>`;

    sortedYears.forEach(y => {
        container.innerHTML += `<button class="year-chip ${activeYear===y?'active':''}" onclick="filterByYear(${y}, this)">${y}</button>`;
    });
}

function filterByYear(year, btn) {
    activeYear = year;
    document.querySelectorAll('.year-chip').forEach(b => b.classList.remove('active'));
    if(btn) btn.classList.add('active');
    renderPhotosFromData(); // Re-render grid
}

// --- SCROLL ---
const indicator = document.getElementById('scroll-indicator');
function handleLeftScroll() { if(document.getElementById('modal') && document.getElementById('modal').classList.contains('open')) return;
    const currentY = window.scrollY;
    if (currentY > 100) {
        lastScrollPos = currentY;
        window.scrollTo({ top: 0, behavior: 'auto' });
        if(indicator) indicator.innerText = '↓';
    } else if (lastScrollPos > 0) {
        window.scrollTo({ top: lastScrollPos, behavior: 'auto' });
        lastScrollPos = 0;
        if(indicator) indicator.innerText = '↑';
    }
}
window.addEventListener('scroll', () => {
    if(!indicator) return;
    if(window.scrollY > 100) indicator.innerText = '↑';
    else if (lastScrollPos > 0) indicator.innerText = '↓';
});

// --- SUBSCRIBE ---
function toggleSubscribe(btn) {
    if(!btn.classList.contains('btn-subscribed')) {
        window.open('https://vk.com/dsgnjr', '_blank');
        btn.classList.add('btn-subscribed');
        btn.innerHTML = 'Вы подписаны';
        localStorage.setItem('user_subscribed', 'true');
    } else {
        btn.classList.remove('btn-subscribed');
        btn.innerHTML = 'Подписаться';
        localStorage.removeItem('user_subscribed');
    }
}
window.addEventListener('load', () => {
    if(localStorage.getItem('user_subscribed') === 'true') {
        document.querySelectorAll('.btn').forEach(b => {
            if(b.innerText.includes('Подписаться')) {
                b.classList.add('btn-subscribed');
                b.innerHTML = 'Вы подписаны';
                b.onclick = (e) => { e.preventDefault(); toggleSubscribe(b); };
            }
        });
    } else {
         document.querySelectorAll('.btn').forEach(b => {
            if(b.innerText.includes('Подписаться')) b.onclick = (e) => { e.preventDefault(); toggleSubscribe(b); };
         });
    }
    restoreRefs();
    renderYears(); // Initial render if data exists (might need hook into setPhotos)
});

// --- REFS ---
function updateRefBar() {
    let bar = document.getElementById('ref-bar');
    if (!bar) {
        bar = document.createElement('div');
        bar.id = 'ref-bar';
        document.body.appendChild(bar);
    }
    const count = selectedRefs.size;
    bar.innerHTML = `
        <div style="font-weight:500; font-size:14px; margin-right:5px;">Выбрано: ${count}</div>
        <button class="ref-btn-icon" onclick="copyRefs()">
             <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4C2.9 1 2 1.9 2 3V17H4V3H16V1ZM19 5H8C6.9 5 6 5.9 6 7V21C6 22.1 6.9 23 8 23H19C20.1 23 21 22.1 21 21V7C21 5.9 20.1 5 19 5ZM19 21H8V7H19V21Z"/></svg>
             Ссылки
        </button>
        <button class="ref-btn-icon" onclick="downloadRefsArchive()">
             <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>
             Архив
        </button>
        <button onclick="clearRefs(); persistRefs();" style="background:none; border:none; color:#aaa; font-size:20px; cursor:pointer; margin-left:5px;">&times;</button>
    `;
    bar.classList.toggle('visible', count > 0);
    persistRefs();
    document.querySelectorAll('.ref-overlay-btn').forEach(b => {
        b.classList.toggle('active', selectedRefs.has(b.dataset.url));
    });
}
function persistRefs() {
    if(selectedRefs.size > 0) {
        localStorage.setItem(REF_KEY, JSON.stringify([...selectedRefs]));
        localStorage.setItem(REF_TIME, Date.now());
    } else {
        localStorage.removeItem(REF_KEY);
        localStorage.removeItem(REF_TIME);
    }
}
function restoreRefs() {
    const saved = localStorage.getItem(REF_KEY);
    const time = localStorage.getItem(REF_TIME);
    if(saved && time && (Date.now() - time < REF_TTL)) {
        JSON.parse(saved).forEach(i => selectedRefs.add(i));
        updateRefBar();
    }
}
function toggleRefBtn(url, btn) {
    if(selectedRefs.has(url)) selectedRefs.delete(url);
    else selectedRefs.add(url);
    updateRefBar();
}
async function downloadRefsArchive() {
    if(selectedRefs.size === 0) return;
    const zip = new JSZip();
    const folder = zip.folder("references");
    const links = [...selectedRefs];
    const btn = document.querySelector('#ref-bar button:nth-child(3)');
    const old = btn.innerHTML;
    btn.innerHTML = '...';
    for(let i=0; i<links.length; i++) {
        try { const blob = await fetch(links[i]).then(r => r.blob()); folder.file(`ref_${i+1}.jpg`, blob); } catch(e) {}
    }
    zip.generateAsync({type:"blob"}).then(c => {
        const a = document.createElement("a");
        a.href = URL.createObjectURL(c);
        a.download = "refs.zip";
        a.click();
        btn.innerHTML = old;
        clearRefs();
    });
}

// --- MOBILE ---
document.addEventListener('DOMContentLoaded', () => {
    const i = document.getElementById('menu-icon');
    const n = document.querySelector('.navbar');
    if(i && n) i.onclick = () => n.classList.toggle('active');
});
</script>

<div id="toast-notification">⚠️ Лучше выбрать 2-3 примера, этого достаточно</div>
       <div id="verified-tooltip" style="display:none; position:absolute; background:#19191a; border:1px solid rgba(255,255,255,0.1); padding:16px; border-radius:12px; width:260px; box-shadow:0 10px 40px rgba(0,0,0,0.8); z-index:10060; text-align:left; pointer-events:none;">
            <div style="font-weight:600; color:#fff; margin-bottom:6px; font-size:14px;">Верифицированное сообщество</div>
            <div style="color:#9fa0a5; font-size:13px; line-height:1.4;">Это официальное сообщество известной персоны или организации.</div>
            <div style="position:absolute; bottom:-6px; left:20px; width:12px; height:12px; background:#19191a; transform:rotate(45deg); border-bottom:1px solid rgba(255,255,255,0.1); border-right:1px solid rgba(255,255,255,0.1);"></div>
       </div>
    
<script>
// --- v68 FULL LOGIC ---

var activeMonth = null;
var globalReviewsCount = 0;
const MY_OWNER_ID = '163936790'; 
const MY_TOPIC_ID = '37742383';
const monthNamesList = ["Январь", "Февраль", "Март", "Апрель", "Май", "Июнь", "Июль", "Август", "Сентябрь", "Октябрь", "Ноябрь", "Декабрь"];

// 1. CURSOR
(function() {
    const c = document.createElement('div'); c.className = 'custom-cursor';
    const d = document.createElement('div'); d.className = 'custom-cursor-dot';
    document.body.appendChild(c); document.body.appendChild(d);
    window.addEventListener('mousemove', e => {
        c.style.left = e.clientX + 'px'; c.style.top = e.clientY + 'px';
        d.style.left = e.clientX + 'px'; d.style.top = e.clientY + 'px';
    });
    document.addEventListener('mouseover', e => {
        if(e.target.closest('button') || e.target.closest('a') || e.target.closest('.card') || e.target.closest('.photo-item')) c.classList.add('hover');
    });
    document.addEventListener('mouseout', () => c.classList.remove('hover'));
})();

// 2. FETCH REVIEWS COUNT
function fetchReviewsCount() {
    if(typeof api === 'function') {
        window.handleReviewsCount = function(d) {
            if(d.response && d.response.count) {
                globalReviewsCount = d.response.count;
                if(window.groupInfo) renderGroupHeader(window.groupInfo);
            }
        };
        api('board.getComments', `group_id=${MY_OWNER_ID}&topic_id=${MY_TOPIC_ID}&extended=1&count=0`, 'handleReviewsCount');
    }
}

// 3. OVERRIDE RENDER HEADER
window.renderGroupHeader = function(g) {
    if(!g) return;
    const container = document.getElementById('profile-header');
    const photo = g.photo_200 || 'https://vk.com/images/camera_200.png';
    const name = g.name;
    const members = g.members_count ? g.members_count.toLocaleString('ru-RU') : 0;
    const desc = g.status || g.description || '';

    // BADGE WITH WHITE BG
    // We create a small white circle container, and put the blue badge on top/inside.
    // SVG is 20x20. Circle should be smaller (14x14) behind it? Or same size?
    // User: "podlozku krugluyu... ne budet vyhodit za kraya iconki". 
    // So background must be slightly smaller than the icon (inset).
    const badge = `
    <div style="position:relative; width:20px; height:20px; margin-left:6px; cursor:pointer;" onmouseenter="showTooltip(this)" onmouseleave="hideTooltip()">
        <div style="position:absolute; top:3px; left:3px; width:14px; height:14px; background:white; border-radius:50%;"></div>
        <svg id="verified-icon" width="20" height="20" viewBox="0 0 24 24" fill="#0077FF" style="position:relative; z-index:2;"><path d="M23 12l-2.44-2.79.34-3.69-3.61-.82-1.89-3.2L12 2.96 8.6 1.5 6.71 4.69 3.1 5.5l.34 3.69L1 12l2.44 2.79-.34 3.69 3.61.82 1.89 3.2 3.4-1.47 3.4 1.47 1.89-3.2 3.61-.82-.34-3.69L23 12zm-12.91 4.72l-3.8-3.81 1.48-1.48 2.32 2.33 5.85-5.87 1.48 1.48-7.33 7.35z"/></svg>
    </div>`;

    // RATING STARS (With Count)
    // Count color: Grey (#999)
    const countText = globalReviewsCount > 0 ? `<span style="color:#888; font-weight:400; margin-left:4px;"> · ${globalReviewsCount} отзывов</span>` : '';
    const rating = `
    <div id="header-rating" onclick="openReviewsSection()" style="display:flex; align-items:center; gap:6px; margin-top:8px; margin-bottom:12px; cursor:pointer;">
        <div style="display:flex; gap:2px; color:#FFA000;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
        </div>
        <div style="font-size:14px;">
            <span style="font-weight:700; color:#fff;">5.0</span>
            ${countText}
        </div>
    </div>`;

    container.innerHTML = `
        <div style="display:flex;flex-direction:column;align-items:center;">
            <a href="https://vk.ru/dsgnjr" target="_blank" class="profile-main-link" style="text-decoration:none;color:inherit;display:flex;flex-direction:column;align-items:center;">
                <img class="profile-avatar" src="${photo}" alt="${name}">
                <div style="display:flex; align-items:center;">
                    <h2 class="profile-name" style="margin:0;">${name}</h2>
                    ${badge}
                </div>
            </a>
            ${rating}
        </div>
        ${desc ? `<p class="profile-desc">${desc}</p>` : ''}
        <a href="https://vk.ru/dsgnjr" target="_blank" class="profile-meta hover-subs" style="text-decoration:none; color:inherit; cursor:pointer;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
            ${members} подписчиков
        </a>
        
<div class="profile-actions">
    <!-- Discuss Project (RED #ff3347) -->
    <a onclick="openOrder()" class="btn-header-primary">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
        <span>Обсудить проект</span>
    </a>

    <!-- Subscribe (Gray) -->
    <a href="https://vk.com/dsgnjr" target="_blank" class="btn-secondary-styled">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="8.5" cy="7" r="4"></circle><line x1="20" y1="8" x2="20" y2="14"></line><line x1="23" y1="11" x2="17" y2="11"></line></svg>
        <span>Подписаться</span>
    </a>

    <!-- Reviews (Gray, Blue Badge) -->
    <div onclick="openReviewsSection()" class="btn-secondary-styled">
        <div class="review-icon-box">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="currentColor"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></svg>
            <div class="review-badge" id="reviews-badge-count">458</div>
        </div>
        <span>Отзывы</span>
    </div>
</div>

        </div>
    `;
};

window.showTooltip = function(el) {
    const t = document.getElementById('verified-tooltip');
    const rect = el.getBoundingClientRect();
    t.style.display = 'block';
    t.style.top = (rect.top - t.offsetHeight - 10) + 'px';
    t.style.left = (rect.left + rect.width/2 - 20) + 'px'; // Adjusted left for top-left aligned
};
window.hideTooltip = function() {
    document.getElementById('verified-tooltip').style.display = 'none';
};

// 4. OVERRIDE RENDER GRID
window.renderPhotosFromData = function() {
  const r = document.getElementById('area');
  r.innerHTML = '';
  const colCount = (window.innerWidth <= 768) ? 2 : 4; 
  const columns = [];
  r.style.display = 'flex'; r.style.gap = '20px';
  for(let i=0; i<colCount; i++) {
      const col = document.createElement('div');
      col.className = 'masonry-col';
      col.style.flex = '1'; col.style.display = 'flex'; col.style.flexDirection = 'column'; col.style.gap = '20px';
      r.appendChild(col);
      columns.push(col);
  }

  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        const img = entry.target.querySelector('img');
        if (img && img.dataset.src) {
          img.src = img.dataset.src;
          img.onload = () => img.classList.add('loaded');
          delete img.dataset.src;
        }
        observer.unobserve(entry.target);
      }
    });
  }, {rootMargin: '100px'});

  let filteredPhotos = raw;
  if (activeTag) { filteredPhotos = filteredPhotos.filter(p => (p.text || '').includes(activeTag)); }
  if (activeYear) {
      filteredPhotos = filteredPhotos.filter(p => p.date && new Date(p.date*1000).getFullYear() === activeYear);
      if (activeMonth !== null) { filteredPhotos = filteredPhotos.filter(p => p.date && new Date(p.date*1000).getMonth() === activeMonth); }
  }

  filteredPhotos.forEach((p, index) => {
    const originalIndex = raw.findIndex(rp => rp.id === p.id);
    const photoObj = photos[originalIndex];
    const ratio = p.height && p.width ? (p.height / p.width * 100) : 100;

    const div = document.createElement('div');
    div.className = 'photo-item';
    const imgContainer = document.createElement('div');
    imgContainer.className = 'img-container';
    imgContainer.style.paddingTop = ratio + '%';
    imgContainer.style.position = 'relative';

    const img = document.createElement('img');
    img.dataset.src = photoObj.mid; img.alt = '';
    imgContainer.appendChild(img);

    const refBtn = document.createElement('div');
    refBtn.className = 'ref-overlay-btn';
    refBtn.dataset.url = photoObj.full;
    refBtn.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2z"/></svg>';
    if(selectedRefs.has(photoObj.full)) refBtn.classList.add('active');

    refBtn.onclick = (e) => { e.stopPropagation(); toggleRefBtn(photoObj.full, refBtn); };
    imgContainer.appendChild(refBtn);

    div.appendChild(imgContainer);
    div.onclick = () => openAlbumById(alb, index); 

    let shortestCol = columns[0];
    for(let c of columns) { if(c.offsetHeight < shortestCol.offsetHeight) shortestCol = c; }
    shortestCol.appendChild(div);
    observer.observe(div);
  });
};

// 5. REST OF LOGIC
function renderDateFilters() {
    const years = new Set();
    const monthsInYear = {};
    raw.forEach(p => {
        if(p.date) {
            const d = new Date(p.date * 1000);
            const y = d.getFullYear();
            const m = d.getMonth();
            years.add(y);
            if(!monthsInYear[y]) monthsInYear[y] = new Set();
            monthsInYear[y].add(m);
        }
    });

    const sortedYears = Array.from(years).sort((a,b) => b - a);
    const yContainer = document.getElementById('years-bar');
    const mContainer = document.getElementById('months-bar');
    if(!yContainer) return;

    if(sortedYears.length < 2) {
        yContainer.style.display = 'none';
        if(mContainer) mContainer.style.display = 'none';
        return;
    }

    yContainer.style.display = 'flex';
    yContainer.innerHTML = `<button class="year-chip ${activeYear===null?'active':''}" onclick="setYear(null)">Все</button>` + 
        sortedYears.map(y => `<button class="year-chip ${activeYear===y?'active':''}" onclick="setYear(${y})">${y}</button>`).join('');

    if(mContainer) {
        if(activeYear && monthsInYear[activeYear]) {
            const sortedMonths = Array.from(monthsInYear[activeYear]).sort((a,b) => a - b);
            mContainer.style.display = 'flex';
            mContainer.innerHTML = `<button class="month-chip ${activeMonth===null?'active':''}" onclick="setMonth(null)">Весь год</button>` + 
                sortedMonths.map(m => `<button class="month-chip ${activeMonth===m?'active':''}" onclick="setMonth(${m})">${monthNamesList[m]}</button>`).join('');
        } else {
            mContainer.style.display = 'none';
        }
    }
}

window.setYear = function(y) { activeYear = y; activeMonth = null; renderDateFilters(); renderPhotosFromData(); };
window.setMonth = function(m) { activeMonth = m; renderDateFilters(); renderPhotosFromData(); };
window.renderYears = function() { renderDateFilters(); }; 

window.toggleRefBtn = function(url, btn) {
    if(selectedRefs.has(url)) {
        selectedRefs.delete(url);
    } else {
        selectedRefs.add(url);
        if(selectedRefs.size > 3) {
            showToast("⚠️ Лучше выбрать 2-3 примера, этого достаточно (но можно и больше)");
        }
    }
    updateRefBar();
};

window.updateRefBar = function() {
    let bar = document.getElementById('ref-bar');
    if(!bar) {
        bar = document.createElement('div');
        bar.id = 'ref-bar';
        bar.style.cssText = "position:fixed; bottom:20px; left:50%; transform:translateX(-50%); background:rgba(20,20,20,0.9); padding:10px 20px; border-radius:50px; display:flex; gap:15px; align-items:center; z-index:999; border:1px solid rgba(255,255,255,0.1); backdrop-filter:blur(10px); transition: transform 0.3s, opacity 0.3s; opacity:0; pointer-events:none; transform:translate(-50%, 20px); box-shadow:0 10px 30px rgba(0,0,0,0.5);";
        bar.innerHTML = `
            <span id="ref-count" style="font-weight:600; color:#fff;">0</span>
            <div style="width:1px; height:20px; background:rgba(255,255,255,0.2);"></div>
            <button onclick="copyRefLinks()" title="Скопировать список" style="background:none; border:none; color:#fff; cursor:pointer; font-family:inherit; font-size:14px; display:flex; align-items:center; gap:6px;">
               <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"/></svg>
               Копия
            </button>
            <button onclick="downloadRefsArchive()" title="Скачать архивом" style="background:none; border:none; color:#fff; cursor:pointer; font-family:inherit; font-size:14px; display:flex; align-items:center; gap:6px;">
               <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
               Архив
            </button>
            <button onclick="clearRefs()" style="background:none; border:none; color:#ff5555; cursor:pointer; margin-left:5px; font-size:18px;">&times;</button>
        `;
        document.body.appendChild(bar);
    }
    const count = selectedRefs.size;
    const txt = bar.querySelector('#ref-count');
    if(txt) txt.innerText = count + (count === 1 ? ' пример' : (count < 5 ? ' примера' : ' примеров'));

    if(count > 0) {
        bar.style.opacity = '1'; bar.style.pointerEvents = 'auto'; bar.style.transform = 'translate(-50%, 0)';
    } else {
        bar.style.opacity = '0'; bar.style.pointerEvents = 'none'; bar.style.transform = 'translate(-50%, 20px)';
    }
    document.querySelectorAll('.ref-overlay-btn').forEach(b => {
        if(selectedRefs.has(b.dataset.url)) b.classList.add('active'); else b.classList.remove('active');
    });
    localStorage.setItem('refs_v5', JSON.stringify([...selectedRefs]));
};

window.copyRefLinks = function() {
    const links = [...selectedRefs];
    const text = "Мне понравились вот эти примеры:\n\n" + links.join('\n');
    navigator.clipboard.writeText(text).then(() => { showToast("✅ Ссылки скопированы!"); }).catch(err => { showToast("❌ Ошибка копирования"); });
};

window.showToast = function(msg) {
    const t = document.getElementById('toast-notification');
    if(t) {
        t.innerText = msg;
        t.classList.add('show');
        setTimeout(() => t.classList.remove('show'), 3500);
    }
}

document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
        if(selectedRefs.size > 0) {
            selectedRefs.clear(); updateRefBar(); showToast("Выбор отменен");
        }
    }
});
window.addEventListener('scroll', () => {
    const docHeight = document.documentElement.scrollHeight - window.innerHeight;
    const scrollPercent = docHeight > 0 ? (window.scrollY / docHeight) * 100 : 0;
    const bar = document.getElementById('header-progress');
    if(bar) bar.style.width = scrollPercent + '%';
});
window.addEventListener('load', () => { 
    window.dispatchEvent(new Event('scroll')); 
    setTimeout(fetchReviewsCount, 1000); 
});

window.toggleSubscribeBtn = function(btn) {
    if(btn.classList.contains('subscribed')) return;
    btn.style.opacity = '0.7';
    setTimeout(() => {
        btn.classList.add('subscribed');
        btn.style.opacity = '1';
        btn.querySelector('span').innerText = 'Подписаны';
        btn.querySelector('svg').innerHTML = '<path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>';
    }, 600);
};

</script>

<script>
function showNotificationModal() {
    const modal = document.getElementById('notificationModal');
    const content = document.getElementById('notificationContent');
    if (!modal || !content) return;

    content.innerHTML = '';

    const refBonus = localStorage.getItem('ref_bonus');
    let hasContent = false;

    // 1. Global Notifications
    if (window.notifications && window.notifications.length > 0) {
        window.notifications.forEach(n => {
            const item = document.createElement('div');
            item.className = 'notification-item';
            // Determine icon
            let icon = '<svg viewBox="0 0 24 24" fill="var(--vk)" width="24" height="24"><path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.64 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2zm-2 1H8v-6c0-2.48 1.51-4.5 4-4.5s4 2.02 4 4.5v6z"/></svg>';
            if (n.icon === '🎁') icon = '<svg viewBox="0 0 24 24" fill="#FF3347" width="24" height="24"><path d="M20,8h-3.1C16.6,5.6,14.5,4,12,4S7.4,5.6,7.1,8H4c-1.1,0-2,0.9-2,2v10c0,1.1,0.9,2,2,2h16c1.1,0,2-0.9,2-2V10 C22,8.9,21.1,8,20,8z M12,6c1.2,0,2.1,0.9,2.1,2h-4.2C9.9,6.9,10.8,6,12,6z M19,20h-6v-8h6V20z M11,20H5v-8h6V20z"/></svg>';

            item.innerHTML = `
                <div class="notif-icon">${icon}</div>
                <div class="notif-text">
                    <div class="notif-title">${n.title}</div>
                    <div class="notif-desc">${n.text}</div>
                </div>
            `;
            content.appendChild(item);
            hasContent = true;
        });
    }

    // 2. Referral Notification
    if (refBonus) {
        const refItem = document.createElement('div');
        refItem.className = 'notification-item ref-item';
        refItem.style.borderLeft = '4px solid var(--vk)';
        refItem.style.zIndex = '100002'; // Explicit higher z-index for item
        refItem.innerHTML = `
            <div class="notif-icon"><svg viewBox="0 0 24 24" fill="#FF3347" width="24" height="24"><path d="M20,8h-3.1C16.6,5.6,14.5,4,12,4S7.4,5.6,7.1,8H4c-1.1,0-2,0.9-2,2v10c0,1.1,0.9,2,2,2h16c1.1,0,2-0.9,2-2V10 C22,8.9,21.1,8,20,8z M12,6c1.2,0,2.1,0.9,2.1,2h-4.2C9.9,6.9,10.8,6,12,6z M19,20h-6v-8h6V20z M11,20H5v-8h6V20z"/></svg></div>
            <div class="notif-text">
                <div class="notif-title">Бонус за приглашение</div>
                <div class="notif-desc">${refBonus}</div>
            </div>
        `;
        // Prepend or Append? User said "ref behind modal...". 
        // Usually recent on top. Let's prepend to make it prominent.
        content.insertBefore(refItem, content.firstChild);
        hasContent = true;
    }

    if (hasContent) {
        modal.style.display = 'flex';
        const badge = document.querySelector('.notification-badge');
        if(badge) badge.style.display = 'none';
    }
}
</script>


<script>
// TODO: Replace the placeholder image URLs below with your real project image URLs.

</script>
<script>
(function() {
    const getTooltip = () => document.getElementById('verified-tooltip');
    function updatePosition(target) {
        const tooltip = getTooltip();
        if (!tooltip) return;
        tooltip.style.display = 'block'; 
        const rect = target.getBoundingClientRect();
        const tRect = tooltip.getBoundingClientRect();
        const arrow = tooltip.querySelector('div[style*="transform"]');
        const gap = 12;
        let top = rect.bottom + gap;
        let isTop = false;
        if (top + tRect.height > window.innerHeight) { top = rect.top - tRect.height - gap; isTop = true; }
        let left = rect.left + (rect.width / 2) - (tRect.width / 2);
        if (left < 10) left = 10;
        if (left + tRect.width > window.innerWidth - 10) left = window.innerWidth - tRect.width - 10;
        tooltip.style.top = (window.scrollY + top) + 'px';
        tooltip.style.left = left + 'px';
        if (arrow) {
            arrow.style.position = 'absolute';
            arrow.style.left = (rect.left + rect.width/2 - left - 6) + 'px';
            if (isTop) { arrow.style.bottom = '-6px'; arrow.style.top = 'auto'; } else { arrow.style.top = '-6px'; arrow.style.bottom = 'auto'; }
        }
    }
    const observer = new MutationObserver(() => {
        const nameEl = document.querySelector('.profile-name');
        if (nameEl) {
            const svgs = document.querySelectorAll('svg');
            svgs.forEach(svg => {
                if (svg.closest('.btn-profile') || svg.closest('.footer-icon') || svg.closest('.profile-meta')) return;
                if (svg.previousElementSibling && svg.previousElementSibling.classList.contains('profile-name')) {
                    if (svg.dataset.fixed) return;
                    svg.dataset.fixed = 'true';
                    svg.onmouseenter = (e) => updatePosition(e.currentTarget);
                    svg.onmouseleave = () => { const t = getTooltip(); if(t) t.style.display = 'none'; };
                }
            });
        }
    });
    observer.observe(document.body, { childList: true, subtree: true });
})();
</script>

<script>
function switchTab(tabId, btn){
  const p = document.getElementById('tab-portfolio');
  const t = document.getElementById('tab-tariffs');
  if(!p || !t) return;
  p.style.display = 'none';
  t.style.display = 'none';
  const target = document.getElementById('tab-' + tabId);
  if(target) target.style.display = 'block';

  const btns = document.querySelectorAll('.tab-btn');
  btns.forEach(b => b.classList.remove('active'));
  if(btn) btn.classList.add('active');
  else {
    if(tabId === 'portfolio' && btns[0]) btns[0].classList.add('active');
    if(tabId === 'tariffs' && btns[1]) btns[1].classList.add('active');
  }

  if(tabId === 'tariffs') window.location.hash = 'tariffs';
  else window.location.hash = '';
}

window.addEventListener('load', function(){
  if(window.location.hash === '#tariffs') switchTab('tariffs');
  // initial calc
  document.querySelectorAll('.tariff-wrapper').forEach(w => recalcPrice(w));
});

function toggleAddons(btn) {
  const list = btn.nextElementSibling;
  if(!list) return;
  list.classList.toggle('open');
  const sp = btn.querySelector('span');
  if(sp) sp.textContent = list.classList.contains('open') ? '−' : '+';
}

function toggleQtyState(cb){
  const li = cb.closest('li[data-mode="qty"]');
  if(!li) return;
  const valEl = li.querySelector('.qty-val');
  const min = parseInt(li.dataset.min || '0', 10);
  const base = parseInt(li.dataset.baseQty || '0', 10);
  if(!cb.checked){
    if(valEl) valEl.textContent = '0';
  } else {
    const fallback = base > 0 ? base : Math.max(1, min);
    if(valEl) valEl.textContent = Math.max(parseInt(valEl.textContent || '0', 10), fallback);
  }
  const wrapper = cb.closest('.tariff-wrapper');
  if(wrapper) recalcPrice(wrapper);
}

function changeQty(btn, delta, minQty, maxQty) {
  const control = btn.closest('.qty-control');
  if(!control) return;
  if(control.classList.contains('disabled')) return;
  const valEl = control.querySelector('.qty-val');
  const li = control.closest('li[data-mode="qty"]');
  if(li){
    if(!li.dataset.min) li.dataset.min = String(minQty);
    if(!li.dataset.max) li.dataset.max = String(maxQty);
    const cb = li.querySelector('.qty-checkbox');
    if(cb && !cb.checked && !cb.disabled) return;
    minQty = parseInt(li.dataset.min || String(minQty), 10);
    maxQty = parseInt(li.dataset.max || String(maxQty), 10);
  }
  let v = parseInt(valEl.textContent || '0', 10);
  v += delta;
  if(v < minQty) v = minQty;
  if(maxQty >= 0 && v > maxQty) v = maxQty;
  valEl.textContent = v;
  const wrapper = btn.closest('.tariff-wrapper');
  if(wrapper) recalcPrice(wrapper);
}

function updatePrice(el){
  const wrapper = el.closest('.tariff-wrapper');
  if(wrapper) recalcPrice(wrapper);
}

function recalcPrice(wrapper){
  const basePrice = parseInt(wrapper.dataset.basePrice || '0', 10);
  let total = basePrice;

  // checkboxes
  wrapper.querySelectorAll('input.feature-checkbox').forEach(cb => {
    if(cb.checked) total += parseInt(cb.dataset.price || '0', 10);
    const li = cb.closest('li');
    if(li && li.dataset.type === 'base') {
      if(!cb.checked) li.classList.add('excluded');
      else li.classList.remove('excluded');
    }
  });

  // qty rows
  wrapper.querySelectorAll('li[data-mode="qty"]').forEach(li => {
    const unit = parseInt(li.dataset.unitPrice || '0', 10);
    const baseQty = parseInt(li.dataset.baseQty || '0', 10);
    const curr = parseInt((li.querySelector('.qty-val')||{}).textContent || '0', 10);
    const min = parseInt(li.dataset.min || '0', 10);
    const cb = li.querySelector('.qty-checkbox');
    const active = !cb || cb.checked || cb.disabled;
    const control = li.querySelector('.qty-control');
    if(control) control.classList.toggle('disabled', !active);

    let appliedQty = curr;
    if(active){
      if(appliedQty < min){ appliedQty = min; const valEl = li.querySelector('.qty-val'); if(valEl) valEl.textContent = appliedQty; }
      const diff = appliedQty - baseQty;
      total += diff * unit;
    } else {
      appliedQty = 0;
      const valEl = li.querySelector('.qty-val');
      if(valEl) valEl.textContent = '0';
    }

    if(li.dataset.type === 'base') {
      if(appliedQty === 0) li.classList.add('excluded');
      else li.classList.remove('excluded');
    }
  });

  if(total < 0) total = 0;
  const priceEl = wrapper.querySelector('.tariff-price');
  if(priceEl) priceEl.textContent = total.toLocaleString('ru-RU') + ' ₽';
}

function sendOrder(btn, tariffName){
  const wrapper = btn.closest('.tariff-wrapper');
  if(!wrapper) return;

  let lines = [];

  // checked checkboxes
  wrapper.querySelectorAll('input.feature-checkbox:checked').forEach(cb => {
    const li = cb.closest('li');
    const txt = (li && li.innerText) ? li.innerText.trim() : '';
    // keep only first line before tooltip artifacts
    const clean = txt.split('\n')[0].replace(/\s+\?\s*$/, '').trim();
    if(clean) lines.push(clean);
  });

  // qty rows
  wrapper.querySelectorAll('li[data-mode="qty"]').forEach(li => {
    const cb = li.querySelector('.qty-checkbox');
    const active = !cb || cb.checked || cb.disabled;
    const qty = parseInt((li.querySelector('.qty-val')||{}).textContent || '0', 10);
    if(active && qty > 0){
      const label = li.dataset.label || (li.querySelector('.item-left')||{}).innerText || 'Позиция';
      lines.push(label.trim() + ' — ' + qty + ' шт');
    }
  });

  const total = (wrapper.querySelector('.tariff-price')||{}).textContent || '';
  const text = `Заявка на тариф: ${tariffName}\n\nСостав:\n- ${lines.join('\n- ')}\n\nИтого: ${total}`;

  const modal = document.getElementById('order-modal');
  if(modal){
    const h2 = modal.querySelector('h2');
    if(h2) h2.textContent = 'Ваш заказ: ' + total;
    const p = modal.querySelector('p');
    if(p) p.innerHTML = `Скопируйте состав и отправьте мне:<br><br><textarea style="width:100%;height:130px;background:#111;color:#fff;border:1px solid #333;padding:10px;border-radius:8px;">${text}</textarea>`;
    modal.style.display = 'flex';
    setTimeout(()=>{ modal.style.opacity = '1'; }, 10);
  }
}

// close modal on overlay click
document.addEventListener('click', function(e){
  if(e.target && e.target.id === 'order-modal'){
    const modal = document.getElementById('order-modal');
    if(!modal) return;
    modal.style.opacity = '0';
    setTimeout(()=>{ modal.style.display = 'none'; }, 350);
  }
});
</script>
</body>
</html>
